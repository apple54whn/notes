<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>概述 | Conanan</title>
    <meta name="description" content="Good Good Study, Day Day Up!">
    <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    
    <link rel="preload" href="/assets/css/0.styles.721694fb.css" as="style"><link rel="preload" href="/assets/js/app.4c2406b8.js" as="script"><link rel="preload" href="/assets/js/2.4ce794f3.js" as="script"><link rel="preload" href="/assets/js/79.e9abf630.js" as="script"><link rel="preload" href="/assets/js/33.9b523a1b.js" as="script"><link rel="prefetch" href="/assets/js/10.23584843.js"><link rel="prefetch" href="/assets/js/100.c8b7e6eb.js"><link rel="prefetch" href="/assets/js/101.22710827.js"><link rel="prefetch" href="/assets/js/102.369790c1.js"><link rel="prefetch" href="/assets/js/103.a7c7b572.js"><link rel="prefetch" href="/assets/js/104.7e45de8b.js"><link rel="prefetch" href="/assets/js/105.4791b02d.js"><link rel="prefetch" href="/assets/js/106.61e23a2f.js"><link rel="prefetch" href="/assets/js/107.8ae0e37f.js"><link rel="prefetch" href="/assets/js/108.ad785e65.js"><link rel="prefetch" href="/assets/js/109.f6c3b7e5.js"><link rel="prefetch" href="/assets/js/11.1af6c419.js"><link rel="prefetch" href="/assets/js/110.55979e31.js"><link rel="prefetch" href="/assets/js/111.09bcf468.js"><link rel="prefetch" href="/assets/js/112.17a7c3b1.js"><link rel="prefetch" href="/assets/js/113.9f55e6f6.js"><link rel="prefetch" href="/assets/js/114.ae0d1063.js"><link rel="prefetch" href="/assets/js/115.2b45ae89.js"><link rel="prefetch" href="/assets/js/116.286c2ead.js"><link rel="prefetch" href="/assets/js/117.bd5437e0.js"><link rel="prefetch" href="/assets/js/118.4dd27249.js"><link rel="prefetch" href="/assets/js/119.7be1a2b0.js"><link rel="prefetch" href="/assets/js/12.bc5e4411.js"><link rel="prefetch" href="/assets/js/120.03a04cae.js"><link rel="prefetch" href="/assets/js/121.b657ffcb.js"><link rel="prefetch" href="/assets/js/122.eb76f0ee.js"><link rel="prefetch" href="/assets/js/123.cebd7ceb.js"><link rel="prefetch" href="/assets/js/124.be49618b.js"><link rel="prefetch" href="/assets/js/125.d7aa08e6.js"><link rel="prefetch" href="/assets/js/126.4ad7d0d8.js"><link rel="prefetch" href="/assets/js/127.fe7a1fc9.js"><link rel="prefetch" href="/assets/js/128.18adee58.js"><link rel="prefetch" href="/assets/js/129.65155f32.js"><link rel="prefetch" href="/assets/js/13.46b8bbae.js"><link rel="prefetch" href="/assets/js/130.115199fd.js"><link rel="prefetch" href="/assets/js/131.c30c37e8.js"><link rel="prefetch" href="/assets/js/132.800d09de.js"><link rel="prefetch" href="/assets/js/133.485f2c5a.js"><link rel="prefetch" href="/assets/js/134.68cc802a.js"><link rel="prefetch" href="/assets/js/135.b48b5611.js"><link rel="prefetch" href="/assets/js/136.273edc30.js"><link rel="prefetch" href="/assets/js/137.c51bf33b.js"><link rel="prefetch" href="/assets/js/138.cc73926e.js"><link rel="prefetch" href="/assets/js/139.7f0835b0.js"><link rel="prefetch" href="/assets/js/14.813fdf39.js"><link rel="prefetch" href="/assets/js/140.4b5c8664.js"><link rel="prefetch" href="/assets/js/141.f645668a.js"><link rel="prefetch" href="/assets/js/142.9c31754b.js"><link rel="prefetch" href="/assets/js/143.8dbb577a.js"><link rel="prefetch" href="/assets/js/144.615f3d5a.js"><link rel="prefetch" href="/assets/js/145.3372b6f7.js"><link rel="prefetch" href="/assets/js/146.9d166547.js"><link rel="prefetch" href="/assets/js/147.b35e2060.js"><link rel="prefetch" href="/assets/js/148.2ca9cb36.js"><link rel="prefetch" href="/assets/js/149.b7aae87e.js"><link rel="prefetch" href="/assets/js/15.c027e524.js"><link rel="prefetch" href="/assets/js/150.bad9858c.js"><link rel="prefetch" href="/assets/js/151.fd17d6b4.js"><link rel="prefetch" href="/assets/js/152.2567ef97.js"><link rel="prefetch" href="/assets/js/153.74559d88.js"><link rel="prefetch" href="/assets/js/154.7acecdef.js"><link rel="prefetch" href="/assets/js/155.f457419c.js"><link rel="prefetch" href="/assets/js/156.6fe3ee1a.js"><link rel="prefetch" href="/assets/js/157.fd08fd72.js"><link rel="prefetch" href="/assets/js/158.2b46cf37.js"><link rel="prefetch" href="/assets/js/159.3ace6e8d.js"><link rel="prefetch" href="/assets/js/16.485682dd.js"><link rel="prefetch" href="/assets/js/160.512cf1fa.js"><link rel="prefetch" href="/assets/js/161.0d0ee2ea.js"><link rel="prefetch" href="/assets/js/162.bbdff718.js"><link rel="prefetch" href="/assets/js/163.4fdc9dff.js"><link rel="prefetch" href="/assets/js/164.20d6ef11.js"><link rel="prefetch" href="/assets/js/165.2881201e.js"><link rel="prefetch" href="/assets/js/166.3c7c3ba0.js"><link rel="prefetch" href="/assets/js/167.2143078a.js"><link rel="prefetch" href="/assets/js/168.9f3840f3.js"><link rel="prefetch" href="/assets/js/169.2da8b99f.js"><link rel="prefetch" href="/assets/js/17.53e3a4c9.js"><link rel="prefetch" href="/assets/js/170.997a014a.js"><link rel="prefetch" href="/assets/js/171.addd9a55.js"><link rel="prefetch" href="/assets/js/172.d3d12b0c.js"><link rel="prefetch" href="/assets/js/173.ebd6be51.js"><link rel="prefetch" href="/assets/js/174.c3546734.js"><link rel="prefetch" href="/assets/js/175.e786b04c.js"><link rel="prefetch" href="/assets/js/176.8a72d21e.js"><link rel="prefetch" href="/assets/js/177.4d74c35d.js"><link rel="prefetch" href="/assets/js/178.05b55aba.js"><link rel="prefetch" href="/assets/js/179.06c93c02.js"><link rel="prefetch" href="/assets/js/18.dac780ce.js"><link rel="prefetch" href="/assets/js/180.7a721d6a.js"><link rel="prefetch" href="/assets/js/181.854b3f72.js"><link rel="prefetch" href="/assets/js/182.19f58d6b.js"><link rel="prefetch" href="/assets/js/183.8f49d5b6.js"><link rel="prefetch" href="/assets/js/184.2128f02f.js"><link rel="prefetch" href="/assets/js/19.5bd66b43.js"><link rel="prefetch" href="/assets/js/20.8b0be400.js"><link rel="prefetch" href="/assets/js/21.26154688.js"><link rel="prefetch" href="/assets/js/22.75f3ad5d.js"><link rel="prefetch" href="/assets/js/23.205b8a93.js"><link rel="prefetch" href="/assets/js/24.78eaf948.js"><link rel="prefetch" href="/assets/js/25.5ac44d02.js"><link rel="prefetch" href="/assets/js/26.44e96c5e.js"><link rel="prefetch" href="/assets/js/27.9149de82.js"><link rel="prefetch" href="/assets/js/28.a117fe70.js"><link rel="prefetch" href="/assets/js/29.03c4dd26.js"><link rel="prefetch" href="/assets/js/3.a07e7c66.js"><link rel="prefetch" href="/assets/js/30.add3b4ce.js"><link rel="prefetch" href="/assets/js/31.c168f15b.js"><link rel="prefetch" href="/assets/js/32.6df3dd67.js"><link rel="prefetch" href="/assets/js/34.87d0684d.js"><link rel="prefetch" href="/assets/js/35.07031e68.js"><link rel="prefetch" href="/assets/js/36.b2d8e023.js"><link rel="prefetch" href="/assets/js/37.6693f2b8.js"><link rel="prefetch" href="/assets/js/38.0adc87b6.js"><link rel="prefetch" href="/assets/js/39.4ee1b450.js"><link rel="prefetch" href="/assets/js/4.3601d982.js"><link rel="prefetch" href="/assets/js/40.3a15c4d2.js"><link rel="prefetch" href="/assets/js/41.5089de95.js"><link rel="prefetch" href="/assets/js/42.b6c516e6.js"><link rel="prefetch" href="/assets/js/43.4d729b64.js"><link rel="prefetch" href="/assets/js/44.afb6ada5.js"><link rel="prefetch" href="/assets/js/45.f90fef77.js"><link rel="prefetch" href="/assets/js/46.3f992a07.js"><link rel="prefetch" href="/assets/js/47.3df4792a.js"><link rel="prefetch" href="/assets/js/48.b1b42695.js"><link rel="prefetch" href="/assets/js/49.1f57735c.js"><link rel="prefetch" href="/assets/js/5.c77010ac.js"><link rel="prefetch" href="/assets/js/50.fb1f131c.js"><link rel="prefetch" href="/assets/js/51.621e6bbe.js"><link rel="prefetch" href="/assets/js/52.d3c5f8e8.js"><link rel="prefetch" href="/assets/js/53.fc428b5d.js"><link rel="prefetch" href="/assets/js/54.a8c7b4e7.js"><link rel="prefetch" href="/assets/js/55.9491ad4c.js"><link rel="prefetch" href="/assets/js/56.cc5535aa.js"><link rel="prefetch" href="/assets/js/57.08a4a942.js"><link rel="prefetch" href="/assets/js/58.ea5e0d13.js"><link rel="prefetch" href="/assets/js/59.e9ab1cc2.js"><link rel="prefetch" href="/assets/js/6.3dc37407.js"><link rel="prefetch" href="/assets/js/60.a0651ffe.js"><link rel="prefetch" href="/assets/js/61.9657adee.js"><link rel="prefetch" href="/assets/js/62.5522a97a.js"><link rel="prefetch" href="/assets/js/63.2c5c6db3.js"><link rel="prefetch" href="/assets/js/64.57e79c12.js"><link rel="prefetch" href="/assets/js/65.5e0e9f19.js"><link rel="prefetch" href="/assets/js/66.e80de9ef.js"><link rel="prefetch" href="/assets/js/67.147e8e38.js"><link rel="prefetch" href="/assets/js/68.26a3c0d4.js"><link rel="prefetch" href="/assets/js/69.8f293aac.js"><link rel="prefetch" href="/assets/js/7.53864b7a.js"><link rel="prefetch" href="/assets/js/70.291565bb.js"><link rel="prefetch" href="/assets/js/71.fe0bdf0f.js"><link rel="prefetch" href="/assets/js/72.61d2bc84.js"><link rel="prefetch" href="/assets/js/73.9fcb62aa.js"><link rel="prefetch" href="/assets/js/74.9d682c13.js"><link rel="prefetch" href="/assets/js/75.3264a4ce.js"><link rel="prefetch" href="/assets/js/76.1f8b1f97.js"><link rel="prefetch" href="/assets/js/77.32b48d28.js"><link rel="prefetch" href="/assets/js/78.b50a8708.js"><link rel="prefetch" href="/assets/js/8.50c01faa.js"><link rel="prefetch" href="/assets/js/80.180a3806.js"><link rel="prefetch" href="/assets/js/81.7800a9ae.js"><link rel="prefetch" href="/assets/js/82.388bd268.js"><link rel="prefetch" href="/assets/js/83.27d7c820.js"><link rel="prefetch" href="/assets/js/84.a7be62b6.js"><link rel="prefetch" href="/assets/js/85.e286c095.js"><link rel="prefetch" href="/assets/js/86.84fed10f.js"><link rel="prefetch" href="/assets/js/87.4b95dccb.js"><link rel="prefetch" href="/assets/js/88.dd70f5b5.js"><link rel="prefetch" href="/assets/js/89.4a04d404.js"><link rel="prefetch" href="/assets/js/9.947b77c2.js"><link rel="prefetch" href="/assets/js/90.699f3eeb.js"><link rel="prefetch" href="/assets/js/91.9f21bc4f.js"><link rel="prefetch" href="/assets/js/92.8e8caa65.js"><link rel="prefetch" href="/assets/js/93.08b1a369.js"><link rel="prefetch" href="/assets/js/94.8aa7234f.js"><link rel="prefetch" href="/assets/js/95.1d25fc22.js"><link rel="prefetch" href="/assets/js/96.8bb62cc7.js"><link rel="prefetch" href="/assets/js/97.eed16352.js"><link rel="prefetch" href="/assets/js/98.623e948b.js"><link rel="prefetch" href="/assets/js/99.45cfef32.js">
    <link rel="stylesheet" href="/assets/css/0.styles.721694fb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Conanan</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Basic" class="dropdown-title"><span class="title">Basic</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>OS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Basic/OS/Linux/0 Intro.html" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/Basic/OS/Docker/0 Docker.html" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/Basic/OS/K8/0 Intro.html" class="nav-link">K8</a></li></ul></li><li class="dropdown-item"><h4>Network</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Basic/Network/TCP/IP/0 Intro.html" class="nav-link">TCP/IP</a></li><li class="dropdown-subitem"><a href="/Basic/Network/HTTP/0 Intro.html" class="nav-link">HTTP</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DataBase" class="dropdown-title"><span class="title">DataBase</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/DataBase/RDBMS/0 Primer.html" class="nav-link">RDBMS</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Redis/0 Intro.html" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Mongo/0 Intro.html" class="nav-link">Mongo</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Lucene/0 Primer.html" class="nav-link">Lucene</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Solr/0 Primer.html" class="nav-link">Solr</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Elasticsearch/0 Primer.html" class="nav-link">Elasticsearch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Design" class="dropdown-title"><span class="title">Design</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Design/Design Pattern/0 Intro.html" class="nav-link">Design Pattern</a></li><li class="dropdown-item"><!----> <a href="/Design/DDD/0 Basic.html" class="nav-link">DDD</a></li><li class="dropdown-item"><!----> <a href="/Design/MicroServer/0 Intro.html" class="nav-link">MicroServer</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java Study" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/Core/0 Basic.html" class="nav-link">Core</a></li><li class="dropdown-item"><!----> <a href="/Java/Jakarta EE/0 Servlet.html" class="nav-link">Jakarta EE</a></li><li class="dropdown-item"><!----> <a href="/Java/Spring/primer/0 Primer.html" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/Java/Persistence/Mybatis/0 Primer.html" class="nav-link">Persistence</a></li><li class="dropdown-item"><!----> <a href="/Java/Authe&amp;Autho/0 Primer.html" class="nav-link">认证&amp;授权</a></li><li class="dropdown-item"><h4>分布式&amp;微服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese/" class="nav-link">Dubbo</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">Spring Cloud Netflix</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">Spring Cloud Alibaba</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tools" class="dropdown-title"><span class="title">Tools</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Tools/Vim/Vim.html" class="nav-link">Vim</a></li><li class="dropdown-item"><!----> <a href="/Tools/Git/Git.html" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/Tools/Maven/Maven.html" class="nav-link">Maven</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Server" class="dropdown-title"><span class="title">Server</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Server/Tomcat/0 Primer.html" class="nav-link">Tomcat</a></li><li class="dropdown-item"><!----> <a href="/Server/Nginx/0 Primer.html" class="nav-link">Nginx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Front End" class="dropdown-title"><span class="title">Front End</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Front End/H5&amp;CSS3/1 HTML.html" class="nav-link">H5&amp;CSS3</a></li><li class="dropdown-item"><!----> <a href="/Front End/JS/0 入门-0 入门.html" class="nav-link">JS</a></li><li class="dropdown-item"><!----> <a href="/Front End/NodeJS/NodeJS-1 入门.html" class="nav-link">NodeJS</a></li><li class="dropdown-item"><!----> <a href="/Front End/Vue/1-1 Primer.html" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/Front End/微信小程序/1-1 Primer.html" class="nav-link">微信小程序</a></li><li class="dropdown-item"><!----> <a href="/Front End/Android/0 Intro.html" class="nav-link">Android</a></li><li class="dropdown-item"><!----> <a href="/Front End/Flutter/0 Intro.html" class="nav-link">Flutter</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Environment" class="dropdown-title"><span class="title">Environment</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Environment/macOS/macOS.html" class="nav-link">macOS</a></li><li class="dropdown-item"><!----> <a href="/Environment/Windows/Windows.html" class="nav-link">Windows</a></li><li class="dropdown-item"><!----> <a href="/Environment/Software/IDEA.html" class="nav-link">Software</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Project" class="dropdown-title"><span class="title">Project</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Project/电商/简介.html" class="nav-link">电商</a></li><li class="dropdown-item"><!----> <a href="/Environment/Linux/Linux.html" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/Environment/Windows/Windows.html" class="nav-link">Windows</a></li><li class="dropdown-item"><!----> <a href="/Environment/Software/Software.html" class="nav-link">Software</a></li></ul></div></div> <a href="https://github.com/apple54whn/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Basic" class="dropdown-title"><span class="title">Basic</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>OS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Basic/OS/Linux/0 Intro.html" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/Basic/OS/Docker/0 Docker.html" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/Basic/OS/K8/0 Intro.html" class="nav-link">K8</a></li></ul></li><li class="dropdown-item"><h4>Network</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Basic/Network/TCP/IP/0 Intro.html" class="nav-link">TCP/IP</a></li><li class="dropdown-subitem"><a href="/Basic/Network/HTTP/0 Intro.html" class="nav-link">HTTP</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DataBase" class="dropdown-title"><span class="title">DataBase</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/DataBase/RDBMS/0 Primer.html" class="nav-link">RDBMS</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Redis/0 Intro.html" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Mongo/0 Intro.html" class="nav-link">Mongo</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Lucene/0 Primer.html" class="nav-link">Lucene</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Solr/0 Primer.html" class="nav-link">Solr</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Elasticsearch/0 Primer.html" class="nav-link">Elasticsearch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Design" class="dropdown-title"><span class="title">Design</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Design/Design Pattern/0 Intro.html" class="nav-link">Design Pattern</a></li><li class="dropdown-item"><!----> <a href="/Design/DDD/0 Basic.html" class="nav-link">DDD</a></li><li class="dropdown-item"><!----> <a href="/Design/MicroServer/0 Intro.html" class="nav-link">MicroServer</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java Study" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/Core/0 Basic.html" class="nav-link">Core</a></li><li class="dropdown-item"><!----> <a href="/Java/Jakarta EE/0 Servlet.html" class="nav-link">Jakarta EE</a></li><li class="dropdown-item"><!----> <a href="/Java/Spring/primer/0 Primer.html" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/Java/Persistence/Mybatis/0 Primer.html" class="nav-link">Persistence</a></li><li class="dropdown-item"><!----> <a href="/Java/Authe&amp;Autho/0 Primer.html" class="nav-link">认证&amp;授权</a></li><li class="dropdown-item"><h4>分布式&amp;微服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese/" class="nav-link">Dubbo</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">Spring Cloud Netflix</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">Spring Cloud Alibaba</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tools" class="dropdown-title"><span class="title">Tools</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Tools/Vim/Vim.html" class="nav-link">Vim</a></li><li class="dropdown-item"><!----> <a href="/Tools/Git/Git.html" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/Tools/Maven/Maven.html" class="nav-link">Maven</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Server" class="dropdown-title"><span class="title">Server</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Server/Tomcat/0 Primer.html" class="nav-link">Tomcat</a></li><li class="dropdown-item"><!----> <a href="/Server/Nginx/0 Primer.html" class="nav-link">Nginx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Front End" class="dropdown-title"><span class="title">Front End</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Front End/H5&amp;CSS3/1 HTML.html" class="nav-link">H5&amp;CSS3</a></li><li class="dropdown-item"><!----> <a href="/Front End/JS/0 入门-0 入门.html" class="nav-link">JS</a></li><li class="dropdown-item"><!----> <a href="/Front End/NodeJS/NodeJS-1 入门.html" class="nav-link">NodeJS</a></li><li class="dropdown-item"><!----> <a href="/Front End/Vue/1-1 Primer.html" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/Front End/微信小程序/1-1 Primer.html" class="nav-link">微信小程序</a></li><li class="dropdown-item"><!----> <a href="/Front End/Android/0 Intro.html" class="nav-link">Android</a></li><li class="dropdown-item"><!----> <a href="/Front End/Flutter/0 Intro.html" class="nav-link">Flutter</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Environment" class="dropdown-title"><span class="title">Environment</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Environment/macOS/macOS.html" class="nav-link">macOS</a></li><li class="dropdown-item"><!----> <a href="/Environment/Windows/Windows.html" class="nav-link">Windows</a></li><li class="dropdown-item"><!----> <a href="/Environment/Software/IDEA.html" class="nav-link">Software</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Project" class="dropdown-title"><span class="title">Project</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Project/电商/简介.html" class="nav-link">电商</a></li><li class="dropdown-item"><!----> <a href="/Environment/Linux/Linux.html" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/Environment/Windows/Windows.html" class="nav-link">Windows</a></li><li class="dropdown-item"><!----> <a href="/Environment/Software/Software.html" class="nav-link">Software</a></li></ul></div></div> <a href="https://github.com/apple54whn/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Primer</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/DataBase/Elasticsearch/0 Primer.html" class="active sidebar-link">概述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#学习目标-内容" class="sidebar-link">学习目标 &amp; 内容</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#目标" class="sidebar-link">目标</a></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#内容与结构" class="sidebar-link">内容与结构</a></li></ul></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#elk-stack-简介" class="sidebar-link">ELK Stack 简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#elasticsearch" class="sidebar-link">ElasticSearch</a></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#logstash-和-beats" class="sidebar-link">Logstash 和 Beats</a></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#kibana" class="sidebar-link">Kibana</a></li></ul></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#_6-索引管理—restclient" class="sidebar-link">6 索引管理—RestClient</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#_6-1-搭建工程" class="sidebar-link">6.1 搭建工程</a></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#_6-2-api-restclient" class="sidebar-link">6.2 API+RestClient</a></li></ul></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#_7-搜索管理—dsl搜索" class="sidebar-link">7 搜索管理—DSL搜索</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#_7-1-准备环境" class="sidebar-link">7.1 准备环境</a></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#_7-2-查询所有文档（search-中）" class="sidebar-link">7.2 查询所有文档（search**中）</a></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#_7-3-分页查询（search-中）" class="sidebar-link">7.3 分页查询（search**中）</a></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#_7-4-精确查询-term-id（search-中）" class="sidebar-link">7.4 精确查询 term/ id（search**中）</a></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#_7-5-match（search-中）" class="sidebar-link">7.5 match（search**中）</a></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#_7-6-multi-match-（search-中）" class="sidebar-link">7.6 ==multi match==（search**中）</a></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#_7-7-布尔查询-（search-中，组合其他）" class="sidebar-link">7.7 ==布尔查询==（search**中，组合其他）</a></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#_7-8-过滤器-（布尔中）" class="sidebar-link">7.8 ==过滤器==（布尔中）</a></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#_7-9-排序-（search-中）" class="sidebar-link">7.9 ==排序==（search**中）</a></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#_7-10-高亮-（只在search-中）" class="sidebar-link">7.10 ==高亮==（只在search**中）</a></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#_7-11-restclient" class="sidebar-link">7.11 RestClient</a></li></ul></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#_8-集群管理" class="sidebar-link">8 集群管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#_8-1-集群结构" class="sidebar-link">8.1 集群结构</a></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#_8-2-搭建集群" class="sidebar-link">8.2 搭建集群</a></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#_8-3-测试" class="sidebar-link">8.3 测试</a></li></ul></li><li class="sidebar-sub-header"><a href="/DataBase/Elasticsearch/0 Primer.html#_9-spring-data-elasticsearch" class="sidebar-link">9 Spring Data Elasticsearch</a></li></ul></li><li><a href="/DataBase/Elasticsearch/1 配置.html" class="sidebar-link">配置</a></li><li><a href="/DataBase/Elasticsearch/2 部署.html" class="sidebar-link">部署</a></li><li><a href="/DataBase/Elasticsearch/3 插件.html" class="sidebar-link">插件</a></li><li><a href="/DataBase/Elasticsearch/4 Index &amp; Document.html" class="sidebar-link">Index &amp; Document</a></li><li><a href="/DataBase/Elasticsearch/5 搜索.html" class="sidebar-link">搜索</a></li><li><a href="/DataBase/Elasticsearch/5 原理.html" class="sidebar-link">原理</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h1> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Elastic：[ɪ'læstɪk]。adj.橡皮圈（或带）的；有弹性的；有弹力的；灵活的</p></div> <h2 id="学习目标-内容"><a href="#学习目标-内容" class="header-anchor">#</a> 学习目标 &amp; 内容</h2> <h3 id="目标"><a href="#目标" class="header-anchor">#</a> 目标</h3> <ul><li>开发
<ul><li>产品基本功能</li> <li>低层原理</li> <li>数据建模最佳实践</li></ul></li> <li>运维
<ul><li>容量规划</li> <li>性能优化</li> <li>问题诊断，异常检测</li> <li>滚动升级</li></ul></li> <li>方案
<ul><li>搜索如何解决搜索的相关性问题</li> <li>大数据分析实践与项目实战，理论知识的实际运用</li></ul></li></ul> <h3 id="内容与结构"><a href="#内容与结构" class="header-anchor">#</a> 内容与结构</h3> <ul><li>ES 入门与深入
<ul><li>环境搭建 / 搜索与聚合 / 架构原理 / 数据建模</li></ul></li> <li>ELK 进行大数据分析
<ul><li>可视化分析 / 时序型数据 / 异常检测</li></ul></li> <li>ES 集群管理
<ul><li>水平扩展及性能优化 / 最佳实践</li></ul></li> <li>项目实战</li></ul> <h2 id="elk-stack-简介"><a href="#elk-stack-简介" class="header-anchor">#</a> ELK Stack 简介</h2> <h3 id="elasticsearch"><a href="#elasticsearch" class="header-anchor">#</a> ElasticSearch</h3> <p><a href="https://www.elastic.co/cn/products/elasticsearch" target="_blank" rel="noopener noreferrer">ElasticSearch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是一个<strong>基于Lucene的搜索服务器</strong>。它提供了一个<strong>分布式多用户能力</strong>的全文搜索引擎，基于<strong>RESTful web接口</strong>。Elasticsearch是用<strong>Java开发</strong>的，并作为Apache许可条款下的<strong>开放源码</strong>发布，是当前流行的企业级搜索引擎。设计用于云计算中，能够达到<strong>实时搜索</strong>，稳定，可靠，快速，安装<strong>使用方便</strong>。Github、Stack Overflow等都在使用。</p> <p>突出优点：</p> <ul><li><strong>速度快</strong>：通过有限状态转换器实现了用于全文检索的<strong>倒排索引</strong>，实现了用于存储数值数据和地理位置数据的 BKD 树，以及用于分析的列存储</li> <li><strong>可扩展性</strong>：可以在笔记本电脑上运行。 也可以在<strong>承载了 PB 级数据的成百上千台服务器上运行</strong>。</li> <li><strong>弹性</strong>：Elasticsearch 运行在一个分布式环境中，检测硬件故障、网络分割故障并确保您的<strong>集群（和数据）的安全性和可用性</strong></li></ul> <p>分布式、RESTful 风格的搜索和数据分析引擎，可以集中存储数据</p> <ul><li>主要功能
<ul><li>分布式搜索引擎</li> <li>大数据近实时分析引擎</li></ul></li> <li>产品特性
<ul><li>高性能，和 T+1 说不</li> <li>容易使用 / 扩展</li></ul></li></ul> <h3 id="logstash-和-beats"><a href="#logstash-和-beats" class="header-anchor">#</a> Logstash 和 Beats</h3> <ul><li><p>Logstash</p> <p>动态数据收集管道，拥有可扩展的插件生态系统</p></li> <li><p>Beats</p> <p>面向轻量型采集器的平台，这些采集器可从边缘机器发送数据。</p></li></ul> <h3 id="kibana"><a href="#kibana" class="header-anchor">#</a> Kibana</h3> <p>可视化数据</p> <h2 id="_6-索引管理—restclient"><a href="#_6-索引管理—restclient" class="header-anchor">#</a> 6 索引管理—RestClient</h2> <h3 id="_6-1-搭建工程"><a href="#_6-1-搭建工程" class="header-anchor">#</a> 6.1 搭建工程</h3> <p>ES提供多种不同的客户端：</p> <ul><li><s>TransportClient：ES提供的传统客户端，官方计划8.0版本删除此客户端。</s></li> <li>RestClient：官方推荐使用的，它包括两种 Java Low Level REST Client和 Java High Level REST Client ES在6.0之后提供 Java High Level REST Client 还处于完善中，有些功能还没有。</li></ul> <p>Maven依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.elasticsearch.client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>elasticsearch-rest-high-level-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>6.2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.elasticsearch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>elasticsearch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>6.2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><hr> <p>创建搜索工程（maven工程，直接导入）：xc-service-search，添加RestHighLevelClient依赖及junit依赖。</p> <p>application.yml</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>port<span class="token punctuation">:</span><span class="token number">40100</span><span class="token punctuation">}</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> xc<span class="token punctuation">-</span>search<span class="token punctuation">-</span>service
<span class="token key atrule">xuecheng</span><span class="token punctuation">:</span>
  <span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span>
    <span class="token key atrule">hostlist</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>eshostlist<span class="token punctuation">:</span>127.0.0.1<span class="token punctuation">:</span><span class="token number">9200</span><span class="token punctuation">}</span> <span class="token comment">#多个结点中间用逗号分隔</span>
</code></pre></div><p>配置类<code>com.xuecheng.search.config.ElasticsearchConfig</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ElasticsearchConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${xuecheng.elasticsearch.hostlist}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> hostlist<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RestHighLevelClient</span> <span class="token function">restHighLevelClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//解析hostlist配置信息</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> split <span class="token operator">=</span> hostlist<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建HttpHost数组，其中存放es主机和端口的配置信息</span>
        <span class="token class-name">HttpHost</span><span class="token punctuation">[</span><span class="token punctuation">]</span> httpHostArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">[</span>split<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>split<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">String</span> item <span class="token operator">=</span> split<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            httpHostArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//创建RestHighLevelClient客户端</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span><span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>httpHostArray<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//项目主要使用RestHighLevelClient，对于低级的客户端暂时不用</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RestClient</span> <span class="token function">restClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//解析hostlist配置信息</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> split <span class="token operator">=</span> hostlist<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建HttpHost数组，其中存放es主机和端口的配置信息</span>
        <span class="token class-name">HttpHost</span><span class="token punctuation">[</span><span class="token punctuation">]</span> httpHostArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">[</span>split<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>split<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">String</span> item <span class="token operator">=</span> split<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            httpHostArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>httpHostArray<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>启动类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EntityScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.xuecheng.framework.domain.search&quot;</span><span class="token punctuation">)</span><span class="token comment">//扫描实体类</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;com.xuecheng.api&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//扫描接口</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;com.xuecheng.search&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//扫描本项目下的所有类</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;com.xuecheng.framework&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//扫描common下的所有类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SearchApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SearchApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-2-api-restclient"><a href="#_6-2-api-restclient" class="header-anchor">#</a> 6.2 API+RestClient</h3> <h4 id="_6-2-1-创建索引-映射"><a href="#_6-2-1-创建索引-映射" class="header-anchor">#</a> 6.2.1 创建索引/映射</h4> <p>创建索引（库）：<code>put http://localhost:9200/索引名称</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;index&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token property">&quot;number_of_shards&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">&quot;number_of_replicas&quot;</span><span class="token operator">:</span><span class="token number">0</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>创建映射：<code>put http://localhost:9200/xc_course/doc/_mapping</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span><span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;search_analyzer&quot;</span><span class="token operator">:</span><span class="token string">&quot;ik_smart&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span><span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;search_analyzer&quot;</span><span class="token operator">:</span><span class="token string">&quot;ik_smart&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;studymodel&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;float&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;date&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;format&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yyyy‐MM‐dd HH:mm:ss||yyyy‐MM‐dd||epoch_millis&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_6-2-2-添加文档"><a href="#_6-2-2-添加文档" class="header-anchor">#</a> 6.2.2 添加文档</h4> <p><code>POST/PUT http://localhost:9200/{index}/{type}/{id} { &quot;field&quot;: &quot;value&quot;, ... }</code>，不指定id会自动生成</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring cloud实战&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;本课程主要从四个章节进行讲解： 1.微服务架构入门 2.spring cloud 基础入门 3.实战SpringBoot 4.注册中心eureka。&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;studymodel&quot;</span><span class="token operator">:</span><span class="token string">&quot;201001&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;price&quot;</span><span class="token operator">:</span><span class="token number">5.6</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_6-2-3-根据id查询文档"><a href="#_6-2-3-根据id查询文档" class="header-anchor">#</a> 6.2.3 根据ID查询文档</h4> <p><code>POST/GET /{index}/{type}/{id}</code></p> <h4 id="_6-2-4-更新文档"><a href="#_6-2-4-更新文档" class="header-anchor">#</a> 6.2.4 更新文档</h4> <p>ES更新文档的顺序是：先检索到文档、将原来的文档标记为删除、创建新文档、删除旧文档，创建新文档就会重建索引。</p> <p>通过请求Url有两种方法：</p> <ul><li><p>完全替换<code>POST http://localhost:9200/xc_test/doc/3</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;spring cloud实战&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;本课程主要从四个章节进行讲解： 1.微服务架构入门 2.spring cloud 基础入门 3.实战SpringBoot 4.注册中心eureka。&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;studymodel&quot;</span><span class="token operator">:</span><span class="token string">&quot;201001&quot;</span>
    <span class="token property">&quot;price&quot;</span><span class="token operator">:</span><span class="token number">5.6</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>局部更新<code>POST http://localhost:9200/xc_test/doc/3/_update</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;doc&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;price&quot;</span><span class="token operator">:</span><span class="token number">66.6</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h4 id="_6-2-5-删除文档"><a href="#_6-2-5-删除文档" class="header-anchor">#</a> 6.2.5 删除文档</h4> <p>根据id删除<code>DELETE /{index}/{type}/{id}</code></p> <p>搜索匹配删除，将搜索出来的记录删除<code>POST /{index}/{type}/_delete_by_query</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;term&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token property">&quot;studymodel&quot;</span><span class="token operator">:</span><span class="token string">&quot;201001&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上边例子的搜索匹配删除会将studymodel为201001的记录全部删除</p> <blockquote><p>搜索匹配删除还没有具体的api，可以采用先搜索出文档id，根据文档id删除。</p></blockquote> <h4 id="_6-2-6-删除索引库"><a href="#_6-2-6-删除索引库" class="header-anchor">#</a> 6.2.6 删除索引库</h4> <p>手动</p> <h4 id="_6-2-7-java-client"><a href="#_6-2-7-java-client" class="header-anchor">#</a> 6.2.7 Java Client</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestIndex</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RestHighLevelClient</span> client<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RestClient</span> restClient<span class="token punctuation">;</span>

    <span class="token comment">//创建索引库</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testCreateIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建索引对象</span>
        <span class="token class-name">CreateIndexRequest</span> createIndexRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateIndexRequest</span><span class="token punctuation">(</span><span class="token string">&quot;xc_course&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置参数</span>
        createIndexRequest<span class="token punctuation">.</span><span class="token function">settings</span><span class="token punctuation">(</span><span class="token class-name">Settings</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;number_of_shards&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;number_of_replicas&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//指定映射</span>
        createIndexRequest<span class="token punctuation">.</span><span class="token function">mapping</span><span class="token punctuation">(</span><span class="token string">&quot;doc&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot; {\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot; \t\&quot;properties\&quot;: {\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;            \&quot;studymodel\&quot;:{\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;             \&quot;type\&quot;:\&quot;keyword\&quot;\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;           },\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;            \&quot;name\&quot;:{\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;             \&quot;type\&quot;:\&quot;keyword\&quot;\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;           },\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;           \&quot;description\&quot;: {\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;              \&quot;type\&quot;: \&quot;text\&quot;,\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;              \&quot;analyzer\&quot;:\&quot;ik_max_word\&quot;,\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;              \&quot;search_analyzer\&quot;:\&quot;ik_smart\&quot;\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;           },\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;           \&quot;pic\&quot;:{\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;             \&quot;type\&quot;:\&quot;text\&quot;,\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;             \&quot;index\&quot;:false\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;           }\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot; \t}\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">XContentType</span><span class="token punctuation">.</span>JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//操作索引的客户端</span>
        <span class="token class-name">IndicesClient</span> indices <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//执行创建索引库</span>
        <span class="token class-name">CreateIndexResponse</span> createIndexResponse <span class="token operator">=</span> indices<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>createIndexRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//得到响应</span>
        <span class="token keyword">boolean</span> acknowledged <span class="token operator">=</span> createIndexResponse<span class="token punctuation">.</span><span class="token function">isAcknowledged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>acknowledged<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//删除索引库</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeleteIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//删除索引对象</span>
        <span class="token class-name">DeleteIndexRequest</span> deleteIndexRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeleteIndexRequest</span><span class="token punctuation">(</span><span class="token string">&quot;xc_course&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//操作索引的客户端</span>
        <span class="token class-name">IndicesClient</span> indices <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//执行删除索引</span>
        <span class="token class-name">DeleteIndexResponse</span> delete <span class="token operator">=</span> indices<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>deleteIndexRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//得到响应</span>
        <span class="token keyword">boolean</span> acknowledged <span class="token operator">=</span> delete<span class="token punctuation">.</span><span class="token function">isAcknowledged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>acknowledged<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//添加文档</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAddDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//文档内容</span>
        <span class="token comment">//准备json数据</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> jsonMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jsonMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;spring cloud实战&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jsonMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;description&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;本课程主要从四个章节进行讲解： 1.微服务架构入门 2.spring cloud 基础入门 3.实战Spring Boot 4.注册中心eureka。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jsonMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;studymodel&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;201001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SimpleDateFormat</span> dateFormat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jsonMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;timestamp&quot;</span><span class="token punctuation">,</span> dateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jsonMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">,</span> <span class="token number">5.6f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//创建索引创建对象</span>
        <span class="token class-name">IndexRequest</span> indexRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IndexRequest</span><span class="token punctuation">(</span><span class="token string">&quot;xc_course&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;doc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//文档内容</span>
        indexRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>jsonMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//通过client进行http的请求</span>
        <span class="token class-name">IndexResponse</span> indexResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>indexRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DocWriteResponse</span><span class="token punctuation">.</span><span class="token class-name">Result</span> result <span class="token operator">=</span> indexResponse<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//根据ID查询文档</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//查询请求对象</span>
        <span class="token class-name">GetRequest</span> getRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetRequest</span><span class="token punctuation">(</span><span class="token string">&quot;xc_course&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;doc&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ZEqZP2kBDP-dgPpQBZbx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">GetResponse</span> getResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>getRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//得到文档的内容</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> sourceAsMap <span class="token operator">=</span> getResponse<span class="token punctuation">.</span><span class="token function">getSourceAsMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sourceAsMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//更新文档—局部更新</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">UpdateRequest</span> updateRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UpdateRequest</span><span class="token punctuation">(</span><span class="token string">&quot;xc_course&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;doc&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ZEqZP2kBDP-dgPpQBZbx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;spring cloud实战2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        updateRequest<span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UpdateResponse</span> update <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>updateRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RestStatus</span> status <span class="token operator">=</span> update<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//根据id删除文档</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDelDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//删除索引请求对象</span>
        <span class="token class-name">DeleteRequest</span> deleteRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeleteRequest</span><span class="token punctuation">(</span><span class="token string">&quot;xc_course&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;doc&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ZEqZP2kBDP-dgPpQBZbx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//响应对象</span>
        <span class="token class-name">DeleteResponse</span> deleteResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>deleteRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取响应结果</span>
        <span class="token class-name">DocWriteResponse</span><span class="token punctuation">.</span><span class="token class-name">Result</span> result <span class="token operator">=</span> deleteResponse<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//搜索匹配删除还没有具体的api，可以采用先搜索出文档id，根据文档id删除。</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_7-搜索管理—dsl搜索"><a href="#_7-搜索管理—dsl搜索" class="header-anchor">#</a> 7 搜索管理—DSL搜索</h2> <p>DSL(Domain Specific Language)是ES提出的基于json的搜索方式，在搜索时传入特定的json数据来完成不同的搜索需求。</p> <p>DSL比URI搜索方式功能强大，在项目中建议使用DSL方式来完成搜索。</p> <h3 id="_7-1-准备环境"><a href="#_7-1-准备环境" class="header-anchor">#</a> 7.1 准备环境</h3> <p>环境准备</p> <ol><li><p>创建xc_course<strong>索引（库）</strong>：<code>put http://localhost:9200/xc_course</code></p></li> <li><p>创建如下<strong>映射</strong>：<code>post http://localhost:9200/xc_course/doc/_mapping</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;search_analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_smart&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;search_analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_smart&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;pic&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;index&quot;</span><span class="token operator">:</span><span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;float&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;studymodel&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;date&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;format&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yyyy‐MM‐dd HH:mm:ss||yyyy‐MM‐dd||epoch_millis&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>向xc_course/doc中插入以下数据，如</p> <p><code>POST http://localhost:9200/xc_course/doc/1</code>，指定id分别为1、2、3</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Bootstrap开发&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Bootstrap是由Twitter推出的一个前台页面开发框架，是一个非常流行的开发框架，此框架集成了多种页面效果。此开发框架包含了大量的CSS、JS程序代码，可以帮助开发者（尤其是不擅长页面开发的程序人员）轻松的实现一个不受浏览器限制的精美界面效果。&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;studymodel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;201002&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;price&quot;</span><span class="token operator">:</span><span class="token number">38.6</span><span class="token punctuation">,</span>
    <span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018‐04‐25 19:11:35&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;pic&quot;</span><span class="token operator">:</span><span class="token string">&quot;group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;spring开发基础&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;spring 在java领域非常流行，java程序员都在用。&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;studymodel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;201001&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;price&quot;</span><span class="token operator">:</span><span class="token number">88.6</span><span class="token punctuation">,</span>
    <span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018‐02‐24 19:11:35&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;pic&quot;</span><span class="token operator">:</span><span class="token string">&quot;group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;spring开发基础&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;spring 在java领域非常流行，java程序员都在用。&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;studymodel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;201001&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;price&quot;</span><span class="token operator">:</span><span class="token number">88.6</span><span class="token punctuation">,</span>
    <span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018‐02‐24 19:11:35&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;pic&quot;</span><span class="token operator">:</span><span class="token string">&quot;group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>简单搜索：通过url进行查询，以get方式请求ES</p> <p><code>GET ../_search?q=.....</code></p> <p>如<code>http://localhost:9200/xc_course/doc/_search?q=name:java</code>，搜索name中包括java的文档</p></li></ol> <h3 id="_7-2-查询所有文档（search-中）"><a href="#_7-2-查询所有文档（search-中）" class="header-anchor">#</a> 7.2 查询所有文档（search**中）</h3> <ul><li><p>查询所有索引（库）的文档：<code>POST http://localhost:9200/_search</code></p></li> <li><p>查询指定索引库指定类型下的文档（通过使用此方法）：<code>POST http://localhost:9200/xc_course/doc/_search</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;match_all&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_source&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;studymodel&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>_source</code>：source源<strong>过滤</strong>设置，指定结果中所<strong>包括的字段</strong>有哪些。</p> <p>查询结果分析：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;took&quot;</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span>
    <span class="token property">&quot;timed_out&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_shards&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;total&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;successful&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;skipped&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;failed&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;hits&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;total&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">&quot;max_score&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;hits&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;_index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xc_course&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;doc&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_score&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_source&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;studymodel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;201002&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Bootstrap开发&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>took：本次操作花费的时间，单位为毫秒</p> <p>timed_out：请求是否超时</p> <p>_shards：说明本次操作共搜索了哪些分片</p> <p>hits：搜索命中的记录</p> <p>hits.total ： 符合条件的文档总数 hits.hits ：匹配度较高的前N个文档</p> <p>hits.max_score：文档匹配得分，这里为最高分</p> <p>_score：每个文档都有一个匹配度得分，按照降序排列</p> <p>_source：显示了文档的原始内容</p></li></ul> <h3 id="_7-3-分页查询（search-中）"><a href="#_7-3-分页查询（search-中）" class="header-anchor">#</a> 7.3 分页查询（search**中）</h3> <p><code>POST http://localhost:9200/xc_course/doc/_search</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;from&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token property">&quot;size&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;match_all&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_source&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;studymodel&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>form：表示起始文档的下标，从0开始。</p></li> <li><p>size：查询的文档数量（记录数）。</p></li></ul> <p>【注意】命中的总记录数就是全部的，但是在遍历记录时只会遍历到符合分页条件的</p> <h3 id="_7-4-精确查询-term-id（search-中）"><a href="#_7-4-精确查询-term-id（search-中）" class="header-anchor">#</a> 7.4 精确查询 term/ id（search**中）</h3> <p>在搜索时会<strong>整体匹配关键字</strong>，<strong>不</strong>再将搜索关键字<strong>分词</strong></p> <p><code>POST http://localhost:9200/xc_course/doc/_search</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;term&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;spring&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_source&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;studymodel&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ES提供根据多个id值匹配的方法：</p> <p><code>POST http://127.0.0.1:9200/xc_course/doc/_search</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;ids&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;doc&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;values&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;100&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>【注意】termQuery 和 termsQuery 区别</p> <h3 id="_7-5-match（search-中）"><a href="#_7-5-match（search-中）" class="header-anchor">#</a> 7.5 match（search**中）</h3> <p>match query与Term query区别是match query在<strong>搜索前先将搜索关键字分词</strong>，再拿各各词语去索引中搜索。</p> <p><code>POST http://localhost:9200/xc_course/doc/_search</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;match&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;description&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;spring开发框架&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;operator&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;or&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;minimum_should_match&quot;</span><span class="token operator">:</span> <span class="token string">&quot;80%&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p><code>query</code>：搜索的关键字，对于英文关键字如果有多个单词则中间要用半角逗号分隔，而对于中文关键字中间可以用逗号分隔也可以不用。</p></li> <li><p><code>operator</code></p> <ul><li><code>or</code> 表示只要有一个词在文档中出现则就符合条件</li> <li><code>and</code>表示每个词都在文档中出现则才符合条件。</li></ul></li> <li><p><code>minimum_should_match</code>指定文档匹配词的占比。“spring开发框架”会被分为三个词：spring、开发、框架</p> <p><code>&quot;80%&quot;</code>表示，三个词在文档的匹配占比为80%，即3*0.8=2.4，向下取整得2，表示至少有两个词在文档中要匹配成功。</p></li></ul> <h3 id="_7-6-multi-match-（search-中）"><a href="#_7-6-multi-match-（search-中）" class="header-anchor">#</a> 7.6 ==multi match==（search**中）</h3> <p>上边学习的termQuery和matchQuery一次只能匹配一个Field，本节学习multiQuery，一次可以匹配多个字段。</p> <p><code>POST http://localhost:9200/xc_course/doc/_search</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;multi_match&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;spring css&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;minimum_should_match&quot;</span><span class="token operator">:</span> <span class="token string">&quot;50%&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;name^10&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span> <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>提升boost</strong>，通常关键字匹配上name的权重要比匹配上description的权重高，这里可以对name的权重提升。</p> <p>“<code>name^10</code>” 表示<strong>权重提升10倍</strong></p> <h3 id="_7-7-布尔查询-（search-中，组合其他）"><a href="#_7-7-布尔查询-（search-中，组合其他）" class="header-anchor">#</a> 7.7 ==布尔查询==（search**中，组合其他）</h3> <p>布尔查询对应于Lucene的BooleanQuery查询，实现<strong>将多个查询组合起来</strong>。三个参数：</p> <ul><li><strong>must</strong>：文档必须匹配must所包括的查询条件，相当于 “<strong>AND</strong>”</li> <li><strong>should</strong>：文档应该匹配should所包括的查询条件其中的一个或多个，相当于 &quot;<strong>OR</strong>&quot;</li> <li><strong>must_not</strong>：文档不能匹配must_not所包括的该查询条件，相当于“<strong>NOT</strong>”</li></ul> <p><code>POST http://localhost:9200/xc_course/doc/_search</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;_source&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;studymodel&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;from&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token property">&quot;size&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;bool&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;must&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token property">&quot;multi_match&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;spring框架&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;minimum_should_match&quot;</span><span class="token operator">:</span> <span class="token string">&quot;50%&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;name^10&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span> <span class="token punctuation">]</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                    <span class="token property">&quot;term&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
                        <span class="token property">&quot;studymodel&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;201001&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-8-过滤器-（布尔中）"><a href="#_7-8-过滤器-（布尔中）" class="header-anchor">#</a> 7.8 ==过滤器==（布尔中）</h3> <p>过虑是针对搜索的<strong>结果进行过虑</strong>，过虑器主要判断的是文档是否匹配，<strong>不去计算和判断文档的匹配度得分</strong>，所以过虑器性能比查询要高，且方便缓存，<strong>推荐</strong>尽量使用过虑器去实现查询或者过虑器和查询共同使用。<strong>过虑器在布尔查询中使用</strong></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;_source&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;studymodel&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;bool&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;must&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token property">&quot;multi_match&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;spring框架&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;minimum_should_match&quot;</span><span class="token operator">:</span> <span class="token string">&quot;50%&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;name^10&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span> <span class="token punctuation">]</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span> <span class="token property">&quot;term&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;studymodel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;201001&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span> <span class="token property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;gte&quot;</span><span class="token operator">:</span> <span class="token number">60</span> <span class="token punctuation">,</span><span class="token property">&quot;lte&quot;</span> <span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>term</code>：项匹配过虑，保留studymodel等于&quot;201001&quot;的记录。</li> <li><code>range</code>：范围过虑，保留大于等于60 并且小于等于100的记录。</li></ul> <p>【注意】：range和term一次只能对一个Field设置范围过虑。</p> <h3 id="_7-9-排序-（search-中）"><a href="#_7-9-排序-（search-中）" class="header-anchor">#</a> 7.9 ==排序==（search**中）</h3> <p>可以在字段上添加一个或多个排序，<strong>支持在keyword、date、float等类型上添加</strong>，<strong>text类型的字段上不允许</strong>添加排序。</p> <p>过虑0--10元价格范围的文档，并且对结果进行排序，先按studymodel降序，再按价格升序：</p> <p><code>POST http://localhost:9200/xc_course/doc/_search</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;_source&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;studymodel&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;description&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;bool&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span> <span class="token property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;gte&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;lte&quot;</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> <span class="token property">&quot;studymodel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;desc&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token string">&quot;asc&quot;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-10-高亮-（只在search-中）"><a href="#_7-10-高亮-（只在search-中）" class="header-anchor">#</a> 7.10 ==高亮==（只在search**中）</h3> <p>高亮显示可以将搜索结果一个或多个字突出显示，以便向用户展示匹配关键字的位置。</p> <p><code>POST http://127.0.0.1:9200/xc_course/doc/_search</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;_source&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;studymodel&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;bool&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;must&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token property">&quot;multi_match&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;开发框架&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;minimum_should_match&quot;</span><span class="token operator">:</span> <span class="token string">&quot;50%&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;name^10&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;best_fields&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span> <span class="token property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;gte&quot;</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">,</span><span class="token property">&quot;lte&quot;</span> <span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sort&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;price&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;asc&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;highlight&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;pre_tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;tag&gt;&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;post_tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;/tag&gt;&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;description&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-11-restclient"><a href="#_7-11-restclient" class="header-anchor">#</a> 7.11 RestClient</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestSearch</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">RestHighLevelClient</span> client<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">RestClient</span> restClient<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">SearchRequest</span> searchRequest <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">////搜索请求对象，传入索引（可变参数）、类型</span>
    <span class="token keyword">private</span> <span class="token class-name">SearchSourceBuilder</span> searchSourceBuilder <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">//搜索源构建对象</span>

    <span class="token keyword">private</span> <span class="token class-name">SearchHit</span><span class="token punctuation">[</span><span class="token punctuation">]</span> searchHits <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">//匹配度高的文档数组</span>

    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//搜索请求对象，传入索引（可变参数）</span>
        searchRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span><span class="token string">&quot;xc_course&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchRequest<span class="token punctuation">.</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token string">&quot;doc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//搜索源构建对象</span>
        searchSourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//搜索全部记录</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSearchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//搜索方式</span>
        <span class="token comment">//matchAllQuery搜索全部</span>
        searchSourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchAllQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//分页查询</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSearchPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        searchSourceBuilder<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//(当前页-1)*每页显示记录数</span>
        searchSourceBuilder<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//搜索方式</span>
        <span class="token comment">//matchAllQuery搜索全部</span>
        searchSourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchAllQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//TermQuery，注意termQuery</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTermQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        searchSourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;spring&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//根据id查询，注意termsQuery</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTermQueryByIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        searchSourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//MatchQuery。以下三个任选其一</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testMatchQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        searchSourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">&quot;description&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;spring开发框架&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">operator</span><span class="token punctuation">(</span><span class="token class-name">Operator</span><span class="token punctuation">.</span>OR<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchSourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">&quot;description&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;spring开发框架&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">operator</span><span class="token punctuation">(</span><span class="token class-name">Operator</span><span class="token punctuation">.</span>AND<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchSourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">&quot;description&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;spring开发框架&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">minimumShouldMatch</span><span class="token punctuation">(</span><span class="token string">&quot;8%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//MultiMatchQuery</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testMultiMatchQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        searchSourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">multiMatchQuery</span><span class="token punctuation">(</span><span class="token string">&quot;spring css&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//BoolQuery</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testBoolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BoolQueryBuilder</span> boolQueryBuilder <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">boolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">multiMatchQuery</span><span class="token punctuation">(</span><span class="token string">&quot;spring框架&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;studymodel&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;201001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        searchSourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>boolQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//filter，在BoolQuery中使用</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//定义一个boolQuery，并用must和filter过滤</span>
        <span class="token class-name">BoolQueryBuilder</span> boolQueryBuilder <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">boolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">multiMatchQuery</span><span class="token punctuation">(</span><span class="token string">&quot;spring框架&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;studymodel&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;201001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">rangeQuery</span><span class="token punctuation">(</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lte</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">QueryBuilders</span>
            searchSourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>boolQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//Sort，在searchSourceBuilder中使用</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//定义一个boolQuery，用filter过滤</span>
        <span class="token class-name">BoolQueryBuilder</span> boolQueryBuilder <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">boolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">rangeQuery</span><span class="token punctuation">(</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lte</span><span class="token punctuation">(</span><span class="token string">&quot;100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        searchSourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>boolQueryBuilder<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">&quot;studymodel&quot;</span><span class="token punctuation">,</span> <span class="token class-name">SortOrder</span><span class="token punctuation">.</span>DESC<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">,</span> <span class="token class-name">SortOrder</span><span class="token punctuation">.</span>ASC<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//Highlight</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testHighlight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BoolQueryBuilder</span> boolQueryBuilder <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">boolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">multiMatchQuery</span><span class="token punctuation">(</span><span class="token string">&quot;开发框架&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">rangeQuery</span><span class="token punctuation">(</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lte</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchSourceBuilder
            <span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>boolQueryBuilder<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">highlighter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HighlightBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">preTags</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;tag&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">postTags</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/tag&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//字段过滤等</span>
    <span class="token annotation punctuation">@After</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">loopShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ParseException</span> <span class="token punctuation">{</span>
        <span class="token comment">//设置源字段过虑,第一个参数结果集包括哪些字段，第二个参数表示结果集不包括哪些字段</span>
        searchSourceBuilder<span class="token punctuation">.</span><span class="token function">fetchSource</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;studymodel&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;price&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;timestamp&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//向搜索请求对象中设置搜索源</span>
        searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>searchSourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>

        
        <span class="token comment">//执行搜索,向ES发起http请求</span>
        <span class="token class-name">SearchResponse</span> searchResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//搜索结果</span>
        <span class="token class-name">SearchHits</span> hits <span class="token operator">=</span> searchResponse<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//匹配到的总记录数（此时总记录数是1，是真正匹配的数目）</span>
        <span class="token keyword">long</span> totalHits <span class="token operator">=</span> hits<span class="token punctuation">.</span><span class="token function">getTotalHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//得到匹配度高的文档</span>
        searchHits <span class="token operator">=</span> hits<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//SearchHit[]</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span> hit <span class="token operator">:</span> searchHits<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> index <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//索引（库）名称</span>
            <span class="token class-name">String</span> id <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//文档的主键</span>
            <span class="token comment">//源文档内容</span>
            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> sourceAsMap <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getSourceAsMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//由于前边设置了源文档字段过虑，这时description是取不到的，为null</span>
            <span class="token class-name">String</span> description <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> sourceAsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//学习模式</span>
            <span class="token class-name">String</span> studymodel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> sourceAsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;studymodel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//价格</span>
            <span class="token class-name">Double</span> price <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">)</span> sourceAsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//日期（有可能因为传入的字符串格式不是UTF-8，编码问题，会解析时报错）</span>
            <span class="token class-name">SimpleDateFormat</span> dateFormat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Date</span> timestamp <span class="token operator">=</span> dateFormat<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> sourceAsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;timestamp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


            <span class="token comment">//源文档的name字段内容（由于description过滤了，所以不考虑）</span>
            <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> sourceAsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//取出高亮字段</span>
            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">HighlightField</span><span class="token punctuation">&gt;</span></span> highlightFields <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getHighlightFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>highlightFields<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//取出name高亮字段</span>
                <span class="token class-name">HighlightField</span> nameHighlightField <span class="token operator">=</span> highlightFields<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>nameHighlightField<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//组合name高亮片段</span>
                    <span class="token class-name">Text</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fragments <span class="token operator">=</span> nameHighlightField<span class="token punctuation">.</span><span class="token function">getFragments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">StringBuilder</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Text</span> text <span class="token operator">:</span> fragments<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        buffer<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    name <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_8-集群管理"><a href="#_8-集群管理" class="header-anchor">#</a> 8 集群管理</h2> <h3 id="_8-1-集群结构"><a href="#_8-1-集群结构" class="header-anchor">#</a> 8.1 集群结构</h3> <p>ES通常以集群方式工作，这样做不仅能够提高 ES的<strong>搜索能力</strong>还可以<strong>处理大数据搜索的能力</strong>，同时也增加了系统的<strong>容错</strong>能力及<strong>高可用</strong>，ES可以实现PB级数据的搜索。</p> <p><img src="images/1551718617433.png" alt="1551718617433"></p> <ul><li><p>结点</p> <p>ES集群由多个服务器组成，<strong>每个服务器即为一个Node结点</strong>(该服务<strong>只部署了一个</strong>ES进程)。</p></li> <li><p>分片</p> <p>当我们的<strong>文档量很大</strong>时，由于内存和硬盘的限制，同时也为了提高ES的处理能力、容错能力及高可用能力，我们将
<strong>索引分成若干分片</strong>，每个分片可以放在<strong>不同的服务器</strong>，这样就实现了多个服务器共同对外提供索引及搜索服务。
一个搜索请求过来，会分别从各个分片去查询，最后将查询到的数据<strong>合并</strong>返回给用户。</p></li> <li><p>副本</p> <p>为了提高ES的<strong>高可用</strong>同时也为了<strong>提高搜索的吞吐量</strong>，我们<strong>将分片复制一份或多份存储在其它的服务器</strong>，这样即使当
前的服务器挂掉了，拥有副本的服务器照常可以提供服务。</p></li> <li><p>主结点</p> <p>一个集群中会有一个或多个主结点，<strong>主结点的作用是集群管理</strong>，比如增加节点，移除节点等，主结点挂掉后ES会<strong>重</strong> <strong>新选</strong>一个主结点。</p></li> <li><p>结点转发</p> <p><strong>每个结点都知道其它结点的信息</strong>，我们可以对任意一个结点发起请求，接收请求的结点会转发给其它结点查询数据。</p></li></ul> <h3 id="_8-2-搭建集群"><a href="#_8-2-搭建集群" class="header-anchor">#</a> 8.2 搭建集群</h3> <h4 id="_8-2-4-创建索引库"><a href="#_8-2-4-创建索引库" class="header-anchor">#</a> 8.2.4 创建索引库</h4> <ol><li><p>使用head连上其中一个结点，下图表示两个结点已经创建成功。</p> <p><img src="images/1551720416905.png" alt="1551720416905"></p></li> <li><p>创建索引（库），共2个分片，每个分片1个副本。</p> <p><img src="images/1551720503312.png" alt="1551720503312"></p> <p>创建成功，刷新head。下图可以看到共有4个分片，其中两个分片是副本。</p> <p><img src="images/1551720577040.png" alt="1551720577040"></p></li></ol> <h4 id="_8-2-5-集群的健康"><a href="#_8-2-5-集群的健康" class="header-anchor">#</a> 8.2.5 集群的健康</h4> <p>通过访问 <code>GET /_cluster/health</code> 来查看Elasticsearch 的集群健康情况。</p> <p>green：所有的主分片和副本分片都正常运行。</p> <p>yellow：所有的主分片都正常运行，但有些副本分片运行不正常。</p> <p>red：存在主分片运行不正常。</p> <h3 id="_8-3-测试"><a href="#_8-3-测试" class="header-anchor">#</a> 8.3 测试</h3> <ol><li><p>连接其中任意一台结点，创建映射写入文档。</p> <p><code>POST http://localhost:9200/xc_course/doc/1</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;spring开发基础&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;spring 在java领域非常流行，java软件开发人员都在用。&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;studymodel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;201001&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;price&quot;</span><span class="token operator">:</span><span class="token number">66.6</span>
<span class="token punctuation">}</span>
</code></pre></div><p>响应结果：提示可看出，两个分片都保存成功。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;_index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xc_course&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;doc&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_version&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token string">&quot;created&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_shards&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;total&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">&quot;successful&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">&quot;failed&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_seq_no&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_primary_term&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>搜索：向其它一个结点发起搜索请求，查询全部数据。</p></li> <li><p>关闭一个结点，ES会<strong>重新选中一个主结点</strong>（前提在配置结点时<strong>允许</strong>它可以为主结点）</p> <p>此时向活的结点发起搜索请求，仍然正常。</p></li> <li><p>添加一个结点3</p> <p>结点名：xc_node_3，http端口是：9202，集群管理端口是9302，配置：<code>node.master: false node.data: true</code></p> <p>启动结点3，刷新head，下图显示ES将分片分在了3个结点</p> <p><img src="images/1551720958917.png" alt="1551720958917"></p> <p>向结点3发起搜索请求：全部数据可被正常搜索到。</p></li></ol> <h2 id="_9-spring-data-elasticsearch"><a href="#_9-spring-data-elasticsearch" class="header-anchor">#</a> 9 Spring Data Elasticsearch</h2></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/apple54whn/notes/edit/master/docs/DataBase/Elasticsearch/0 Primer.md" target="_blank" rel="noopener noreferrer">编辑文档！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">4/24/2020, 1:03:36 AM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/DataBase/Elasticsearch/1 配置.html">配置</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.4c2406b8.js" defer></script><script src="/assets/js/2.4ce794f3.js" defer></script><script src="/assets/js/79.e9abf630.js" defer></script><script src="/assets/js/33.9b523a1b.js" defer></script>
  </body>
</html>
