<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Primer | Conanan</title>
    <meta name="description" content="Good Good Study, Day Day Up!">
    <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    
    <link rel="preload" href="/assets/css/0.styles.721694fb.css" as="style"><link rel="preload" href="/assets/js/app.4c2406b8.js" as="script"><link rel="preload" href="/assets/js/2.4ce794f3.js" as="script"><link rel="preload" href="/assets/js/52.d3c5f8e8.js" as="script"><link rel="preload" href="/assets/js/33.9b523a1b.js" as="script"><link rel="prefetch" href="/assets/js/10.23584843.js"><link rel="prefetch" href="/assets/js/100.c8b7e6eb.js"><link rel="prefetch" href="/assets/js/101.22710827.js"><link rel="prefetch" href="/assets/js/102.369790c1.js"><link rel="prefetch" href="/assets/js/103.a7c7b572.js"><link rel="prefetch" href="/assets/js/104.7e45de8b.js"><link rel="prefetch" href="/assets/js/105.4791b02d.js"><link rel="prefetch" href="/assets/js/106.61e23a2f.js"><link rel="prefetch" href="/assets/js/107.8ae0e37f.js"><link rel="prefetch" href="/assets/js/108.ad785e65.js"><link rel="prefetch" href="/assets/js/109.f6c3b7e5.js"><link rel="prefetch" href="/assets/js/11.1af6c419.js"><link rel="prefetch" href="/assets/js/110.55979e31.js"><link rel="prefetch" href="/assets/js/111.09bcf468.js"><link rel="prefetch" href="/assets/js/112.17a7c3b1.js"><link rel="prefetch" href="/assets/js/113.9f55e6f6.js"><link rel="prefetch" href="/assets/js/114.ae0d1063.js"><link rel="prefetch" href="/assets/js/115.2b45ae89.js"><link rel="prefetch" href="/assets/js/116.286c2ead.js"><link rel="prefetch" href="/assets/js/117.bd5437e0.js"><link rel="prefetch" href="/assets/js/118.4dd27249.js"><link rel="prefetch" href="/assets/js/119.7be1a2b0.js"><link rel="prefetch" href="/assets/js/12.bc5e4411.js"><link rel="prefetch" href="/assets/js/120.03a04cae.js"><link rel="prefetch" href="/assets/js/121.b657ffcb.js"><link rel="prefetch" href="/assets/js/122.eb76f0ee.js"><link rel="prefetch" href="/assets/js/123.cebd7ceb.js"><link rel="prefetch" href="/assets/js/124.be49618b.js"><link rel="prefetch" href="/assets/js/125.d7aa08e6.js"><link rel="prefetch" href="/assets/js/126.4ad7d0d8.js"><link rel="prefetch" href="/assets/js/127.fe7a1fc9.js"><link rel="prefetch" href="/assets/js/128.18adee58.js"><link rel="prefetch" href="/assets/js/129.65155f32.js"><link rel="prefetch" href="/assets/js/13.46b8bbae.js"><link rel="prefetch" href="/assets/js/130.115199fd.js"><link rel="prefetch" href="/assets/js/131.c30c37e8.js"><link rel="prefetch" href="/assets/js/132.800d09de.js"><link rel="prefetch" href="/assets/js/133.485f2c5a.js"><link rel="prefetch" href="/assets/js/134.68cc802a.js"><link rel="prefetch" href="/assets/js/135.b48b5611.js"><link rel="prefetch" href="/assets/js/136.273edc30.js"><link rel="prefetch" href="/assets/js/137.c51bf33b.js"><link rel="prefetch" href="/assets/js/138.cc73926e.js"><link rel="prefetch" href="/assets/js/139.7f0835b0.js"><link rel="prefetch" href="/assets/js/14.813fdf39.js"><link rel="prefetch" href="/assets/js/140.4b5c8664.js"><link rel="prefetch" href="/assets/js/141.f645668a.js"><link rel="prefetch" href="/assets/js/142.9c31754b.js"><link rel="prefetch" href="/assets/js/143.8dbb577a.js"><link rel="prefetch" href="/assets/js/144.615f3d5a.js"><link rel="prefetch" href="/assets/js/145.3372b6f7.js"><link rel="prefetch" href="/assets/js/146.9d166547.js"><link rel="prefetch" href="/assets/js/147.b35e2060.js"><link rel="prefetch" href="/assets/js/148.2ca9cb36.js"><link rel="prefetch" href="/assets/js/149.b7aae87e.js"><link rel="prefetch" href="/assets/js/15.c027e524.js"><link rel="prefetch" href="/assets/js/150.bad9858c.js"><link rel="prefetch" href="/assets/js/151.fd17d6b4.js"><link rel="prefetch" href="/assets/js/152.2567ef97.js"><link rel="prefetch" href="/assets/js/153.74559d88.js"><link rel="prefetch" href="/assets/js/154.7acecdef.js"><link rel="prefetch" href="/assets/js/155.f457419c.js"><link rel="prefetch" href="/assets/js/156.6fe3ee1a.js"><link rel="prefetch" href="/assets/js/157.fd08fd72.js"><link rel="prefetch" href="/assets/js/158.2b46cf37.js"><link rel="prefetch" href="/assets/js/159.3ace6e8d.js"><link rel="prefetch" href="/assets/js/16.485682dd.js"><link rel="prefetch" href="/assets/js/160.512cf1fa.js"><link rel="prefetch" href="/assets/js/161.0d0ee2ea.js"><link rel="prefetch" href="/assets/js/162.bbdff718.js"><link rel="prefetch" href="/assets/js/163.4fdc9dff.js"><link rel="prefetch" href="/assets/js/164.20d6ef11.js"><link rel="prefetch" href="/assets/js/165.2881201e.js"><link rel="prefetch" href="/assets/js/166.3c7c3ba0.js"><link rel="prefetch" href="/assets/js/167.2143078a.js"><link rel="prefetch" href="/assets/js/168.9f3840f3.js"><link rel="prefetch" href="/assets/js/169.2da8b99f.js"><link rel="prefetch" href="/assets/js/17.53e3a4c9.js"><link rel="prefetch" href="/assets/js/170.997a014a.js"><link rel="prefetch" href="/assets/js/171.addd9a55.js"><link rel="prefetch" href="/assets/js/172.d3d12b0c.js"><link rel="prefetch" href="/assets/js/173.ebd6be51.js"><link rel="prefetch" href="/assets/js/174.c3546734.js"><link rel="prefetch" href="/assets/js/175.e786b04c.js"><link rel="prefetch" href="/assets/js/176.8a72d21e.js"><link rel="prefetch" href="/assets/js/177.4d74c35d.js"><link rel="prefetch" href="/assets/js/178.05b55aba.js"><link rel="prefetch" href="/assets/js/179.06c93c02.js"><link rel="prefetch" href="/assets/js/18.dac780ce.js"><link rel="prefetch" href="/assets/js/180.7a721d6a.js"><link rel="prefetch" href="/assets/js/181.854b3f72.js"><link rel="prefetch" href="/assets/js/182.19f58d6b.js"><link rel="prefetch" href="/assets/js/183.8f49d5b6.js"><link rel="prefetch" href="/assets/js/184.2128f02f.js"><link rel="prefetch" href="/assets/js/19.5bd66b43.js"><link rel="prefetch" href="/assets/js/20.8b0be400.js"><link rel="prefetch" href="/assets/js/21.26154688.js"><link rel="prefetch" href="/assets/js/22.75f3ad5d.js"><link rel="prefetch" href="/assets/js/23.205b8a93.js"><link rel="prefetch" href="/assets/js/24.78eaf948.js"><link rel="prefetch" href="/assets/js/25.5ac44d02.js"><link rel="prefetch" href="/assets/js/26.44e96c5e.js"><link rel="prefetch" href="/assets/js/27.9149de82.js"><link rel="prefetch" href="/assets/js/28.a117fe70.js"><link rel="prefetch" href="/assets/js/29.03c4dd26.js"><link rel="prefetch" href="/assets/js/3.a07e7c66.js"><link rel="prefetch" href="/assets/js/30.add3b4ce.js"><link rel="prefetch" href="/assets/js/31.c168f15b.js"><link rel="prefetch" href="/assets/js/32.6df3dd67.js"><link rel="prefetch" href="/assets/js/34.87d0684d.js"><link rel="prefetch" href="/assets/js/35.07031e68.js"><link rel="prefetch" href="/assets/js/36.b2d8e023.js"><link rel="prefetch" href="/assets/js/37.6693f2b8.js"><link rel="prefetch" href="/assets/js/38.0adc87b6.js"><link rel="prefetch" href="/assets/js/39.4ee1b450.js"><link rel="prefetch" href="/assets/js/4.3601d982.js"><link rel="prefetch" href="/assets/js/40.3a15c4d2.js"><link rel="prefetch" href="/assets/js/41.5089de95.js"><link rel="prefetch" href="/assets/js/42.b6c516e6.js"><link rel="prefetch" href="/assets/js/43.4d729b64.js"><link rel="prefetch" href="/assets/js/44.afb6ada5.js"><link rel="prefetch" href="/assets/js/45.f90fef77.js"><link rel="prefetch" href="/assets/js/46.3f992a07.js"><link rel="prefetch" href="/assets/js/47.3df4792a.js"><link rel="prefetch" href="/assets/js/48.b1b42695.js"><link rel="prefetch" href="/assets/js/49.1f57735c.js"><link rel="prefetch" href="/assets/js/5.c77010ac.js"><link rel="prefetch" href="/assets/js/50.fb1f131c.js"><link rel="prefetch" href="/assets/js/51.621e6bbe.js"><link rel="prefetch" href="/assets/js/53.fc428b5d.js"><link rel="prefetch" href="/assets/js/54.a8c7b4e7.js"><link rel="prefetch" href="/assets/js/55.9491ad4c.js"><link rel="prefetch" href="/assets/js/56.cc5535aa.js"><link rel="prefetch" href="/assets/js/57.08a4a942.js"><link rel="prefetch" href="/assets/js/58.ea5e0d13.js"><link rel="prefetch" href="/assets/js/59.e9ab1cc2.js"><link rel="prefetch" href="/assets/js/6.3dc37407.js"><link rel="prefetch" href="/assets/js/60.a0651ffe.js"><link rel="prefetch" href="/assets/js/61.9657adee.js"><link rel="prefetch" href="/assets/js/62.5522a97a.js"><link rel="prefetch" href="/assets/js/63.2c5c6db3.js"><link rel="prefetch" href="/assets/js/64.57e79c12.js"><link rel="prefetch" href="/assets/js/65.5e0e9f19.js"><link rel="prefetch" href="/assets/js/66.e80de9ef.js"><link rel="prefetch" href="/assets/js/67.147e8e38.js"><link rel="prefetch" href="/assets/js/68.26a3c0d4.js"><link rel="prefetch" href="/assets/js/69.8f293aac.js"><link rel="prefetch" href="/assets/js/7.53864b7a.js"><link rel="prefetch" href="/assets/js/70.291565bb.js"><link rel="prefetch" href="/assets/js/71.fe0bdf0f.js"><link rel="prefetch" href="/assets/js/72.61d2bc84.js"><link rel="prefetch" href="/assets/js/73.9fcb62aa.js"><link rel="prefetch" href="/assets/js/74.9d682c13.js"><link rel="prefetch" href="/assets/js/75.3264a4ce.js"><link rel="prefetch" href="/assets/js/76.1f8b1f97.js"><link rel="prefetch" href="/assets/js/77.32b48d28.js"><link rel="prefetch" href="/assets/js/78.b50a8708.js"><link rel="prefetch" href="/assets/js/79.e9abf630.js"><link rel="prefetch" href="/assets/js/8.50c01faa.js"><link rel="prefetch" href="/assets/js/80.180a3806.js"><link rel="prefetch" href="/assets/js/81.7800a9ae.js"><link rel="prefetch" href="/assets/js/82.388bd268.js"><link rel="prefetch" href="/assets/js/83.27d7c820.js"><link rel="prefetch" href="/assets/js/84.a7be62b6.js"><link rel="prefetch" href="/assets/js/85.e286c095.js"><link rel="prefetch" href="/assets/js/86.84fed10f.js"><link rel="prefetch" href="/assets/js/87.4b95dccb.js"><link rel="prefetch" href="/assets/js/88.dd70f5b5.js"><link rel="prefetch" href="/assets/js/89.4a04d404.js"><link rel="prefetch" href="/assets/js/9.947b77c2.js"><link rel="prefetch" href="/assets/js/90.699f3eeb.js"><link rel="prefetch" href="/assets/js/91.9f21bc4f.js"><link rel="prefetch" href="/assets/js/92.8e8caa65.js"><link rel="prefetch" href="/assets/js/93.08b1a369.js"><link rel="prefetch" href="/assets/js/94.8aa7234f.js"><link rel="prefetch" href="/assets/js/95.1d25fc22.js"><link rel="prefetch" href="/assets/js/96.8bb62cc7.js"><link rel="prefetch" href="/assets/js/97.eed16352.js"><link rel="prefetch" href="/assets/js/98.623e948b.js"><link rel="prefetch" href="/assets/js/99.45cfef32.js">
    <link rel="stylesheet" href="/assets/css/0.styles.721694fb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Conanan</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Basic" class="dropdown-title"><span class="title">Basic</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>OS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Basic/OS/Linux/0 Intro.html" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/Basic/OS/Docker/0 Docker.html" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/Basic/OS/K8/0 Intro.html" class="nav-link">K8</a></li></ul></li><li class="dropdown-item"><h4>Network</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Basic/Network/TCP/IP/0 Intro.html" class="nav-link">TCP/IP</a></li><li class="dropdown-subitem"><a href="/Basic/Network/HTTP/0 Intro.html" class="nav-link">HTTP</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DataBase" class="dropdown-title"><span class="title">DataBase</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/DataBase/RDBMS/0 Primer.html" class="nav-link">RDBMS</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Redis/0 Intro.html" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Mongo/0 Intro.html" class="nav-link">Mongo</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Lucene/0 Primer.html" class="nav-link">Lucene</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Solr/0 Primer.html" class="nav-link">Solr</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Elasticsearch/0 Primer.html" class="nav-link">Elasticsearch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Design" class="dropdown-title"><span class="title">Design</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Design/Design Pattern/0 Intro.html" class="nav-link">Design Pattern</a></li><li class="dropdown-item"><!----> <a href="/Design/DDD/0 Basic.html" class="nav-link">DDD</a></li><li class="dropdown-item"><!----> <a href="/Design/MicroServer/0 Intro.html" class="nav-link">MicroServer</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java Study" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/Core/0 Basic.html" class="nav-link">Core</a></li><li class="dropdown-item"><!----> <a href="/Java/Jakarta EE/0 Servlet.html" class="nav-link">Jakarta EE</a></li><li class="dropdown-item"><!----> <a href="/Java/Spring/primer/0 Primer.html" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/Java/Persistence/Mybatis/0 Primer.html" class="nav-link">Persistence</a></li><li class="dropdown-item"><!----> <a href="/Java/Authe&amp;Autho/0 Primer.html" class="nav-link">认证&amp;授权</a></li><li class="dropdown-item"><h4>分布式&amp;微服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese/" class="nav-link">Dubbo</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">Spring Cloud Netflix</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">Spring Cloud Alibaba</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tools" class="dropdown-title"><span class="title">Tools</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Tools/Vim/Vim.html" class="nav-link">Vim</a></li><li class="dropdown-item"><!----> <a href="/Tools/Git/Git.html" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/Tools/Maven/Maven.html" class="nav-link">Maven</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Server" class="dropdown-title"><span class="title">Server</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Server/Tomcat/0 Primer.html" class="nav-link">Tomcat</a></li><li class="dropdown-item"><!----> <a href="/Server/Nginx/0 Primer.html" class="nav-link">Nginx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Front End" class="dropdown-title"><span class="title">Front End</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Front End/H5&amp;CSS3/1 HTML.html" class="nav-link">H5&amp;CSS3</a></li><li class="dropdown-item"><!----> <a href="/Front End/JS/0 入门-0 入门.html" class="nav-link">JS</a></li><li class="dropdown-item"><!----> <a href="/Front End/NodeJS/NodeJS-1 入门.html" class="nav-link">NodeJS</a></li><li class="dropdown-item"><!----> <a href="/Front End/Vue/1-1 Primer.html" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/Front End/微信小程序/1-1 Primer.html" class="nav-link">微信小程序</a></li><li class="dropdown-item"><!----> <a href="/Front End/Android/0 Intro.html" class="nav-link">Android</a></li><li class="dropdown-item"><!----> <a href="/Front End/Flutter/0 Intro.html" class="nav-link">Flutter</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Environment" class="dropdown-title"><span class="title">Environment</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Environment/macOS/macOS.html" class="nav-link">macOS</a></li><li class="dropdown-item"><!----> <a href="/Environment/Windows/Windows.html" class="nav-link">Windows</a></li><li class="dropdown-item"><!----> <a href="/Environment/Software/IDEA.html" class="nav-link">Software</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Project" class="dropdown-title"><span class="title">Project</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Project/电商/简介.html" class="nav-link">电商</a></li><li class="dropdown-item"><!----> <a href="/Environment/Linux/Linux.html" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/Environment/Windows/Windows.html" class="nav-link">Windows</a></li><li class="dropdown-item"><!----> <a href="/Environment/Software/Software.html" class="nav-link">Software</a></li></ul></div></div> <a href="https://github.com/apple54whn/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Basic" class="dropdown-title"><span class="title">Basic</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>OS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Basic/OS/Linux/0 Intro.html" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/Basic/OS/Docker/0 Docker.html" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/Basic/OS/K8/0 Intro.html" class="nav-link">K8</a></li></ul></li><li class="dropdown-item"><h4>Network</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Basic/Network/TCP/IP/0 Intro.html" class="nav-link">TCP/IP</a></li><li class="dropdown-subitem"><a href="/Basic/Network/HTTP/0 Intro.html" class="nav-link">HTTP</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DataBase" class="dropdown-title"><span class="title">DataBase</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/DataBase/RDBMS/0 Primer.html" class="nav-link">RDBMS</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Redis/0 Intro.html" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Mongo/0 Intro.html" class="nav-link">Mongo</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Lucene/0 Primer.html" class="nav-link">Lucene</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Solr/0 Primer.html" class="nav-link">Solr</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Elasticsearch/0 Primer.html" class="nav-link">Elasticsearch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Design" class="dropdown-title"><span class="title">Design</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Design/Design Pattern/0 Intro.html" class="nav-link">Design Pattern</a></li><li class="dropdown-item"><!----> <a href="/Design/DDD/0 Basic.html" class="nav-link">DDD</a></li><li class="dropdown-item"><!----> <a href="/Design/MicroServer/0 Intro.html" class="nav-link">MicroServer</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java Study" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/Core/0 Basic.html" class="nav-link">Core</a></li><li class="dropdown-item"><!----> <a href="/Java/Jakarta EE/0 Servlet.html" class="nav-link">Jakarta EE</a></li><li class="dropdown-item"><!----> <a href="/Java/Spring/primer/0 Primer.html" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/Java/Persistence/Mybatis/0 Primer.html" class="nav-link">Persistence</a></li><li class="dropdown-item"><!----> <a href="/Java/Authe&amp;Autho/0 Primer.html" class="nav-link">认证&amp;授权</a></li><li class="dropdown-item"><h4>分布式&amp;微服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese/" class="nav-link">Dubbo</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">Spring Cloud Netflix</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">Spring Cloud Alibaba</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tools" class="dropdown-title"><span class="title">Tools</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Tools/Vim/Vim.html" class="nav-link">Vim</a></li><li class="dropdown-item"><!----> <a href="/Tools/Git/Git.html" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/Tools/Maven/Maven.html" class="nav-link">Maven</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Server" class="dropdown-title"><span class="title">Server</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Server/Tomcat/0 Primer.html" class="nav-link">Tomcat</a></li><li class="dropdown-item"><!----> <a href="/Server/Nginx/0 Primer.html" class="nav-link">Nginx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Front End" class="dropdown-title"><span class="title">Front End</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Front End/H5&amp;CSS3/1 HTML.html" class="nav-link">H5&amp;CSS3</a></li><li class="dropdown-item"><!----> <a href="/Front End/JS/0 入门-0 入门.html" class="nav-link">JS</a></li><li class="dropdown-item"><!----> <a href="/Front End/NodeJS/NodeJS-1 入门.html" class="nav-link">NodeJS</a></li><li class="dropdown-item"><!----> <a href="/Front End/Vue/1-1 Primer.html" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/Front End/微信小程序/1-1 Primer.html" class="nav-link">微信小程序</a></li><li class="dropdown-item"><!----> <a href="/Front End/Android/0 Intro.html" class="nav-link">Android</a></li><li class="dropdown-item"><!----> <a href="/Front End/Flutter/0 Intro.html" class="nav-link">Flutter</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Environment" class="dropdown-title"><span class="title">Environment</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Environment/macOS/macOS.html" class="nav-link">macOS</a></li><li class="dropdown-item"><!----> <a href="/Environment/Windows/Windows.html" class="nav-link">Windows</a></li><li class="dropdown-item"><!----> <a href="/Environment/Software/IDEA.html" class="nav-link">Software</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Project" class="dropdown-title"><span class="title">Project</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Project/电商/简介.html" class="nav-link">电商</a></li><li class="dropdown-item"><!----> <a href="/Environment/Linux/Linux.html" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/Environment/Windows/Windows.html" class="nav-link">Windows</a></li><li class="dropdown-item"><!----> <a href="/Environment/Software/Software.html" class="nav-link">Software</a></li></ul></div></div> <a href="https://github.com/apple54whn/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Primer</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/DataBase/Solr/0 Primer.html" class="active sidebar-link">Primer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/DataBase/Solr/0 Primer.html#环境搭建" class="sidebar-link">环境搭建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/DataBase/Solr/0 Primer.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/DataBase/Solr/0 Primer.html#中文分析器-ik-analyzer" class="sidebar-link">中文分析器 IK Analyzer</a></li><li class="sidebar-sub-header"><a href="/DataBase/Solr/0 Primer.html#配置域" class="sidebar-link">配置域</a></li></ul></li><li class="sidebar-sub-header"><a href="/DataBase/Solr/0 Primer.html#spring-data-solr-入门" class="sidebar-link">Spring Data Solr 入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/DataBase/Solr/0 Primer.html#环境搭建-2" class="sidebar-link">环境搭建</a></li><li class="sidebar-sub-header"><a href="/DataBase/Solr/0 Primer.html#field-、-dynamic注解" class="sidebar-link">@Field 、@Dynamic注解</a></li><li class="sidebar-sub-header"><a href="/DataBase/Solr/0 Primer.html#增加（修改）" class="sidebar-link">增加（修改）</a></li><li class="sidebar-sub-header"><a href="/DataBase/Solr/0 Primer.html#按主键删除" class="sidebar-link">按主键删除</a></li><li class="sidebar-sub-header"><a href="/DataBase/Solr/0 Primer.html#删除所有（条件）" class="sidebar-link">删除所有（条件）</a></li><li class="sidebar-sub-header"><a href="/DataBase/Solr/0 Primer.html#按主键查询" class="sidebar-link">按主键查询</a></li><li class="sidebar-sub-header"><a href="/DataBase/Solr/0 Primer.html#条件查询（含分页查询）" class="sidebar-link">条件查询（含分页查询）</a></li></ul></li><li class="sidebar-sub-header"><a href="/DataBase/Solr/0 Primer.html#批量数据导入" class="sidebar-link">批量数据导入</a></li><li class="sidebar-sub-header"><a href="/DataBase/Solr/0 Primer.html#关键字搜索（复制域）" class="sidebar-link">关键字搜索（复制域）</a></li><li class="sidebar-sub-header"><a href="/DataBase/Solr/0 Primer.html#高亮显示关键字搜索（复制域）" class="sidebar-link">高亮显示关键字搜索（复制域）</a></li><li class="sidebar-sub-header"><a href="/DataBase/Solr/0 Primer.html#分组查询" class="sidebar-link">分组查询</a></li><li class="sidebar-sub-header"><a href="/DataBase/Solr/0 Primer.html#过滤查询（以上所有代码）" class="sidebar-link">过滤查询（以上所有代码）</a></li><li class="sidebar-sub-header"><a href="/DataBase/Solr/0 Primer.html#更新索引库" class="sidebar-link">更新索引库</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="primer"><a href="#primer" class="header-anchor">#</a> Primer</h1> <p>大多数搜索引擎应用都必须具有某种搜索功能，问题是搜索功能往往是巨大的资源消耗，并且它们由于沉重的数据库加载而拖垮你的应用的性能。这就是为什么转移负载到一个<strong>外部的搜索服务器</strong>是一个不错的主意，<strong>Apache Solr</strong>是一个流行的开源搜索服务器，它通过使用类似<strong>REST的HTTP API</strong>，这就确保你能从几乎==<strong>任何编程语言来使用solr</strong>==。</p> <p>​	Solr是一个<strong>开源</strong>搜索平台，用于<strong>构建搜索应用程序</strong>。 它建立在<a href="http://www.yiibai.com/lucene/" target="_blank" rel="noopener noreferrer">Lucene<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>(全文搜索引擎)之上。 Solr是企业级的、快速的和高度可扩展的。 使用Solr构建的应用程序非常复杂，可提供高性能。</p> <p>​	为了在CNET网络的公司网站上添加搜索功能，Yonik Seely于2004年创建了Solr。并在2006年1月，它成为Apache软件基金会下的一个开源项目。并于2016年发布最新版本Solr 6.0，支持并行SQL查询的执行。</p> <p>​	<strong>Solr可以和<a href="http://www.yiibai.com/hadoop/" target="_blank" rel="noopener noreferrer">Hadoop<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>一起使用</strong>。由于Hadoop处理大量数据，Solr帮助我们从这么大的源中找到所需的信息。不仅限于搜索，<strong>Solr也可以用于存储</strong>目的。像其他<strong>NoSQL</strong>数据库一样，它是一种非关系数据存储和处理技术。</p> <p>​	总之，Solr是一个<strong>可扩展</strong>的，<strong>可部署</strong>，<strong>搜索/存储引擎</strong>，优化搜索<strong>大量以文本为中心的数据</strong>。</p> <h2 id="环境搭建"><a href="#环境搭建" class="header-anchor">#</a> 环境搭建</h2> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <ol><li><p>安装 Tomcat（解压即可）</p></li> <li><p>解压 solr</p></li> <li><p>把 solr 下的dist目录<code>solr-4.10.3.war</code>部署到 <code>Tomcat\webapps</code>下(去掉版本号)</p></li> <li><p>启动 Tomcat，自动解压缩 war 包</p></li> <li><p>把solr下example/lib/ext 目录下的所有的 jar 包，添加到 solr 的工程中(\WEB-INF\lib目录下)</p></li> <li><p>solrhome，solr 下的/example/solr 目录就是一个 solrhome。复制此目录到如D盘并改名为solrhome（存储数据）</p></li> <li><p>关联 solr 及 solrhome。需要修改 solr 工程的 web.xml 文件</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>env-entry</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>env-entry-name</span><span class="token punctuation">&gt;</span></span>solr/home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>env-entry-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>env-entry-value</span><span class="token punctuation">&gt;</span></span>d:\solrhome<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>env-entry-value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>env-entry-type</span><span class="token punctuation">&gt;</span></span>java.lang.String<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>env-entry-type</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>env-entry</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>重新启动该Tomcat，访问<code>http://localhost:8080/solr/</code>即可看到界面，可以查询、分析</p></li></ol> <h3 id="中文分析器-ik-analyzer"><a href="#中文分析器-ik-analyzer" class="header-anchor">#</a> 中文分析器 IK Analyzer</h3> <blockquote><p>IK Analyzer 是一个开源的，基亍 java 语言开发的轻量级的中文分词工具包。从 2006年 12 月推出 1.0 版开始，IKAnalyzer 已经推出了 4 个大版本。最初，它是以开源项目Luence 为应用主体的，结合词典分词和文法分析算法的中文分词组件。3.0 版本开始，IK 发展为面向 Java 的公用分词组件，独立于 Lucene 项目，同时提供了对 Lucene 的默认优化实现。在 2012 版本中，IK 实现了简单的分词歧义排除算法，标志着 IK 分词器从单纯的词典分词向模拟语义分词衍化</p></blockquote> <p>IK Analyzer配置：</p> <ol><li><p>把IKAnalyzer2012FF_u1.jar 添加到 solr 工程的 lib 目录下</p></li> <li><p>创建WEB-INF/classes文件夹，把扩展词典、停用词词典（辅助词或敏感词）、配置文件放到 solr 工程的 WEB-INF/classes 目录下</p></li> <li><p>修改 Solrhome 的 schema.xml 文件，配置一个 FieldType，使用 IKAnalyzer来做中文分析器</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldType</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text_ik<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>solr.TextField<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>analyzer</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.wltea.analyzer.lucene.IKAnalyzer<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldType</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ol> <h3 id="配置域"><a href="#配置域" class="header-anchor">#</a> 配置域</h3> <p>域相当于数据库的表字段，用户存放数据，因此用户根据业务需要去定义相关的Field（域），一般来说，每一种对应着一种数据，用户对同一种数据进行相同的操作。域的常用属性：</p> <ul><li>name：指定域的名称</li> <li>type：指定域的类型</li> <li>indexed：是否索引（要搜索的域）</li> <li>stored：是否存储</li> <li>required：是否必须</li> <li>multiValued：是否多值</li></ul> <h4 id="基本域"><a href="#基本域" class="header-anchor">#</a> 基本域</h4> <p>修改solrhome的<code>schema.xml</code>文件，设置业务系统 Field。根据搜索的、被搜索出的、要用到的Field来配置</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item_goodsid<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>long<span class="token punctuation">&quot;</span></span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span> <span class="token comment">&lt;!--goodsId,商品SKU。这些都是item表数据--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item_title<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text_ik<span class="token punctuation">&quot;</span></span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--title,商品标题--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item_price<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>double<span class="token punctuation">&quot;</span></span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--price,商品价格--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item_image<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>string<span class="token punctuation">&quot;</span></span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--image,商品图片地址--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item_category<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>string<span class="token punctuation">&quot;</span></span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--category,商品分类--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item_seller<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text_ik<span class="token punctuation">&quot;</span></span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--seller,商家--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item_brand<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>string<span class="token punctuation">&quot;</span></span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--brand,品牌--&gt;</span>
<span class="token comment">&lt;!--后添加的--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item_updatetime<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>date<span class="token punctuation">&quot;</span></span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--updatetime,上架时间--&gt;</span>
</code></pre></div><h4 id="复制域"><a href="#复制域" class="header-anchor">#</a> 复制域</h4> <p>多条件查询时（同时输入标题、分类、商家、品牌），复制域的作用在于将某一个Field中的数据复制到另一个域中，不需要存储</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item_keywords<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text_ik<span class="token punctuation">&quot;</span></span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">multiValued</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>copyField</span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item_title<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dest</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item_keywords<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>copyField</span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item_category<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dest</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item_keywords<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>copyField</span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item_seller<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dest</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item_keywords<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>copyField</span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item_brand<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dest</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item_keywords<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><h4 id="动态域"><a href="#动态域" class="header-anchor">#</a> 动态域</h4> <p>当我们需要动态扩充字段时，我们需要使用动态域。对于品优购，规格的值是不确定的，所以我们需要使用动态域来实现。需要实现的效果如下：</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASYAAADkCAYAAAA1k4nRAAATL0lEQVR4nO2dPZYbNxZGX8legNJJvAY7EzPtwA5nEscjr0AdSYrYO/DETjzp7KAzdmavwYlXIdUEbIggiP8CUK+K957DQxKFAsDq5kc8APVhmud5FgAARbxauwEAAC4IEwCoA2ECAHUgTACgjixhmqZJpmnq3RYAABEp6DExeQcAoyCUAwB1IEwAoI6kME3TRBgHAENJCtM8zwx8A8BQCOUAQB0IEwCoA2ECAHVkCxPjTAAwim9zMjErBwAjIZQDAHUgTACgDoQJANSBMAGAOhAmAFAHwgQA6kCYAEAdCBMAqKO5MJkV4i1Wircqa/o0XT23zg8AbWkqTMa76dbD6Vkep0mm6VGeb84yx66Ph8sqbNOnSeYP89dn3/GS/ADQn0Gh3Bt5P88yz+/ljffYSY5jGnIFPSIAnTQVJtOzaXFvXaysktDO9Hrc3k+oRxTKDwDjGNBj8odq18cO8lBQIjcVA+ybAcIUCtWe5XE6yIMc5TQ4lGP8CEA3d7lcwAxuM/sGoJO7FCaRszgxngSgk2nuPmBjQjbDUU5fZ+fcY+5xPy23lDK9pZQ4sY0VwDgGCNM+QJgAxnG3oVwJiBLAWBCmDBAlgLEgTACgDoQJANSBMAGAOhAmAFAHwgQA6kCYAEAdCNPOyb0fMCdfzj2F5h5E36MVdlk15Wq7N1JbezTwbesCWzlP7oVeTpz2s0vIZyrHVcEcD31ZcurLcQotxT7f563lOxY7Zyu8+vRKPn/4LN98+kY+f/gsk9yJiM0NMcXdFnuajyKzyHE+taxwESVtMnnNI+9zhK9HGfJRrp7tdF9a7Bz3XN/DV16oTUvTS7HLyW1raVt8x0PXJ5YvJ3+sPdPHaf4yf/n6fE807zH5OVvrvr9Jtz2Z4jfu1hOqI9Qm3zkmr++m4/Wwe0ylHlMljp7uMQ1+VqEeZM559rNIuJfl1hU67lLTY9xD764lTYVpbmituwdi16MktGthz5LrouA7x32dKq/HmInbFvua+EQpFHK6+X3lhuoyZdQQOy8kql8+fLl6vidWtNa1ex8Pcgja7prz7Pchq15f3b46Una/sXaVfMYwS8W79Mvv++LmDEr7fKvstFB+32MJIf+s0Fibm39kL6THgP+9MSCUO1vryk0IZKe7YZYdSr2Vp+kgh+mdvBOR4+kkcjiIvDwfJomEgaE6Qm1KtcuHr62xNrUhNPBden5u+FPbQ8kdnM8httWWfdzuDeXWlZM3J9xKhcgawuAtMGiMqZYHOWzmR2d8W5eKUw6+HkmO4JSM4dS2KTT+FcofIxXC2XmWCAt7FuahfB3TUU7zLPM8yzz/LN+t3Zwodlv79pZGEhpfGf3FcnttdppvAsDXy0sRCltLxJTwrRH9J/5SU+32cfuYe967+Z3IfDyd081z+XT/cT5lTf/bec51y83DnFe+nKDFpY9NnefksaezfcsL3Nfu9HfO1H3tlH6I3OUIoWn7nPaElk2ULEcozV/CNE3zly/7Xj6Ate5G8fUOQmM/7gyU3QvwhUG5YzSpafTWY0y+NpXONmoc8yltw6tXr+Tz589FG79uDeVjTDnE1hb1XB+1LrGQJSUW9rN7LDcUWXOMyS6ndPmDT6TXouZa3IMoibAZAQAoRPngNwDcIwgTAKgDYQIAdSBMAKAOhAkA1IEwAYA6ECYAUEdzYTILv/a+ACwXrgdAOU2FKexvbfyK8ryK1qdNe1v7n4e0rTQdQDtNV36XfxFHWOuuR0thMiLjFlOaDrAFmvaYzJePu1zOxK5HSWg3TX6BKU0H2Ao7ttYN5b+kPz772pay3fXVP95aF2DXjHFXCXkn5aSb1zV+TL5yXD+mmBeTzx8qVJb7ug32X2jJa4Atodz2pLddbe3Ylr3107M8iUivts7z9SC2CdNK0wG2hPJ1TFjrilwEx7yuTQfYDP07ZWta6/rqLmlPqk1jrXWN5NSmD/lzAzRg50Zx+16OUEqr9VQAvdmBMOVu233f4oQowZbYgTABwN5QPvgNAPcIwgQA6kCYAEAdCBMAqANhAgB1IEwAoA6ECQDUgbWuQriGcO9grVtMifdS6nPfltXD9TLn2DRdHjnl+PLbabFjS9pTkj6iPdCHQaHc2Sbk9q77LQrWG3k/n+SYnTfmNlBSVhmlonS55ff2C+w7P5Tf52wQy1/Snpx0l57tgX5grauM2DUsCe1Cf4JSf6ZeeWvbU9IGDe2BOnZsresrJ1Reqm433b5puKb8UFlxtAi+6TWYh28jBFcgYvl95fvKipWTCkWVXDrIZYy7ilZrXZ8dbuk5sXaUfL52drwG968bs929Dlbyy1nyPtae2nJy3ps09/OG2pNTHrRl59a65zEcmQ4v5RjrE2OH2wK7jgfRbK8Ss911ex9rt6d3L8f3ebEl1oPydUxLrXVto7j2lrcXzCD3SY7esFQPIdvdtQZ0Y4PTPQl9XmyJldC/U6bJWjdkh1vbpku7busotfBNh3Mlf65QWOYeT+UvTTfHlrTHDbOWtLNFe+L1Etf1YOdGca61Lla70BacQfuwA2GKWese5TS/laer44gStAFR6scOhAkA9obywW8AuEcQJgBQB8IEAOpAmABAHQgTAKgDYQIAdSi/Vw7WZPp0fd/G/GG+Oe6mAbSguTC1dGCEa1pdWyMotrC4IiRyK0SpMlPn+uoF8IG17kboKUoiZyGxHzXEzkWUoASsdb1obZcOpk/T1x6Sr6cFsJSmoZz5JSeEa0/s2pb0okxvxTdedFNuIDyzw7/c3k+oXgAv/Q0Mci1EUtYj5TYh8Xpq2lVih+K2+bbei3XLrX3K9bH27pYp5GP8X0M+yteHmz91LkAKrHW9bUilLbXfTQjc8RS5NmPIFSb3dc65ACmULxdYaq1rcx7nem/eXVnuLmnTEvvekAXLkzxOD8N8o0LjRKGZOnsg204DaIVyYbK/mM/yOP3aqFzbMM71ayppk1vWUhG5iFx+e5YTm9rPzQ/QlP6dsjWtdWP1p8as4uNDl/RS+97c65EfwvX4M+aEY6HwzTfuFCwDa1rwwH/FYmLbP7Uobx1KhMnNizDBUpSHcjmkrHV7j9G42zfV1mt/jvXsf0vHinwhX+6YE3cHQAisdQFAHbgLAIA6ECYAUAfCBADqQJgAQB0IEwCoA2ECAHUgTDvAXjNUsw4JQBvNhWmapqvne6fV9agxZsvxWOpRL8BSdmyta+ocVe9tfb3tcO1joXNcSpwAsMOFtRh0S8q15ciFlnfm++oceaf+eGeAmF1JSKxSr0VwD4D1wVq3I7HrsdQO1/VEssXFl89Nd4/ZabF6AUYwYPA7FFLZN60+yOEm3HLPs9+XhmgPcvCU8/gca1tJ3eZ4fm9pqXj7bpxFQGA3jDEx0Gqtm1t3rYVuf3zWIrYfd8h6JGVZArAmym1PWlrr+vCNbblWubrxhW0lPScGt0EjyoWpl7VujCW2u+Mo9el28yBEoJr+nbI1rXVzrHB95/vscmNbK5VvLdXj0pfa4VaXgeskdAajuB2R6gnl9JSy8uA8CZ3ZwS0pvhmzkQsrt0FMcMyW34gSaIEeEwCoYwc9JgDYGwgTAKgDYQIAddStY/rhB5E//2zcFIAd8/33In/8sXYrNkPd4Pc0iTBmDpAP35kiCOUAQB0IUxdia6tS661cU70ck71YnoLzf/pJfmL9FygAa92uHOU0zzIHHyc5ZpdlrFtuReuxmYr8U/4zn+To2NCsaQ/csxzQy46tdbeI6+hpvw8L2cPB9rWyfaZqrvfZbXR+uXm6tz2wvercd457DLvf+2BQKHf9z35h74Jl9zx8IZrtXOC6GpyN5+R07sE8PcdEywjWWcDeez2K/5LfgqHkSzv+9y/5x8DbeWybFteLvMbCBXZE1a2/ze4uH2+sNoaXz3U8XjkhhJ7Trge+6xR3QJCbcnMN9fKp/fcJlhcwr9sFODIUsXNrXd85v8gvyXJyLHdz6n97Np07nHs2b9+8cd7beU2v0g3XztfJ9Jwu18nkt8+Jh3ytmRtNf+feQAz3wwCjuNDuIXa66yR5a9Z2mN7JOxE5ns5fbHl5PkySscOKW/7P8t1N+eIJkexjxjSup4HcbTh3MO1/80befHXWfHj5TG47Hs7HjseAMLnh45nj6dT8k5RgBCl3cwTYP8qXCzzIYZEAnMXveLUZQYu6Q2NmLk9XvR0zTnR5b+d1e5Amn3lvb3ZwLbTHl3zHU6qn5PbKYmNSOmCnlvtEuTDZ0+0/y3dVZdhfRl/ImFN35Z53Dw+BEM5+77bz8rgIRu8QzRLwdmsPkoSm+0s25YR9MmiMKTSWFOrRuOmTTNNv8ldV3c7M0xWmV2T3QHx1P8pzMD2GW64tcqa8cJvrNeJtZo/Ox1P2TOnSdU1GgHxjTPaxnN4S6+Z2RtWQ+eZnGHrPBuaWn9pSKjTzdn382oNcZjmeAnW4aTE/9G3NlNb+Kw9De/uUsQNhik2b52w0sOQLmJqyD5Wd2wZXVEr25/Nv5lBep37Ui9I8K/vO6Ad3AYAR8J0pQvngNwDcIwgTAKgDYQIAdSBMAKAOhAkA1IEwAYA6EKZulNjrhtwNSux1W7RVvy8Wt6rcB1jrdidmr2vfkuK7fca9eTdsr1smfGVos9Zdq3wYB9a63bHFJOAcKSJ5/kqxG4t9Arj8pt+e1rr2fXIhe90l5cN2wVq3Nz/+Ln97hcVOM9fFXI9Uj6nmesV6VrEeWV9sa92YYNnC1ULIQDdNjeLML+qSX9Z9cjHFuzWd8zkA+Hy97fe1bZjlvfeYW8+F2N+0pBdV4qsUyxPqEeHbtC+w1u1qrSsi8l/5902vJNUDCvWUYqLkCxl7uGxeaPEDRO8HvFTd+lt8Wsld8W66eX2+O95v5L+k3tgd/DmvE3X/+Pv8d7LO3Hbn5K0pW4ejgLsJgW9Tgs1uVIC7QBEDPL+X8CCHRT+kdghlfLJzzdNidcfColp8YdqLh7eXks9i44aVle6cA2Aw+35Rvo5p49a6ItZebalQzufHHXoda5PttKl7UoHwDYJU9bOKTkuZooVcE/1GZ3WhXMypMdWmmKNkSRiZE8rl7BVXaxwXY7195eSjfH3k5i8qX0sIpaUdG2EHDpY1jBhTyR3Hus7v3QTzeLqc87KJZnqsask4lV4QpvtAeSiXQ2x9ji+USc0Gtqrb3YMuNSb0Mm7lzfBktdlsNJAqN2frKnfdlF5qZu6WLgqF9cBaF2AEfGeK2EGPCQD2Rt1ygdevz78AAJDH69drt2BT1IVyAAAdIZQDAHUgTACgDoQJANSBMO0ce+1P8Tqggvw9y67JD9sGa90VWdOy1pe355c/ZfiWqtvc0Juqw36G7dLUXSBurZuz+nlt3Dv8QwZtyz9HT8ta91joHJeSu/lzhM0uJ7dtsfJjdWCtuy8G2Z6EbEK0CZZppytEoXS9xL7YIbFKvRbxO0W2Ehm33FIxg/2Ate5KxK7VUstau/dg3rv57XxuunvMTqshV8SWhGBY6+6LO7TW9W17tNS3KNzWx+fyepYKu/vltI3+W5AzXhQaNwoJZkkIiR3vHTDGxGBL1rql7U3Z765nJxKypk15IJn01la3OeW1qgu2zZ1b6y4t3yZU1nrjZ74QqqTnlBpMjs2CLR1ch/tGuTC5e679WlHG9cC12T7ptvyWbT2396lJueXUDjabPLnCkTtWFHsfm8nLKQuR2yn9O2UarXVD7QpZ257rvk0PleXmH29Ze1NmRhiUyuMLxdyQsNQitzScLGnvPCtysIQicBe4E3Km9FO9j9wZtZylA26Y6UvLCSWTbcbFcpMoD+VyiK0t0rI+SjctBCe1JMAnPu65ITGqnX1DlLYLPSYAUAc38QKAOhAmAFAHwgQA6kCYAEAdCBMAqANhAgB1IEwAoA6sdRtxr58boAdNhamVXWxbjB/SUs+lMC0/t6tr03T7iKW7x0Jl1aaX1hvL7/u8vds/Ih2W03Tlt05h6k8z/+6Xf3C7iGm6fu9LL31tv1+SXlN+6edt0c6W7U+lQxua9pjMl/KeREkkbZObX05JnW3La1nvGmVtsX4Is9Lg97Xlrd9+tsSuNmShG7O1TdXZxna3hUjHQgbfL3VJiGF+/c3DlJXqDZT0ELSFPL72hK4DrMRQk5UrXjyMjqf51rK21K425s1UYoebOtaf1F/EPV7y/vx1uzxqyqttR0k+XztL00P19E6HNiiwPXmSx+khsIVTrl1tykIXRG57QSnW6jmE2lmaDttlRWG6iEl4n7YSu1qfhe72xamlOJSGXy3qrSknZ8B/aR2gnHU7bDkhWI5dbchCN2br6wsLr/Nf7Hvrw7mSS+wLU2Lp5tjScnLCo9IQ7J7TYTkYxQGAOjrPyvlmuVptMjmSvXwOgG1AjwkA1MFNvACgDoQJANSBMAGAOhAmAFAHwgQA6kCYAEAdCBMAqCMqTGYRIQDASKLCxNpLAFgDQjkAUAfCBADqSArTPM+MMwHAUJLCdG87ngDA+hDKAYA6ECYAUEeVMDHmBAA9SS6wBAAYTXSXFN+gN4PhANCb4lAOUQKA3jD4DQDqQJgAQB3/BwHB2YJ+kOlCAAAAAElFTkSuQmCC" alt="1548005515777"></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dynamicField</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item_spec_*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>string<span class="token punctuation">&quot;</span></span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>	
</code></pre></div><h2 id="spring-data-solr-入门"><a href="#spring-data-solr-入门" class="header-anchor">#</a> Spring Data Solr 入门</h2> <p>Spring Data Solr就是为了方便Solr的开发所研制的一个框架，其底层是对SolrJ（官方API）的封装。</p> <blockquote><p>官方类库 SolrJ：原理是<strong>RESTful的HTTP请求和响应</strong></p> <p>Spring Data Solr：是对SolrJ的封装</p> <p>也可不使用上述工具，手动请求Solr，手动处理响应，httpClient</p></blockquote> <h3 id="环境搭建-2"><a href="#环境搭建-2" class="header-anchor">#</a> 环境搭建</h3> <ul><li><p>Maven依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.data<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-data-solr<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.5.5.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--Demo中还会用到JUnit和Spring与JUnit整合--&gt;</span>
</code></pre></div></li> <li><p>resources下创建<code>applicationContext-solr.xml</code></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- solr服务器地址，其实就是配置了一个bean --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">solr:</span>solr-server</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>solrServer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://127.0.0.1:8080/solr<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token comment">&lt;!-- solr模板，使用solr模板可对索引库进行CRUD的操作 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>solrTemplate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.springframework.data.solr.core.SolrTemplate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>solrServer<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

</code></pre></div></li></ul> <h3 id="field-、-dynamic注解"><a href="#field-、-dynamic注解" class="header-anchor">#</a> <code>@Field</code> 、<code>@Dynamic</code>注解</h3> <blockquote><p><code>@Field</code>是Solr官方的SolrJ提供的注解，<code>@Dynamic</code>是SpringDataSolr的注解</p></blockquote> <p>创建 cn.itcast.pojo 包，将品优购的TbItem实体类拷入本工程，属性（即Field域）使用<code>@Field</code>注解标识。如果属性与配置文件定义的域名称不一致，需要在注解中指定域名称。（上面Solr中基本域配置和这个对应，复制域不需要，动态域后面讲）</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TbItem</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span><span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Dynamic</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span><span class="token string">&quot;item_spec_*&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> specMap<span class="token punctuation">;</span><span class="token comment">//动态域，在数据导入时需利用fastJSON转换JSON为map</span>

    <span class="token annotation punctuation">@Field</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span><span class="token string">&quot;item_title&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span><span class="token string">&quot;item_price&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> price<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span><span class="token string">&quot;item_image&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> image<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span><span class="token string">&quot;item_goodsid&quot;</span><span class="token punctuation">)</span><span class="token comment">//注意大小写对应solr中配置的基本域</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> goodsId<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span><span class="token string">&quot;item_category&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> category<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span><span class="token string">&quot;item_brand&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> brand<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span><span class="token string">&quot;item_seller&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> seller<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span><span class="token string">&quot;item_updatetime&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span><span class="token comment">//后添加的，排序需要</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="增加（修改）"><a href="#增加（修改）" class="header-anchor">#</a> 增加（修改）</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:applicationContext-solr.xml&quot;</span><span class="token punctuation">)</span><span class="token comment">//可以省略locations</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestTemplate</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SolrTemplate</span> solrTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token class-name">TbItem</span> tbItem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TbItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tbItem<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tbItem<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">&quot;华为Mate10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tbItem<span class="token punctuation">.</span><span class="token function">setCategory</span><span class="token punctuation">(</span><span class="token string">&quot;手机&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tbItem<span class="token punctuation">.</span><span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token string">&quot;华为&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tbItem<span class="token punctuation">.</span><span class="token function">setSeller</span><span class="token punctuation">(</span><span class="token string">&quot;华为旗舰店&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tbItem<span class="token punctuation">.</span><span class="token function">setGoodsId</span><span class="token punctuation">(</span><span class="token number">10L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tbItem<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">4500.00</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        solrTemplate<span class="token punctuation">.</span><span class="token function">saveBean</span><span class="token punctuation">(</span>tbItem<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//增加；修改时只需对象的id（主键，非空）不变，其他修改后save即可</span>
        <span class="token comment">//solrTemplate.saveBeans(collection);（可以传递集合）</span>
        solrTemplate<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//必须commit</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="按主键删除"><a href="#按主键删除" class="header-anchor">#</a> 按主键删除</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    solrTemplate<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//自动转换</span>
    solrTemplate<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="删除所有（条件）"><a href="#删除所有（条件）" class="header-anchor">#</a> 删除所有（条件）</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleQuery</span><span class="token punctuation">(</span><span class="token string">&quot;*:*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    solrTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
    solrTemplate<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="按主键查询"><a href="#按主键查询" class="header-anchor">#</a> 按主键查询</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">TbItem</span> item <span class="token operator">=</span> solrTemplate<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token class-name">TbItem</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="条件查询（含分页查询）"><a href="#条件查询（含分页查询）" class="header-anchor">#</a> 条件查询（含分页查询）</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//条件查询</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleQuery</span><span class="token punctuation">(</span><span class="token string">&quot;*:*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//查询所有字段所有信息（利用封装好的方法，不用写表达式）</span>
    <span class="token class-name">Criteria</span> criteria <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token punctuation">(</span><span class="token string">&quot;item_category&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;手机&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token string">&quot;item_title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    query<span class="token punctuation">.</span><span class="token function">addCriteria</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ScoredPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span></span> items <span class="token operator">=</span> solrTemplate<span class="token punctuation">.</span><span class="token function">queryForPage</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">TbItem</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span></span> content <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//当前页所有数据</span>
    content<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>o<span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;--&quot;</span><span class="token operator">+</span>o<span class="token punctuation">.</span><span class="token function">getBrand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;--&quot;</span><span class="token operator">+</span>o<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;总记录数：&quot;</span><span class="token operator">+</span>items<span class="token punctuation">.</span><span class="token function">getTotalElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;总页数：&quot;</span><span class="token operator">+</span>items<span class="token punctuation">.</span><span class="token function">getTotalPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">//分页</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testQueryPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleQuery</span><span class="token punctuation">(</span><span class="token string">&quot;*:*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//查询所有字段所有信息</span>
    query<span class="token punctuation">.</span><span class="token function">setOffset</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//开始索引</span>
    query<span class="token punctuation">.</span><span class="token function">setRows</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//每页记录数</span>
    <span class="token class-name">ScoredPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span></span> items <span class="token operator">=</span> solrTemplate<span class="token punctuation">.</span><span class="token function">queryForPage</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">TbItem</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span></span> content <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//当前页所有数据</span>
    content<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>o<span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;--&quot;</span><span class="token operator">+</span>o<span class="token punctuation">.</span><span class="token function">getBrand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;--&quot;</span><span class="token operator">+</span>o<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;总记录数：&quot;</span><span class="token operator">+</span>items<span class="token punctuation">.</span><span class="token function">getTotalElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;总页数：&quot;</span><span class="token operator">+</span>items<span class="token punctuation">.</span><span class="token function">getTotalPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">//首先利用saveBeans()方法批量添加数据</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAddList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span></span> list<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">TbItem</span> item<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">TbItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span><span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token string">&quot;华为&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span><span class="token function">setCategory</span><span class="token punctuation">(</span><span class="token string">&quot;手机&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span><span class="token function">setGoodsId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span><span class="token function">setSeller</span><span class="token punctuation">(</span><span class="token string">&quot;华为2号专卖店&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">&quot;华为Mate&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    solrTemplate<span class="token punctuation">.</span><span class="token function">saveBeans</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    solrTemplate<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="批量数据导入"><a href="#批量数据导入" class="header-anchor">#</a> 批量数据导入</h2> <blockquote><p>可以使用Solr自带插件来导入，但不灵活，推荐查询增加的方式，根据条件筛选数据并导入Solr中</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//审核通过才导入</span>
<span class="token class-name">TbItemExample</span> example <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TbItemExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">TbItemExample</span><span class="token punctuation">.</span><span class="token class-name">Criteria</span> criteria <span class="token operator">=</span> example<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">andStatusEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span></span> items <span class="token operator">=</span> itemMapper<span class="token punctuation">.</span><span class="token function">selectByExample</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">TbItem</span> item <span class="token operator">:</span> items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span> specMap <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getSpec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//fastJSON将数据库中json数据转为Map</span>
    item<span class="token punctuation">.</span><span class="token function">setSpecMap</span><span class="token punctuation">(</span>specMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
solrTemplate<span class="token punctuation">.</span><span class="token function">saveBeans</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//saveBeans()</span>
solrTemplate<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="关键字搜索（复制域）"><a href="#关键字搜索（复制域）" class="header-anchor">#</a> 关键字搜索（复制域）</h2> <p><code>ItemSearchServiceImpl</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span>timeout <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token comment">//推荐写在服务提供方。当两方同时写，以消费方为准</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ItemSearchServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">ItemSearchService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SolrTemplate</span> solrTemplate<span class="token punctuation">;</span>
    
    <span class="token comment">//前端传入的数据有多好多类型，如关键字、类型多选框之类的，前端封装为map类似对象</span>
    <span class="token comment">//后端不仅仅返回列表数据，还要返回根据关键字搜索后的分类信息，选择框等等，所以封装为map</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">Map</span> searchMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Query query = new SimpleQuery(&quot;*:*&quot;);//好像不设置&quot;*:*&quot;也可以</span>
        <span class="token comment">//Criteria criteria = new Criteria(&quot;item_keywords&quot;).is(searchMap.get(&quot;keywords&quot;));//is匹配（利用分词实现）</span>
        <span class="token comment">//query.addCriteria(criteria);</span>
        <span class="token class-name">Criteria</span> criteria <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token punctuation">(</span><span class="token string">&quot;item_keywords&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>searchMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;keywords&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//is匹配（利用分词实现）</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleQuery</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ScoredPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span></span> tbItems <span class="token operator">=</span> solrTemplate<span class="token punctuation">.</span><span class="token function">queryForPage</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">TbItem</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span>tbItems<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><code>ItemSearchController</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/itemSearch&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ItemSearchController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Reference</span><span class="token punctuation">(</span>timeout <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token comment">//默认为1秒</span>
    <span class="token keyword">private</span> <span class="token class-name">ItemSearchService</span> itemSearchService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/search&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Map</span> searchMap<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//@RequestBody接收前端json数据</span>
        <span class="token keyword">return</span> itemSearchService<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><code>ItemSearchService.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">&quot;itemSearchService&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">$http</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">search</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">searchMap</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> $http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/itemsearch/search.do&quot;</span><span class="token punctuation">,</span>searchMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p><code>ItemSearchController.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token string">&quot;itemSearchController&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">$scope<span class="token punctuation">,</span>itemSearchService</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $scope<span class="token punctuation">.</span><span class="token function-variable function">search</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        itemSearchService<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>$scope<span class="token punctuation">.</span>searchMap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            $scope<span class="token punctuation">.</span>resultMap <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>HTML遍历展示即可</p> <h2 id="高亮显示关键字搜索（复制域）"><a href="#高亮显示关键字搜索（复制域）" class="header-anchor">#</a> 高亮显示关键字搜索（复制域）</h2> <blockquote><p>高亮显示标题title中的字符</p></blockquote> <p>需要修改关键字搜索中的service方法，其他不变</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">Map</span> searchMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token function">searchList</span><span class="token punctuation">(</span>searchMap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1.查询列表数据</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;categoryList&quot;</span><span class="token punctuation">,</span><span class="token function">searchCategoryList</span><span class="token punctuation">(</span>searchMap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2.分组查询商品分类列表</span>


    <span class="token keyword">return</span> map<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 列表查询
 */</span>
<span class="token keyword">private</span> <span class="token class-name">Map</span> <span class="token function">searchList</span><span class="token punctuation">(</span><span class="token class-name">Map</span> searchMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//关键字的条件查询（利用复制域），相当于where</span>
    <span class="token class-name">Criteria</span> criteria <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token punctuation">(</span><span class="token string">&quot;item_keywords&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>searchMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;keywords&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">HighlightQuery</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleHighlightQuery</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//高亮选项</span>
    <span class="token class-name">HighlightOptions</span> highlightOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HighlightOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addField</span><span class="token punctuation">(</span><span class="token string">&quot;item_title&quot;</span><span class="token punctuation">)</span><span class="token comment">//高亮Filed域</span>
        <span class="token punctuation">.</span><span class="token function">setSimplePrefix</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;span style='color: red;'&gt;&quot;</span><span class="token punctuation">)</span><span class="token comment">//HTML前缀</span>
        <span class="token punctuation">.</span><span class="token function">setSimplePostfix</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/span&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//HTML后缀</span>
    query<span class="token punctuation">.</span><span class="token function">setHighlightOptions</span><span class="token punctuation">(</span>highlightOptions<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置高亮设置</span>
    <span class="token class-name">HighlightPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span></span> items <span class="token operator">=</span> solrTemplate<span class="token punctuation">.</span><span class="token function">queryForHighlightPage</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">TbItem</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//设置高亮</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HighlightEntry</span><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> highlighted <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token function">getHighlighted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//高亮entry集合（每条记录）</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">HighlightEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> highlighted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//高亮列表（高亮Filed域个数可能多个）。并且每个Filed域可能存储多值（此处没有）</span>
        <span class="token class-name">TbItem</span> item <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取源实体类</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HighlightEntry</span><span class="token punctuation">.</span><span class="token class-name">Highlight</span><span class="token punctuation">&gt;</span></span> highlights <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getHighlights</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>highlights<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> highlights<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSnipplets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            item<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>highlights<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSnipplets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> items<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> map<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>但是此时HTML中显示的是HTML代码，不是解析后的页面。这是AngularJS为了防止html攻击采取的安全机制。此时需要用到AngularJS的<code>$sce</code>服务中的<code>trustAsHtml</code>方法。由于该方法具有通用性，定义在<code>filter</code>过滤器中（放入base.js）</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">&quot;trustHtml&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'$sce'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">$sce</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> $sce<span class="token punctuation">.</span><span class="token function">trustAsHtml</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>HTML中就不能使用<code>{{}}</code>来绑定了，需要使用<code>ng-bing-html</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>attr<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ng-bind-html</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item.title | trustHtml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="分组查询"><a href="#分组查询" class="header-anchor">#</a> 分组查询</h2> <p>service中添加私有方法并调用</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 分组查询商品分类列表
 */</span>
<span class="token keyword">private</span> <span class="token class-name">List</span> <span class="token function">searchCategoryList</span><span class="token punctuation">(</span><span class="token class-name">Map</span> searchMap<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//关键字的条件查询（利用复制域），相当于where</span>
    <span class="token class-name">Criteria</span> criteria <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token punctuation">(</span><span class="token string">&quot;item_keywords&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>searchMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;keywords&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleQuery</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设置分组选项，相当于group by。可能有多个分组（继续addGroupByField即可）</span>
    <span class="token class-name">GroupOptions</span> groupOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GroupOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addGroupByField</span><span class="token punctuation">(</span><span class="token string">&quot;item_category&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    query<span class="token punctuation">.</span><span class="token function">setGroupOptions</span><span class="token punctuation">(</span>groupOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//分组页</span>
    <span class="token class-name">GroupPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span></span> items <span class="token operator">=</span> solrTemplate<span class="token punctuation">.</span><span class="token function">queryForGroupPage</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">TbItem</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//分组结果</span>
    <span class="token class-name">GroupResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span></span> item_category <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token function">getGroupResult</span><span class="token punctuation">(</span><span class="token string">&quot;item_category&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//分组entry页</span>
    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GroupEntry</span><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> groupEntries <span class="token operator">=</span> item_category<span class="token punctuation">.</span><span class="token function">getGroupEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//分组entryj集合，便利获取值</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GroupEntry</span><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> content <span class="token operator">=</span> groupEntries<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">GroupEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span></span> tbItemGroupEntry <span class="token operator">:</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tbItemGroupEntry<span class="token punctuation">.</span><span class="token function">getGroupValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> list<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>HTML中遍历</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ng-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>resultMap.categoryList!=null<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">ng-repeat</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>category in resultMap.categoryList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#{{$index}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{category}} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="过滤查询（以上所有代码）"><a href="#过滤查询（以上所有代码）" class="header-anchor">#</a> 过滤查询（以上所有代码）</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span>timeout <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token comment">//推荐写在服务提供方。所两方同时写，以消费方为准</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ItemSearchServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">ItemSearchService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SolrTemplate</span> solrTemplate<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 搜索
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">Map</span> searchMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//去掉搜索关键字中的空格</span>
        <span class="token class-name">String</span>  keywords <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> searchMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;keywords&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;keywords&quot;</span><span class="token punctuation">,</span>keywords<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">Map</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//1.查询列表数据</span>
        map<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token function">searchList</span><span class="token punctuation">(</span>searchMap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.分组查询商品分类列表</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> categoryList <span class="token operator">=</span> <span class="token function">searchCategoryList</span><span class="token punctuation">(</span>searchMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;categoryList&quot;</span><span class="token punctuation">,</span> categoryList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.根据分类名称查询品牌和规格列表</span>
        <span class="token class-name">String</span> category <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> searchMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;category&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>category<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//若没选择分类，按第一个分类查询</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>categoryList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                map<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token function">searchBrandAndSpecList</span><span class="token punctuation">(</span>categoryList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">//若选择了分类，按选择的分类名称查询</span>
            map<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token function">searchBrandAndSpecList</span><span class="token punctuation">(</span>category<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 列表查询（过滤查询等等）
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span> <span class="token function">searchList</span><span class="token punctuation">(</span><span class="token class-name">Map</span> searchMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//1.1关键字查询（利用复制域）</span>
        <span class="token class-name">Criteria</span> criteria <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token punctuation">(</span><span class="token string">&quot;item_keywords&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>searchMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;keywords&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HighlightQuery</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleHighlightQuery</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//高亮选项设置</span>
        <span class="token class-name">HighlightOptions</span> highlightOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HighlightOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addField</span><span class="token punctuation">(</span><span class="token string">&quot;item_title&quot;</span><span class="token punctuation">)</span><span class="token comment">//高亮Filed域</span>
            <span class="token punctuation">.</span><span class="token function">setSimplePrefix</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;span style='color: red;'&gt;&quot;</span><span class="token punctuation">)</span><span class="token comment">//HTML前缀</span>
            <span class="token punctuation">.</span><span class="token function">setSimplePostfix</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/span&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//HTML后缀</span>
        query<span class="token punctuation">.</span><span class="token function">setHighlightOptions</span><span class="token punctuation">(</span>highlightOptions<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置高亮设置</span>

        <span class="token comment">//1.2按照商品分类过滤</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>searchMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;category&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//若用户选择了分类</span>
            <span class="token class-name">Criteria</span> filterCriteria <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token punctuation">(</span><span class="token string">&quot;item_category&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>searchMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;category&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">FilterQuery</span> filterQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleFilterQuery</span><span class="token punctuation">(</span>filterCriteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
            query<span class="token punctuation">.</span><span class="token function">addFilterQuery</span><span class="token punctuation">(</span>filterQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//1.3按照品牌过滤</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>searchMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;brand&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//若用户选择了品牌</span>
            <span class="token class-name">Criteria</span> filterCriteria <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token punctuation">(</span><span class="token string">&quot;item_brand&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>searchMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;brand&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">FilterQuery</span> filterQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleFilterQuery</span><span class="token punctuation">(</span>filterCriteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
            query<span class="token punctuation">.</span><span class="token function">addFilterQuery</span><span class="token punctuation">(</span>filterQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//1.4按照规格过滤</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>searchMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;spec&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//若用户选择了规格</span>

            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> specMap <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> searchMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;spec&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token class-name">Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> entries <span class="token operator">=</span> specMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> entries<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;====&quot;</span> <span class="token operator">+</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Criteria</span> filterCriteria <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token punctuation">(</span><span class="token string">&quot;item_spec_&quot;</span> <span class="token operator">+</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">FilterQuery</span> filterQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleFilterQuery</span><span class="token punctuation">(</span>filterCriteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
                query<span class="token punctuation">.</span><span class="token function">addFilterQuery</span><span class="token punctuation">(</span>filterQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">//1.5按照价格过滤</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>searchMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">String</span> price <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> searchMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> split <span class="token operator">=</span> price<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Criteria</span> filterCriteria <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token punctuation">(</span><span class="token string">&quot;item_price&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>split<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//起始条件</span>
                filterCriteria<span class="token punctuation">.</span><span class="token function">greaterThanEqual</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//大于等于</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//终止条件</span>
                filterCriteria<span class="token punctuation">.</span><span class="token function">lessThanEqual</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//小于等于</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">FilterQuery</span> filterQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleFilterQuery</span><span class="token punctuation">(</span>filterCriteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
            query<span class="token punctuation">.</span><span class="token function">addFilterQuery</span><span class="token punctuation">(</span>filterQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">//1.6分页</span>
        <span class="token class-name">Integer</span> pageNum <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> searchMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;pageNum&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//当前页</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pageNum<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            pageNum <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Integer</span> pageSize <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> searchMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;pageSize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//每页记录数</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pageSize<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            pageSize <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        query<span class="token punctuation">.</span><span class="token function">setOffset</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pageNum<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//起始索引（不是页码）</span>
        query<span class="token punctuation">.</span><span class="token function">setRows</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//每页记录数</span>
        <span class="token comment">//在最后返回getContent()后还需传递pages、total；</span>

        <span class="token comment">//1.7排序（根据传入的Field字段）</span>
        <span class="token class-name">String</span>  sortValue <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> searchMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;sort&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//升序或降序</span>
        <span class="token class-name">String</span> sortField <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> searchMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;sortField&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//排序的Field字段</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sortValue<span class="token operator">!=</span><span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>sortValue<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>sortValue<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;ASC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">Sort</span> sort <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sort</span><span class="token punctuation">(</span><span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token class-name">Direction</span><span class="token punctuation">.</span>ASC<span class="token punctuation">,</span><span class="token string">&quot;item_&quot;</span><span class="token operator">+</span>sortField<span class="token punctuation">)</span><span class="token punctuation">;</span>
                query<span class="token punctuation">.</span><span class="token function">addSort</span><span class="token punctuation">(</span>sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sortValue<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;DESC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">Sort</span> sort <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sort</span><span class="token punctuation">(</span><span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token class-name">Direction</span><span class="token punctuation">.</span>DESC<span class="token punctuation">,</span><span class="token string">&quot;item_&quot;</span><span class="token operator">+</span>sortField<span class="token punctuation">)</span><span class="token punctuation">;</span>
                query<span class="token punctuation">.</span><span class="token function">addSort</span><span class="token punctuation">(</span>sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">//高亮页对象</span>
        <span class="token class-name">HighlightPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span></span> items <span class="token operator">=</span> solrTemplate<span class="token punctuation">.</span><span class="token function">queryForHighlightPage</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">TbItem</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//遍历并设置高亮</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HighlightEntry</span><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> highlighted <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token function">getHighlighted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//高亮entry集合（每条记录）</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">HighlightEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> highlighted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//高亮列表（高亮Filed域个数可能多个）。并且每个Filed域可能存储多值（此处没有）</span>
            <span class="token class-name">TbItem</span> item <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取源实体类</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HighlightEntry</span><span class="token punctuation">.</span><span class="token class-name">Highlight</span><span class="token punctuation">&gt;</span></span> highlights <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getHighlights</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>highlights<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> highlights<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSnipplets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                item<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>highlights<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSnipplets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> items<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//当前页所有数据</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;pages&quot;</span><span class="token punctuation">,</span>items<span class="token punctuation">.</span><span class="token function">getTotalPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//总页数</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;total&quot;</span><span class="token punctuation">,</span>items<span class="token punctuation">.</span><span class="token function">getTotalElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//总记录数</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 分组查询商品分类列表
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span> <span class="token function">searchCategoryList</span><span class="token punctuation">(</span><span class="token class-name">Map</span> searchMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关键字的条件查询（利用复制域），相当于where</span>
        <span class="token class-name">Criteria</span> criteria <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token punctuation">(</span><span class="token string">&quot;item_keywords&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>searchMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;keywords&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleQuery</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置分组选项，相当于group by。可能有多个分组（继续addGroupByField即可）</span>
        <span class="token class-name">GroupOptions</span> groupOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GroupOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addGroupByField</span><span class="token punctuation">(</span><span class="token string">&quot;item_category&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        query<span class="token punctuation">.</span><span class="token function">setGroupOptions</span><span class="token punctuation">(</span>groupOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//分组页</span>
        <span class="token class-name">GroupPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span></span> items <span class="token operator">=</span> solrTemplate<span class="token punctuation">.</span><span class="token function">queryForGroupPage</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">TbItem</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//分组结果</span>
        <span class="token class-name">GroupResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span></span> item_category <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token function">getGroupResult</span><span class="token punctuation">(</span><span class="token string">&quot;item_category&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//分组entry页</span>
        <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GroupEntry</span><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> groupEntries <span class="token operator">=</span> item_category<span class="token punctuation">.</span><span class="token function">getGroupEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//分组entryj集合，便利获取值</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GroupEntry</span><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> content <span class="token operator">=</span> groupEntries<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">GroupEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TbItem</span><span class="token punctuation">&gt;</span></span> tbItemGroupEntry <span class="token operator">:</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tbItemGroupEntry<span class="token punctuation">.</span><span class="token function">getGroupValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> list<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token comment">/**
     * Redis查询品牌和规格列表
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span> <span class="token function">searchBrandAndSpecList</span><span class="token punctuation">(</span><span class="token class-name">String</span> categoryName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//1.根据商品分类名称得到模板id</span>
        <span class="token class-name">Long</span> categoryId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundHashOps</span><span class="token punctuation">(</span><span class="token string">&quot;itemCat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>categoryName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>categoryId <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//2.根据模板id获取品牌列表</span>
            <span class="token class-name">List</span> brandList <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundHashOps</span><span class="token punctuation">(</span><span class="token string">&quot;brandList&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>categoryId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;brandList&quot;</span><span class="token punctuation">,</span> brandList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//3.根据模板id获取规格列表</span>
            <span class="token class-name">List</span> specdList <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundHashOps</span><span class="token punctuation">(</span><span class="token string">&quot;specList&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>categoryId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;specList&quot;</span><span class="token punctuation">,</span> specdList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//审核通过时导入SKU数据</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">importList</span><span class="token punctuation">(</span><span class="token class-name">List</span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
        solrTemplate<span class="token punctuation">.</span><span class="token function">saveBeans</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
        solrTemplate<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//删除商品时同时删除solr中数据</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteByGoodsIds</span><span class="token punctuation">(</span><span class="token class-name">List</span> goodsIds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Criteria</span> criteria <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Criteria</span><span class="token punctuation">(</span><span class="token string">&quot;item_goodsid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span>goodsIds<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleQuery</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
        solrTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
        solrTemplate<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="更新索引库"><a href="#更新索引库" class="header-anchor">#</a> 更新索引库</h2> <blockquote><p>实时更新solr库，而不总是批量导入。还需实现删除方法。查看7中代码。理解即可</p></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/apple54whn/notes/edit/master/docs/DataBase/Solr/0 Primer.md" target="_blank" rel="noopener noreferrer">编辑文档！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">4/20/2020, 1:13:01 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.4c2406b8.js" defer></script><script src="/assets/js/2.4ce794f3.js" defer></script><script src="/assets/js/52.d3c5f8e8.js" defer></script><script src="/assets/js/33.9b523a1b.js" defer></script>
  </body>
</html>
