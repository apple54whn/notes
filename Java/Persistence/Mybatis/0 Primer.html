<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MyBatis | Conanan</title>
    <meta name="description" content="Good Good Study, Day Day Up!">
    <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    
    <link rel="preload" href="/assets/css/0.styles.721694fb.css" as="style"><link rel="preload" href="/assets/js/app.4c2406b8.js" as="script"><link rel="preload" href="/assets/js/2.4ce794f3.js" as="script"><link rel="preload" href="/assets/js/162.bbdff718.js" as="script"><link rel="preload" href="/assets/js/33.9b523a1b.js" as="script"><link rel="prefetch" href="/assets/js/10.23584843.js"><link rel="prefetch" href="/assets/js/100.c8b7e6eb.js"><link rel="prefetch" href="/assets/js/101.22710827.js"><link rel="prefetch" href="/assets/js/102.369790c1.js"><link rel="prefetch" href="/assets/js/103.a7c7b572.js"><link rel="prefetch" href="/assets/js/104.7e45de8b.js"><link rel="prefetch" href="/assets/js/105.4791b02d.js"><link rel="prefetch" href="/assets/js/106.61e23a2f.js"><link rel="prefetch" href="/assets/js/107.8ae0e37f.js"><link rel="prefetch" href="/assets/js/108.ad785e65.js"><link rel="prefetch" href="/assets/js/109.f6c3b7e5.js"><link rel="prefetch" href="/assets/js/11.1af6c419.js"><link rel="prefetch" href="/assets/js/110.55979e31.js"><link rel="prefetch" href="/assets/js/111.09bcf468.js"><link rel="prefetch" href="/assets/js/112.17a7c3b1.js"><link rel="prefetch" href="/assets/js/113.9f55e6f6.js"><link rel="prefetch" href="/assets/js/114.ae0d1063.js"><link rel="prefetch" href="/assets/js/115.2b45ae89.js"><link rel="prefetch" href="/assets/js/116.286c2ead.js"><link rel="prefetch" href="/assets/js/117.bd5437e0.js"><link rel="prefetch" href="/assets/js/118.4dd27249.js"><link rel="prefetch" href="/assets/js/119.7be1a2b0.js"><link rel="prefetch" href="/assets/js/12.bc5e4411.js"><link rel="prefetch" href="/assets/js/120.03a04cae.js"><link rel="prefetch" href="/assets/js/121.b657ffcb.js"><link rel="prefetch" href="/assets/js/122.eb76f0ee.js"><link rel="prefetch" href="/assets/js/123.cebd7ceb.js"><link rel="prefetch" href="/assets/js/124.be49618b.js"><link rel="prefetch" href="/assets/js/125.d7aa08e6.js"><link rel="prefetch" href="/assets/js/126.4ad7d0d8.js"><link rel="prefetch" href="/assets/js/127.fe7a1fc9.js"><link rel="prefetch" href="/assets/js/128.18adee58.js"><link rel="prefetch" href="/assets/js/129.65155f32.js"><link rel="prefetch" href="/assets/js/13.46b8bbae.js"><link rel="prefetch" href="/assets/js/130.115199fd.js"><link rel="prefetch" href="/assets/js/131.c30c37e8.js"><link rel="prefetch" href="/assets/js/132.800d09de.js"><link rel="prefetch" href="/assets/js/133.485f2c5a.js"><link rel="prefetch" href="/assets/js/134.68cc802a.js"><link rel="prefetch" href="/assets/js/135.b48b5611.js"><link rel="prefetch" href="/assets/js/136.273edc30.js"><link rel="prefetch" href="/assets/js/137.c51bf33b.js"><link rel="prefetch" href="/assets/js/138.cc73926e.js"><link rel="prefetch" href="/assets/js/139.7f0835b0.js"><link rel="prefetch" href="/assets/js/14.813fdf39.js"><link rel="prefetch" href="/assets/js/140.4b5c8664.js"><link rel="prefetch" href="/assets/js/141.f645668a.js"><link rel="prefetch" href="/assets/js/142.9c31754b.js"><link rel="prefetch" href="/assets/js/143.8dbb577a.js"><link rel="prefetch" href="/assets/js/144.615f3d5a.js"><link rel="prefetch" href="/assets/js/145.3372b6f7.js"><link rel="prefetch" href="/assets/js/146.9d166547.js"><link rel="prefetch" href="/assets/js/147.b35e2060.js"><link rel="prefetch" href="/assets/js/148.2ca9cb36.js"><link rel="prefetch" href="/assets/js/149.b7aae87e.js"><link rel="prefetch" href="/assets/js/15.c027e524.js"><link rel="prefetch" href="/assets/js/150.bad9858c.js"><link rel="prefetch" href="/assets/js/151.fd17d6b4.js"><link rel="prefetch" href="/assets/js/152.2567ef97.js"><link rel="prefetch" href="/assets/js/153.74559d88.js"><link rel="prefetch" href="/assets/js/154.7acecdef.js"><link rel="prefetch" href="/assets/js/155.f457419c.js"><link rel="prefetch" href="/assets/js/156.6fe3ee1a.js"><link rel="prefetch" href="/assets/js/157.fd08fd72.js"><link rel="prefetch" href="/assets/js/158.2b46cf37.js"><link rel="prefetch" href="/assets/js/159.3ace6e8d.js"><link rel="prefetch" href="/assets/js/16.485682dd.js"><link rel="prefetch" href="/assets/js/160.512cf1fa.js"><link rel="prefetch" href="/assets/js/161.0d0ee2ea.js"><link rel="prefetch" href="/assets/js/163.4fdc9dff.js"><link rel="prefetch" href="/assets/js/164.20d6ef11.js"><link rel="prefetch" href="/assets/js/165.2881201e.js"><link rel="prefetch" href="/assets/js/166.3c7c3ba0.js"><link rel="prefetch" href="/assets/js/167.2143078a.js"><link rel="prefetch" href="/assets/js/168.9f3840f3.js"><link rel="prefetch" href="/assets/js/169.2da8b99f.js"><link rel="prefetch" href="/assets/js/17.53e3a4c9.js"><link rel="prefetch" href="/assets/js/170.997a014a.js"><link rel="prefetch" href="/assets/js/171.addd9a55.js"><link rel="prefetch" href="/assets/js/172.d3d12b0c.js"><link rel="prefetch" href="/assets/js/173.ebd6be51.js"><link rel="prefetch" href="/assets/js/174.c3546734.js"><link rel="prefetch" href="/assets/js/175.e786b04c.js"><link rel="prefetch" href="/assets/js/176.8a72d21e.js"><link rel="prefetch" href="/assets/js/177.4d74c35d.js"><link rel="prefetch" href="/assets/js/178.05b55aba.js"><link rel="prefetch" href="/assets/js/179.06c93c02.js"><link rel="prefetch" href="/assets/js/18.dac780ce.js"><link rel="prefetch" href="/assets/js/180.7a721d6a.js"><link rel="prefetch" href="/assets/js/181.854b3f72.js"><link rel="prefetch" href="/assets/js/182.19f58d6b.js"><link rel="prefetch" href="/assets/js/183.8f49d5b6.js"><link rel="prefetch" href="/assets/js/184.2128f02f.js"><link rel="prefetch" href="/assets/js/19.5bd66b43.js"><link rel="prefetch" href="/assets/js/20.8b0be400.js"><link rel="prefetch" href="/assets/js/21.26154688.js"><link rel="prefetch" href="/assets/js/22.75f3ad5d.js"><link rel="prefetch" href="/assets/js/23.205b8a93.js"><link rel="prefetch" href="/assets/js/24.78eaf948.js"><link rel="prefetch" href="/assets/js/25.5ac44d02.js"><link rel="prefetch" href="/assets/js/26.44e96c5e.js"><link rel="prefetch" href="/assets/js/27.9149de82.js"><link rel="prefetch" href="/assets/js/28.a117fe70.js"><link rel="prefetch" href="/assets/js/29.03c4dd26.js"><link rel="prefetch" href="/assets/js/3.a07e7c66.js"><link rel="prefetch" href="/assets/js/30.add3b4ce.js"><link rel="prefetch" href="/assets/js/31.c168f15b.js"><link rel="prefetch" href="/assets/js/32.6df3dd67.js"><link rel="prefetch" href="/assets/js/34.87d0684d.js"><link rel="prefetch" href="/assets/js/35.07031e68.js"><link rel="prefetch" href="/assets/js/36.b2d8e023.js"><link rel="prefetch" href="/assets/js/37.6693f2b8.js"><link rel="prefetch" href="/assets/js/38.0adc87b6.js"><link rel="prefetch" href="/assets/js/39.4ee1b450.js"><link rel="prefetch" href="/assets/js/4.3601d982.js"><link rel="prefetch" href="/assets/js/40.3a15c4d2.js"><link rel="prefetch" href="/assets/js/41.5089de95.js"><link rel="prefetch" href="/assets/js/42.b6c516e6.js"><link rel="prefetch" href="/assets/js/43.4d729b64.js"><link rel="prefetch" href="/assets/js/44.afb6ada5.js"><link rel="prefetch" href="/assets/js/45.f90fef77.js"><link rel="prefetch" href="/assets/js/46.3f992a07.js"><link rel="prefetch" href="/assets/js/47.3df4792a.js"><link rel="prefetch" href="/assets/js/48.b1b42695.js"><link rel="prefetch" href="/assets/js/49.1f57735c.js"><link rel="prefetch" href="/assets/js/5.c77010ac.js"><link rel="prefetch" href="/assets/js/50.fb1f131c.js"><link rel="prefetch" href="/assets/js/51.621e6bbe.js"><link rel="prefetch" href="/assets/js/52.d3c5f8e8.js"><link rel="prefetch" href="/assets/js/53.fc428b5d.js"><link rel="prefetch" href="/assets/js/54.a8c7b4e7.js"><link rel="prefetch" href="/assets/js/55.9491ad4c.js"><link rel="prefetch" href="/assets/js/56.cc5535aa.js"><link rel="prefetch" href="/assets/js/57.08a4a942.js"><link rel="prefetch" href="/assets/js/58.ea5e0d13.js"><link rel="prefetch" href="/assets/js/59.e9ab1cc2.js"><link rel="prefetch" href="/assets/js/6.3dc37407.js"><link rel="prefetch" href="/assets/js/60.a0651ffe.js"><link rel="prefetch" href="/assets/js/61.9657adee.js"><link rel="prefetch" href="/assets/js/62.5522a97a.js"><link rel="prefetch" href="/assets/js/63.2c5c6db3.js"><link rel="prefetch" href="/assets/js/64.57e79c12.js"><link rel="prefetch" href="/assets/js/65.5e0e9f19.js"><link rel="prefetch" href="/assets/js/66.e80de9ef.js"><link rel="prefetch" href="/assets/js/67.147e8e38.js"><link rel="prefetch" href="/assets/js/68.26a3c0d4.js"><link rel="prefetch" href="/assets/js/69.8f293aac.js"><link rel="prefetch" href="/assets/js/7.53864b7a.js"><link rel="prefetch" href="/assets/js/70.291565bb.js"><link rel="prefetch" href="/assets/js/71.fe0bdf0f.js"><link rel="prefetch" href="/assets/js/72.61d2bc84.js"><link rel="prefetch" href="/assets/js/73.9fcb62aa.js"><link rel="prefetch" href="/assets/js/74.9d682c13.js"><link rel="prefetch" href="/assets/js/75.3264a4ce.js"><link rel="prefetch" href="/assets/js/76.1f8b1f97.js"><link rel="prefetch" href="/assets/js/77.32b48d28.js"><link rel="prefetch" href="/assets/js/78.b50a8708.js"><link rel="prefetch" href="/assets/js/79.e9abf630.js"><link rel="prefetch" href="/assets/js/8.50c01faa.js"><link rel="prefetch" href="/assets/js/80.180a3806.js"><link rel="prefetch" href="/assets/js/81.7800a9ae.js"><link rel="prefetch" href="/assets/js/82.388bd268.js"><link rel="prefetch" href="/assets/js/83.27d7c820.js"><link rel="prefetch" href="/assets/js/84.a7be62b6.js"><link rel="prefetch" href="/assets/js/85.e286c095.js"><link rel="prefetch" href="/assets/js/86.84fed10f.js"><link rel="prefetch" href="/assets/js/87.4b95dccb.js"><link rel="prefetch" href="/assets/js/88.dd70f5b5.js"><link rel="prefetch" href="/assets/js/89.4a04d404.js"><link rel="prefetch" href="/assets/js/9.947b77c2.js"><link rel="prefetch" href="/assets/js/90.699f3eeb.js"><link rel="prefetch" href="/assets/js/91.9f21bc4f.js"><link rel="prefetch" href="/assets/js/92.8e8caa65.js"><link rel="prefetch" href="/assets/js/93.08b1a369.js"><link rel="prefetch" href="/assets/js/94.8aa7234f.js"><link rel="prefetch" href="/assets/js/95.1d25fc22.js"><link rel="prefetch" href="/assets/js/96.8bb62cc7.js"><link rel="prefetch" href="/assets/js/97.eed16352.js"><link rel="prefetch" href="/assets/js/98.623e948b.js"><link rel="prefetch" href="/assets/js/99.45cfef32.js">
    <link rel="stylesheet" href="/assets/css/0.styles.721694fb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Conanan</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Basic" class="dropdown-title"><span class="title">Basic</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>OS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Basic/OS/Linux/0 Intro.html" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/Basic/OS/Docker/0 Docker.html" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/Basic/OS/K8/0 Intro.html" class="nav-link">K8</a></li></ul></li><li class="dropdown-item"><h4>Network</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Basic/Network/TCP/IP/0 Intro.html" class="nav-link">TCP/IP</a></li><li class="dropdown-subitem"><a href="/Basic/Network/HTTP/0 Intro.html" class="nav-link">HTTP</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DataBase" class="dropdown-title"><span class="title">DataBase</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/DataBase/RDBMS/0 Primer.html" class="nav-link">RDBMS</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Redis/0 Intro.html" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Mongo/0 Intro.html" class="nav-link">Mongo</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Lucene/0 Primer.html" class="nav-link">Lucene</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Solr/0 Primer.html" class="nav-link">Solr</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Elasticsearch/0 Primer.html" class="nav-link">Elasticsearch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Design" class="dropdown-title"><span class="title">Design</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Design/Design Pattern/0 Intro.html" class="nav-link">Design Pattern</a></li><li class="dropdown-item"><!----> <a href="/Design/DDD/0 Basic.html" class="nav-link">DDD</a></li><li class="dropdown-item"><!----> <a href="/Design/MicroServer/0 Intro.html" class="nav-link">MicroServer</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java Study" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/Core/0 Basic.html" class="nav-link">Core</a></li><li class="dropdown-item"><!----> <a href="/Java/Jakarta EE/0 Servlet.html" class="nav-link">Jakarta EE</a></li><li class="dropdown-item"><!----> <a href="/Java/Spring/primer/0 Primer.html" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/Java/Persistence/Mybatis/0 Primer.html" class="nav-link">Persistence</a></li><li class="dropdown-item"><!----> <a href="/Java/Authe&amp;Autho/0 Primer.html" class="nav-link">认证&amp;授权</a></li><li class="dropdown-item"><h4>分布式&amp;微服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese/" class="nav-link">Dubbo</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">Spring Cloud Netflix</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">Spring Cloud Alibaba</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tools" class="dropdown-title"><span class="title">Tools</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Tools/Vim/Vim.html" class="nav-link">Vim</a></li><li class="dropdown-item"><!----> <a href="/Tools/Git/Git.html" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/Tools/Maven/Maven.html" class="nav-link">Maven</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Server" class="dropdown-title"><span class="title">Server</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Server/Tomcat/0 Primer.html" class="nav-link">Tomcat</a></li><li class="dropdown-item"><!----> <a href="/Server/Nginx/0 Primer.html" class="nav-link">Nginx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Front End" class="dropdown-title"><span class="title">Front End</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Front End/H5&amp;CSS3/1 HTML.html" class="nav-link">H5&amp;CSS3</a></li><li class="dropdown-item"><!----> <a href="/Front End/JS/0 入门-0 入门.html" class="nav-link">JS</a></li><li class="dropdown-item"><!----> <a href="/Front End/NodeJS/NodeJS-1 入门.html" class="nav-link">NodeJS</a></li><li class="dropdown-item"><!----> <a href="/Front End/Vue/1-1 Primer.html" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/Front End/微信小程序/1-1 Primer.html" class="nav-link">微信小程序</a></li><li class="dropdown-item"><!----> <a href="/Front End/Android/0 Intro.html" class="nav-link">Android</a></li><li class="dropdown-item"><!----> <a href="/Front End/Flutter/0 Intro.html" class="nav-link">Flutter</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Environment" class="dropdown-title"><span class="title">Environment</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Environment/macOS/macOS.html" class="nav-link">macOS</a></li><li class="dropdown-item"><!----> <a href="/Environment/Windows/Windows.html" class="nav-link">Windows</a></li><li class="dropdown-item"><!----> <a href="/Environment/Software/IDEA.html" class="nav-link">Software</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Project" class="dropdown-title"><span class="title">Project</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Project/电商/简介.html" class="nav-link">电商</a></li><li class="dropdown-item"><!----> <a href="/Environment/Linux/Linux.html" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/Environment/Windows/Windows.html" class="nav-link">Windows</a></li><li class="dropdown-item"><!----> <a href="/Environment/Software/Software.html" class="nav-link">Software</a></li></ul></div></div> <a href="https://github.com/apple54whn/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Basic" class="dropdown-title"><span class="title">Basic</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>OS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Basic/OS/Linux/0 Intro.html" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/Basic/OS/Docker/0 Docker.html" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/Basic/OS/K8/0 Intro.html" class="nav-link">K8</a></li></ul></li><li class="dropdown-item"><h4>Network</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Basic/Network/TCP/IP/0 Intro.html" class="nav-link">TCP/IP</a></li><li class="dropdown-subitem"><a href="/Basic/Network/HTTP/0 Intro.html" class="nav-link">HTTP</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DataBase" class="dropdown-title"><span class="title">DataBase</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/DataBase/RDBMS/0 Primer.html" class="nav-link">RDBMS</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Redis/0 Intro.html" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Mongo/0 Intro.html" class="nav-link">Mongo</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Lucene/0 Primer.html" class="nav-link">Lucene</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Solr/0 Primer.html" class="nav-link">Solr</a></li><li class="dropdown-item"><!----> <a href="/DataBase/Elasticsearch/0 Primer.html" class="nav-link">Elasticsearch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Design" class="dropdown-title"><span class="title">Design</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Design/Design Pattern/0 Intro.html" class="nav-link">Design Pattern</a></li><li class="dropdown-item"><!----> <a href="/Design/DDD/0 Basic.html" class="nav-link">DDD</a></li><li class="dropdown-item"><!----> <a href="/Design/MicroServer/0 Intro.html" class="nav-link">MicroServer</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java Study" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/Core/0 Basic.html" class="nav-link">Core</a></li><li class="dropdown-item"><!----> <a href="/Java/Jakarta EE/0 Servlet.html" class="nav-link">Jakarta EE</a></li><li class="dropdown-item"><!----> <a href="/Java/Spring/primer/0 Primer.html" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/Java/Persistence/Mybatis/0 Primer.html" class="nav-link">Persistence</a></li><li class="dropdown-item"><!----> <a href="/Java/Authe&amp;Autho/0 Primer.html" class="nav-link">认证&amp;授权</a></li><li class="dropdown-item"><h4>分布式&amp;微服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese/" class="nav-link">Dubbo</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">Spring Cloud Netflix</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">Spring Cloud Alibaba</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tools" class="dropdown-title"><span class="title">Tools</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Tools/Vim/Vim.html" class="nav-link">Vim</a></li><li class="dropdown-item"><!----> <a href="/Tools/Git/Git.html" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/Tools/Maven/Maven.html" class="nav-link">Maven</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Server" class="dropdown-title"><span class="title">Server</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Server/Tomcat/0 Primer.html" class="nav-link">Tomcat</a></li><li class="dropdown-item"><!----> <a href="/Server/Nginx/0 Primer.html" class="nav-link">Nginx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Front End" class="dropdown-title"><span class="title">Front End</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Front End/H5&amp;CSS3/1 HTML.html" class="nav-link">H5&amp;CSS3</a></li><li class="dropdown-item"><!----> <a href="/Front End/JS/0 入门-0 入门.html" class="nav-link">JS</a></li><li class="dropdown-item"><!----> <a href="/Front End/NodeJS/NodeJS-1 入门.html" class="nav-link">NodeJS</a></li><li class="dropdown-item"><!----> <a href="/Front End/Vue/1-1 Primer.html" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/Front End/微信小程序/1-1 Primer.html" class="nav-link">微信小程序</a></li><li class="dropdown-item"><!----> <a href="/Front End/Android/0 Intro.html" class="nav-link">Android</a></li><li class="dropdown-item"><!----> <a href="/Front End/Flutter/0 Intro.html" class="nav-link">Flutter</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Environment" class="dropdown-title"><span class="title">Environment</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Environment/macOS/macOS.html" class="nav-link">macOS</a></li><li class="dropdown-item"><!----> <a href="/Environment/Windows/Windows.html" class="nav-link">Windows</a></li><li class="dropdown-item"><!----> <a href="/Environment/Software/IDEA.html" class="nav-link">Software</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Project" class="dropdown-title"><span class="title">Project</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Project/电商/简介.html" class="nav-link">电商</a></li><li class="dropdown-item"><!----> <a href="/Environment/Linux/Linux.html" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/Environment/Windows/Windows.html" class="nav-link">Windows</a></li><li class="dropdown-item"><!----> <a href="/Environment/Software/Software.html" class="nav-link">Software</a></li></ul></div></div> <a href="https://github.com/apple54whn/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Mybatis</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Java/Persistence/Mybatis/0 Primer.html" class="active sidebar-link">MyBatis</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_1-入门" class="sidebar-link">1 入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_1-1-maven依赖" class="sidebar-link">1.1 Maven依赖</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_1-2-mybatis-config-xml" class="sidebar-link">1.2 mybatis-config.xml</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_1-3-实体类、mapper-dao-接口" class="sidebar-link">1.3 实体类、Mapper(Dao)接口</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_1-4-mapper-xml" class="sidebar-link">1.4 Mapper.xml</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_1-5-注解mapper接口" class="sidebar-link">1.5 注解Mapper接口</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_1-6-dao实现类开发" class="sidebar-link">~~1.6 Dao实现类开发~~</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_1-7-sqlsession" class="sidebar-link">1.7 SqlSession</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_1-8-输入映射与输出映射" class="sidebar-link">1.8 输入映射与输出映射</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#补充" class="sidebar-link">补充</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#案例" class="sidebar-link">案例</a></li></ul></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_2-mybatis中连接池和事务" class="sidebar-link">2 Mybatis中连接池和事务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_2-1-连接池" class="sidebar-link">2.1 连接池</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_2-2-事务" class="sidebar-link">2.2 事务</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_2-3-jndi" class="sidebar-link">2.3 JNDI</a></li></ul></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_3-xml映射文件的动态sql语句" class="sidebar-link">3 XML映射文件的动态SQL语句</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_3-1-if、where、set" class="sidebar-link">3.1 if、where、set</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_3-2-foreach" class="sidebar-link">3.2 foreach</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_3-3-sql片段（了解）" class="sidebar-link">3.3 sql片段（了解）</a></li></ul></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_4-mybatis中多表查询" class="sidebar-link">4 MyBatis中多表查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_4-1-一对一（多对一）-association" class="sidebar-link">4.1 一对一（多对一）(association)</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_4-2-一对多-collection" class="sidebar-link">4.2 一对多(collection)</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_4-3-多对多" class="sidebar-link">4.3 多对多</a></li></ul></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_5-mybatis延迟加载策略" class="sidebar-link">5 MyBatis延迟加载策略</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_5-1-一对一、多对一" class="sidebar-link">5.1 一对一、多对一</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_5-2-一对多、多对多" class="sidebar-link">5.2 一对多、多对多</a></li></ul></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_6-mybatis的缓存" class="sidebar-link">6 MyBatis的缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_6-1-一级缓存" class="sidebar-link">6.1 一级缓存</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_6-2-二级缓存" class="sidebar-link">6.2 二级缓存</a></li></ul></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_7-mybatis的注解开发" class="sidebar-link">7 MyBatis的注解开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_7-1-mybatis的常用注解说明" class="sidebar-link">7.1 mybatis的常用注解说明</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_7-2-单表crud" class="sidebar-link">7.2 单表CRUD</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_7-3-单表结果集封装" class="sidebar-link">7.3 单表结果集封装</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_7-4-一对一（多对一）" class="sidebar-link">7.4 一对一（多对一）</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_7-5-一对多" class="sidebar-link">7.5 一对多</a></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_7-6-缓存" class="sidebar-link">7.6 缓存</a></li></ul></li><li class="sidebar-sub-header"><a href="/Java/Persistence/Mybatis/0 Primer.html#_8-逆向工程" class="sidebar-link">8 逆向工程</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mybatis Plus 3.3.0</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mybatis"><a href="#mybatis" class="header-anchor">#</a> MyBatis</h1> <blockquote><p>MyBatis 本是 apache 的一个开源项目 iBatis，2010年这个项目由 apache software foundation 迁移到了 google code，并且改名为 MyBatis ，2013年11月迁移到 Github。</p> <p>MyBatis 是一个优秀的基于 java 的<strong>持久层框架</strong>，采用 <strong>ORM 思想（对象关系映射）<strong>解决了</strong>实体和数据库映射</strong>的问题，对 <strong>jdbc进行了封装</strong>，使开发者只需要关注 sql语句本身， 而不需要花费精力去处理加载驱动、创建连接、创建 statement 、处理结果集、关闭资源等繁杂的过程。</p> <p>MyBatis 通过xml 或注解的方式将要执行的各种statement配置起来，并通过<strong>java对象</strong>和<strong>statement 中 sql 的动态参数</strong>进行<strong>映射生成最终执行的 sql 语句</strong>，最后由 mybatis 框架执行 sql 并将结果映射为 java 对象并返回。</p></blockquote> <h2 id="_1-入门"><a href="#_1-入门" class="header-anchor">#</a> 1 入门</h2> <h3 id="_1-1-maven依赖"><a href="#_1-1-maven依赖" class="header-anchor">#</a> 1.1 Maven依赖</h3> <ul><li>单mybatis的依赖参考<a href="http://www.mybatis.org/mybatis-3/zh/index.html" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，还需要<code>mysql-connector-java</code>驱动的依赖</li></ul> <h3 id="_1-2-mybatis-config-xml"><a href="#_1-2-mybatis-config-xml" class="header-anchor">#</a> 1.2 mybatis-config.xml</h3> <ul><li><p>resources目录中创建**<code>mybatis-config.xml</code><strong>、</strong><code>JdbcConfig.properties</code>**、<code>log4j.properties</code>(日志输出)</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token comment">#log4j.properties</span>
<span class="token comment"># Configure logging for testing: optionally with log file</span>
<span class="token attr-name">log4j.rootLogger</span><span class="token punctuation">=</span><span class="token attr-value">WARN, stdout</span>
<span class="token comment"># log4j.rootLogger=WARN, stdout, logfile</span>

<span class="token attr-name">log4j.appender.stdout</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.ConsoleAppender</span>
<span class="token attr-name">log4j.appender.stdout.layout</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.PatternLayout</span>
<span class="token attr-name">log4j.appender.stdout.layout.ConversionPattern</span><span class="token punctuation">=</span><span class="token attr-value">%d %p [%c] - %m%n</span>

<span class="token attr-name">log4j.appender.logfile</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.FileAppender</span>
<span class="token attr-name">log4j.appender.logfile.File</span><span class="token punctuation">=</span><span class="token attr-value">target/spring.log</span>
<span class="token attr-name">log4j.appender.logfile.layout</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.PatternLayout</span>
<span class="token attr-name">log4j.appender.logfile.layout.ConversionPattern</span><span class="token punctuation">=</span><span class="token attr-value">%d %p [%c] - %m%n</span>
</code></pre></div><div class="language-properties extra-class"><pre class="language-properties"><code><span class="token comment">#JdbcConfig.properties</span>
<span class="token attr-name">jdbc.driver</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.cj.jdbc.Driver </span>
<span class="token attr-name">jdbc.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://localhost:3306/bxgtest?serverTimezone=GMT%2B8&amp;useSSL=false</span>
<span class="token attr-name">jdbc.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span>
<span class="token attr-name">jdbc.password</span><span class="token punctuation">=</span><span class="token attr-value">w1111</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--mybatis-config.xml--&gt;</span>
<span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token doctype">&lt;!DOCTYPE configuration
        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 用resource或url属性加载外部配置文件；也可以使用内部定义的属性（利用property属性，不常用）
         在properties元素体内自定义的属性首先被读取。 然后会读取resource或 url 加载的属性，它会覆盖已读取的同名属性--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>jdbcConfig.properties<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span> 

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.mybatis.pojo<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!-- 批量别名定义，扫描整个包下的类，别名为类名，大小写不敏感--&gt;</span>
        <span class="token comment">&lt;!-- &lt;typeAlias alias=&quot;user&quot; type=&quot;cn.itcast.mybatis.pojo.User&quot; /&gt; 单个别名定义， 大小写不敏感，不推荐 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token comment">&lt;!-- 配置MyBatis环境。和spring整合后 environments配置将废除 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>development<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--配置mysql环境--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>development<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- 配置事务类型，使用jdbc事务管理 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>JDBC<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token comment">&lt;!-- 数据库连接池 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>POOLED<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>driver<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${jdbc.driver}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${jdbc.url}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${jdbc.username}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${jdbc.password}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--告知MyBatis映射文件的位置--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span> <span class="token attr-value"><span class="token punctuation">=</span> <span class="token punctuation">&quot;</span>cn.itcast.dao<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span> <span class="token comment">&lt;!-- 该包下所有的dao接口都可以使用 --&gt;</span>
        <span class="token comment">&lt;!--  &lt;mapper class=&quot;cn.itcast.dao.UserMapper&quot;/&gt;  --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>配置的内容和<strong>顺序</strong>如下</p> <ul><li><p><strong>==properties==</strong>（属性）</p> <ul><li><code>mybatis-config.xml</code>可以引用属性文件中的配置信息(如<code>Jdbc.properties</code>)，配置如上。</li></ul></li> <li><p>settings（全局配置参数）</p></li> <li><p><strong>==typeAliases==</strong>（<strong>类型别名</strong>）：<strong>==package==</strong></p></li> <li><p>typeHandlers（类型处理器）</p></li> <li><p>objectFactory（对象工厂）</p></li> <li><p>objectWrapperFactory</p></li> <li><p>plugins（插件）</p></li> <li><p>environments（环境集合属性对象）</p> <ul><li>environment（环境子属性对象）
<ul><li>transactionManager（事务管理）</li> <li>dataSource（数据源）</li></ul></li></ul></li> <li><p>databaseIdProvider</p></li> <li><p><strong>==mappers==</strong>（映射器）：告诉MyBatis去哪里找映射文件</p> <ul><li><p>使用相对于类路径的<strong>资源引用(xml)</strong>；或完全限定<strong>URL</strong>；或<strong>类名(可用于注解)</strong>；或**==package==(可用于注解)**；</p> <ul><li><strong>resource</strong>：指定的文件必须存在于<strong>类路径下</strong>，其封装了类加载器的方法</li> <li><strong>URL</strong>：统一资源定位符，可以唯一标示一个资源位置。写法：<code>协议 主机 端口 URI</code>。如HTTP协议，File协议</li> <li><strong>URI</strong>：统一资源标识符，可以在<strong>应用中</strong>唯一标示一个资源位置。</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 使用相对于类路径的资源引用 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn/itcast/dao/UserMapper.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn/itcast/dao/BookMapper.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 使用完全限定资源定位符（URL） --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>file:///var/mappers/AuthorMapper.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>file:///var/mappers/BlogMapper.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 使用映射器接口实现类的完全限定类名 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.dao.UserMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.dao.BookMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 将包内的映射器接口实现全部注册为映射器 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.dao<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul></li></ul></li></ul> <h3 id="_1-3-实体类、mapper-dao-接口"><a href="#_1-3-实体类、mapper-dao-接口" class="header-anchor">#</a> 1.3 实体类、Mapper(Dao)接口</h3> <ul><li>domain中实体类通常与数据库表对应，作为mybatis进行sql映射使用</li> <li><code>~Mapper</code>接口就是我们的持久层接口（也可以写成 <code>~Dao</code>接口），放在java中</li></ul> <h3 id="_1-4-mapper-xml"><a href="#_1-4-mapper-xml" class="header-anchor">#</a> 1.4 Mapper.xml</h3> <p>Mapper接口开发方法只需要程序员编写<strong>Mapper接口</strong>和对应的<strong>Mapper.xml文件</strong>，由<strong>Mybatis框架根据接口定义创建接口的==动态代理对象==(<code>sqlSession.getMapper(Class c)</code>)</strong></p> <ul><li>Mapper接口开发需要遵循以下规范：
<ul><li>Mapper.xml和Mapper接口放置在**==同一包==**中，可分别在java、resources同名目录下（resources中目录创建用<code>/</code>分割）</li> <li>Mapper.xml文件中的<strong>namespace</strong>与mapper接口的<strong>全限定类名</strong>相同</li> <li>Mapper.xml中定义的每个statement的<strong>id</strong>与Mapper接口<strong>方法名</strong>相同</li> <li>Mapper.xml中定义的每个sql 的<strong>parameterType</strong>的类型和Mapper接口方法的<strong>输入参数类型</strong>相同</li> <li>Mapper.xml中定义的每个sql的<strong>resultType</strong>的类型和Mapper接口方法的<strong>输出参数类型</strong>相同</li></ul></li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token doctype">&lt;!DOCTYPE mapper
        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="token comment">&lt;!-- namespace：命名空间，用于隔离sql，必须是Mapper接口的全限定类名 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.mybatis.dao.UserDao<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--id：取值必须是Mapper接口的方法名--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>findUserById<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>int<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.mybatis.pojo.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        select * from user where id = #{id}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>注意</p> <ul><li><strong><code>#{}</code><strong>表示一个</strong>占位符</strong>号，通过<code>#{}</code>可以实现preparedStatement向占位符中设置值，自动进行java类型和jdbc类型转换。#{}可以有效<strong>防止sql注入</strong>。 #{}可以接收<strong>简单类型</strong>值或<strong>POJO中属性值</strong>。 如果parameterType传输单个简单类型值，#{}括号中可以是<strong>value或其它名称</strong></li> <li><s><code>${}</code>表示<strong>拼接sql串</strong>，不能防止SQL注入。通过 <code>${}</code>可以将parameterType 传入的内容拼接在sql中且不进行jdbc类型转换，<code>${}</code>可以接收<strong>简单类型</strong>值或<strong>POJO中属性值</strong>，如果parameterType<strong>传输单个简单类型值</strong>，<code>${}</code>括号中<strong>只能是value</strong></s></li></ul> <h3 id="_1-5-注解mapper接口"><a href="#_1-5-注解mapper接口" class="header-anchor">#</a> 1.5 注解Mapper接口</h3> <p>不需要Mapper.xml，直接在Mapper接口的方法上使用注解即可完成。原理同Mapper.xml。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select * from user&quot;</span><span class="token punctuation">)</span>  
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><h3 id="_1-6-dao实现类开发"><a href="#_1-6-dao实现类开发" class="header-anchor">#</a> <s>1.6 Dao实现类开发</s></h3> <p>​	原始Dao开发方法需要程序员编写Dao接口和Dao实现类</p> <ul><li>问题：
<ul><li>Dao方法体存在重复代码：通过SqlSessionFactory创建SqlSession，调用SqlSession的数据库操作方法，如selectOne、selectList、insert、update、delete</li> <li>调用sqlSession的数据库操作方法需要指定statement的namespace.id和参数，这里存在硬编码，不得于开发维护</li></ul></li></ul> <h3 id="_1-7-sqlsession"><a href="#_1-7-sqlsession" class="header-anchor">#</a> 1.7 SqlSession</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//1.读取配置文件   </span>
<span class="token class-name">InputStream</span> is <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">&quot;mybatis-config.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     
<span class="token comment">//2.使用构建者创建工厂对象 SqlSessionFactory。      使用构建者模式 </span>
<span class="token class-name">SqlSessionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//3.使用 SqlSessionFactory 生产 SqlSession 对象。  使用工厂模式</span>
<span class="token class-name">SqlSession</span> session <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//4.使用 SqlSession 创建 dao 接口的动态代理对象。   使用动态代理</span>
<span class="token class-name">UserMapper</span> userMapper <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token comment">//5.使用代理对象执行查询所有方法   </span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">User</span> user <span class="token operator">:</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token punctuation">}</span> 
<span class="token comment">//6.释放资源   </span>
session<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>动态代理对象调用sqlSession.selectOne()和sqlSession.selectList()等方法是<strong>根据mapper接口方法的返回值</strong>决定，如果返回list则调用<strong>selectList</strong>方法，如果返回单个对象则调用<strong>selectOne</strong>方法……</p></blockquote> <ol><li><p><strong>==构建者模式==</strong>：<strong>SqlSessionFactoryBuilder接收<code>mybatis-config.xml</code>文件流，构建出SqlSessionFactory对象</strong>。最佳使用范围是<strong>方法范围即方法体内局部变量</strong></p></li> <li><p><strong>==工厂模式==</strong>：<strong>SqlSessionFactory读取<code>mybatis-config.xml</code>中连接数据库和mapper映射的信息，生产出真正操作数据库的SqlSession对象</strong>。（SqlSessionFactory是一个接口，最佳使用范围是<strong>整个应用运行期间</strong>，创建后可以重复使用，通常以<strong>单例模式</strong>管理SqlSessionFactory）</p></li> <li><p><strong>==动态代理==</strong>：<strong>SqlSession接口用于生成接口代理对象，定义通用增删查改方法</strong>。每个线程都应有自己的SqlSession实例，不能共享使用，它也是<strong>线程不安全</strong>的。因此最佳的范围是<strong>请求或方法范围</strong>，绝对不能将SqlSession实例的引用放在一个类的静态字段或实例字段中。每次使用后关闭资源。</p></li></ol> <p>总结：使用mybatis创建的动态代理对象，还是直接使用其提供的CRUD方法。==本质都是<strong>得到JDBC的Connection对象</strong>，<strong>执行对应的Sql语句</strong>，最后<strong>封装结果集</strong>。==</p> <p>注意：使用==<strong>增删改</strong>==方法后，要调用<strong>SqlSession的<code>commit()</code>方法</strong>==提交事务==才能成功</p> <h3 id="_1-8-输入映射与输出映射"><a href="#_1-8-输入映射与输出映射" class="header-anchor">#</a> 1.8 输入映射与输出映射</h3> <p><strong>OGNL</strong>(Object-Graph Navigation Language)，它是一种功能强大的<strong>表达式语言</strong>，通过它简单一致的表达式语法（省略get、set），可以存取对象的<strong>任意属性</strong>，调用对象的<strong>方法</strong>，遍历整个对象的结构图，实现字段类型转化等功能。它使用相同的表达式去存取对象的属性</p> <ul><li><p><strong>parameterType</strong>：将要传入语句的参数的完全限定类名或别名。<strong>可选</strong>，MyBatis会推断出具体传入语句的参数</p> <ul><li><strong>传递简单类型</strong>：Integer、int、String等等，写全限定类名或简单类型都可以。使用<code>#{}</code>占位符，任意取值</li> <li><strong>传递POJO对象</strong>：Mybatis使用ognl表达式解析对象字段的值，<code>#{}</code>括号中的值为提供的POJO属性名称</li> <li><strong>传递POJO包装对象</strong> <ul><li>需求：根据用户名模糊查询用户信息。查询条件放到QueryVo的user属性中(包装类)</li> <li>查询条件可能是<strong>综合的查询条件</strong>，不仅包括用户查询条件还包括其它的查询条件（比如查询用户信息的时候，将用户购买商品信息也作为查询条件），这时可以<strong>使用包装对象传递输入参数</strong></li> <li>包装对象：<strong>POJO类中的一个属性是另外一个POJO</strong></li></ul></li></ul></li> <li><p><strong>resultType</strong>：从这条语句中返回的期望类型的类的完全限定名或别名，若是集合，那应该是集合包含的类型</p> <ul><li><strong>输出简单类型</strong>：Integer、int、String等等，写全限定类名或简单类型都可以。需求：查询用户表数据条数</li> <li><strong>输出POJO对象</strong>：<code>resultType = &quot;cn.itcast.mybatis.pojo.User&quot;</code></li> <li><strong>输出POJO列表</strong>：<code>resultType = &quot;cn.itcast.mybatis.pojo.User&quot;</code>，分别进行映射，并把对象放到容器List中</li></ul></li> <li><p><strong>resultMap（常用于多表查询）</strong></p> <ul><li><p><strong>SQL查询字段名和POJO的属性名不一致</strong>（<strong>MySQL</strong>在<strong>Windows</strong>中字段名<strong>不区分大小写</strong>；在<strong>Linux</strong>中<strong>区分</strong>大小写）</p> <ul><li><p>可以在使用<strong>SQL语句</strong>查询时用AS（可省略）<strong>起别名</strong>，执行效率比下面的高</p></li> <li><p>可以通过resultMap将字段名和属性名作<strong>对应关系</strong>。resultMap实质上还需要将查询结果映射到POJO对象中</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- resultMap最终还是要将结果映射到POJO上 --&gt;</span>
<span class="token comment">&lt;!-- id：设置ResultMap的id；type就是指定映射到哪一个POJO --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UserMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 定义主键 ,非常重要。如果是多个字段,则定义多个id --&gt;</span>
    <span class="token comment">&lt;!-- property：主键在POJO中的属性名；column：主键在数据库中的列名 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!-- 定义非主键字段映射--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userAddress<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>address<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userSex<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sex<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 查询所有的订单数据 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>findAll<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UserMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    select * from user;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul></li></ul></li></ul> <h3 id="补充"><a href="#补充" class="header-anchor">#</a> 补充</h3> <ul><li>xml的CDATA区，可以不用写<code>&amp;lt;</code>之类的</li> <li>接口中有多个形参，需要添加@Param注解区分。用的少，一般都封装在一个对象中。</li></ul> <h3 id="案例"><a href="#案例" class="header-anchor">#</a> 案例</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//查询所有</span>
    <span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//根据id查询</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//根据用户名模糊查询</span>
    <span class="token class-name">Integer</span> <span class="token function">findCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//查询总记录数</span>
    <span class="token keyword">void</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//增</span>
    <span class="token keyword">void</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//删</span>
    <span class="token keyword">void</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//改</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByQueryVo</span><span class="token punctuation">(</span><span class="token class-name">QueryVo</span> queryVo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//QueryVo</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--UserMapper.xml--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.dao.UserMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>findAll<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.domain.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        select * from user;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>findById<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>java.lang.Integer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.domain.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        select * from user where id=#{id}; <span class="token comment">&lt;!--占位符可以随便写uid等--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>findByUsername<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>java.lang.String<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.domain.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        select * from user where username like #{username}; <span class="token comment">&lt;!--占位符可以随便写name等--&gt;</span>
        <span class="token comment">&lt;!--select * from user where username like '%${value}%';了解，不防SQL注入。$拼接字符串，占位符只能写value--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>findCount<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>java.lang.Integer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        select count(*) from user;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>addUser<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.domain.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--下面占位符必须对应User中属性--&gt;</span>
    	<span class="token comment">&lt;!-- selectKey 插入或更新操作后获取插入或更新的数据的id。插入后调用被插入对象的getId()方法即可获取到 --&gt;</span>
    	<span class="token comment">&lt;!-- keyProperty：主键对应的POJO中的哪一个属性 --&gt;</span>
    	<span class="token comment">&lt;!-- keyColumn:主键对应的表中的哪一列 --&gt;</span>
    	<span class="token comment">&lt;!-- order：设置在执行insert语句前执行查询id的sql，还是在执行insert语句之后执行查询id的sql--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>selectKey</span> <span class="token attr-name">keyProperty</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">keyColumn</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>int<span class="token punctuation">&quot;</span></span> <span class="token attr-name">order</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>AFTER<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--LAST_INSERT_ID():是mysql的函数，返回auto_increment自增列新记录id值--&gt;</span>
            select last_insert_id();
            <span class="token comment">&lt;!-- 或   通过select uuid()得到uuid值 order=&quot;BEFORE&quot;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>selectKey</span><span class="token punctuation">&gt;</span></span>
        insert into user (username,birthday,sex,address) values (#{username},#{birthday},#{sex},#{address});
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>

     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delete</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>deleteUser<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>java.lang.Integer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        delete from user where id=#{id}; <span class="token comment">&lt;!--占位符可以随便写uid等--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>delete</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>updateUser<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.domain.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--下面占位符必须对应User中属性--&gt;</span>
        update user set username = #{username},sex=#{sex},address=#{address},birthday=#{birthday} where id=#{id};
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span>
    
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>findByQueryVo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.domain.QueryVo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.domain.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        select * from user where username like #{user.username};
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestUserMapper</span> <span class="token punctuation">{</span>
    <span class="token class-name">InputStream</span> is<span class="token punctuation">;</span>
    <span class="token class-name">SqlSession</span> sqlSession<span class="token punctuation">;</span>
    <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        is <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">&quot;mybatis-config.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SqlSessionFactoryBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//提交事务</span>
        sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        is<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindByUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">findByUsername</span><span class="token punctuation">(</span><span class="token string">&quot;%王%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//模糊查询在此时需要添加%</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Integer</span> count <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">findCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAddUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;西安&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;男&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//User{id=null, username='张三', address='西安'......}</span>
        userMapper<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//User{id=53, username='张三', address='西安'.....}</span>
    <span class="token punctuation">}</span>
 	<span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeleteUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        userMapper<span class="token punctuation">.</span><span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token number">49</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUpdateUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">49</span><span class="token punctuation">,</span> <span class="token string">&quot;王五&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;北京&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;女&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userMapper<span class="token punctuation">.</span><span class="token function">updateUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindByQueryVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">QueryVo</span> queryVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryVo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span> <span class="token string">&quot;%王%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">findByQueryVo</span><span class="token punctuation">(</span>queryVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_2-mybatis中连接池和事务"><a href="#_2-mybatis中连接池和事务" class="header-anchor">#</a> 2 Mybatis中连接池和事务</h2> <h3 id="_2-1-连接池"><a href="#_2-1-连接池" class="header-anchor">#</a> 2.1 连接池</h3> <p>我们在 WEB 课程中也学习过类似的连接池技术，而在 Mybatis 中也有连接池技术，但是它采用的是<strong>自己的连接池技术</strong>。在 Mybatis的<code>mybatis-config.xml</code>配置文件中，<strong>通过<code>&lt;dataSource type=&quot;pooled&quot;&gt;</code>来实现</strong> Mybatis 中连接池的配置。</p> <p>在 Mybatis 中我们将它的数据源 dataSource 分为以下几类： (运行测试用例后日志中即可看到区别)</p> <ul><li><p><strong>==POOLED==</strong>：实现了<code>java.sql.DataSource</code>接口规范的<code>PooledDataSource</code>类，<strong>使用</strong>连接池的数据源</p> <ul><li><blockquote><p>当一个线程来获取连接池，先查找是否有空闲的连接池，有就返回，没有则查询活动的连接池数量是否等于允许的最大连接池数量，若不等于则创建并返回，否则获取使用时间最久的那个连接池（会判断是否失效）并返回</p></blockquote></li></ul></li> <li><p>UNPOOLED：同样实现了上述接口的<code>UnpooledDataSource</code>类，<strong>不使用</strong>连接池的数据源</p></li> <li><p>JNDI：采用<strong>服务器提供的JNDI技术实现</strong>，获取DadaSource对象，不同服务器获取的不一样。只能用于<strong>web工程</strong>或<strong>Maven的war工程</strong>。我们使用的<strong>Tomcat</strong>采用的连接池是<strong>dbcp连接池</strong></p></li></ul> <h3 id="_2-2-事务"><a href="#_2-2-事务" class="header-anchor">#</a> 2.2 事务</h3> <blockquote><p>什么是事务？</p> <p>事务的四大特性（ACID）</p> <p>不考虑隔离级别会产生的3个问题</p> <p>解决办法：四种隔离级别</p></blockquote> <p>MyBatis是对JDBC的封装，通过**==SqlSession对象==的<code>commit()</code>和<code>rollback()</code>**方法实现事务的提交和回滚。因为在连接池中取出的连接，都会将调用 <code>connection.setAutoCommit(false)</code>方法，所以需手动提交。</p> <p>可以在获取SqlSession对象时设置<code>openSession(true)</code>（底层还是调用<code>connection.setAutoCommit(true)</code>方法），即可自动提交，但是不推荐。</p> <p>和Spring整合后使用SpringMVC的事务管理</p> <h3 id="_2-3-jndi"><a href="#_2-3-jndi" class="header-anchor">#</a> 2.3 JNDI</h3> <p><strong>JNDI</strong>(Java Naming and Directory Interface)：Java名称和目录接口，是SUN公司推出的一套规范，属于JavaEE技术之一。目的是模仿windows系统中的注册表（map结构，key为目录+名称）</p> <p>只能用于<strong>web工程</strong>或<strong>Maven的war工程</strong></p> <ol><li><p>创建Maven的war工程并导入坐标。还需要servlet-api和jsp-api依赖</p></li> <li><p>在webapp文件下创建META-INF目录，建立一个名为context.xml的配置文件</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Context</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Resource</span> 
<span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>jdbc/mybatis<span class="token punctuation">&quot;</span></span>                       <span class="token attr-name">数据源的名称，JNDI中name，任意起名</span>          
<span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>javax.sql.DataSource<span class="token punctuation">&quot;</span></span>               <span class="token attr-name">数据源类型</span>         
<span class="token attr-name">auth</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Container<span class="token punctuation">&quot;</span></span>                          <span class="token attr-name">数据源提供者</span>  
<span class="token attr-name">maxActive</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>20<span class="token punctuation">&quot;</span></span>                            <span class="token attr-name">最大活动数</span>
<span class="token attr-name">maxWait</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>10000<span class="token punctuation">&quot;</span></span>                           <span class="token attr-name">最大等待时间</span> 
<span class="token attr-name">maxIdle</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span>                               <span class="token attr-name">最大空闲数</span>
<span class="token attr-name">username</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span>                            
<span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1234<span class="token punctuation">&quot;</span></span>                            
<span class="token attr-name">driverClassName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.mysql.jdbc.Driver<span class="token punctuation">&quot;</span></span>          
<span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://localhost:3306/mybatis<span class="token punctuation">&quot;</span></span> 
<span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Context</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>修改mybatis-config.xml中配置</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>JNDI<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span> <span class="token attr-value"><span class="token punctuation">=</span> <span class="token punctuation">&quot;</span>data_source<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>java:comp/env/jdbc/mybatis<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>由于这个数据源是服务器提供的，所以需要经过服务器才能使用，不能用Test测试类来测试，需要在JSP或Servlet中测试</p></li></ol> <h2 id="_3-xml映射文件的动态sql语句"><a href="#_3-xml映射文件的动态sql语句" class="header-anchor">#</a> 3 XML映射文件的动态SQL语句</h2> <ul><li>通过mybatis提供的各种标签方法实现<strong>动态拼接sql</strong></li></ul> <h3 id="_3-1-if、where、set"><a href="#_3-1-if、where、set" class="header-anchor">#</a> 3.1 if、where、set</h3> <ul><li>where元素只会在<strong>至少有一个子元素</strong>的条件返回SQL子句的情况下才去<strong>插入WHERE子句</strong>。</li> <li>而且，若语句的<strong>开头</strong>为“<strong>AND</strong>”或“<strong>OR</strong>”，where元素也会将它们<strong>去除</strong>。</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--通过用户名和性别模糊条件查询--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>findUserByUsernameAndSex<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>User<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>User<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
    select * from user
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username!=null and username!=''<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!--还可以使用_parameter代表这个入参User。不能使用&amp;&amp;--&gt;</span>
            username like ${username} <span class="token comment">&lt;!--需调用时提供%--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sex!=null and sex!=''<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            and sex=#{sex}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>where</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>set元素会动态<strong>前置 SET 关键字</strong>，同时也会<strong>删掉无关的逗号</strong></li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>updateUser<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>User<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    update Author
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username != null<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>username=#{username},<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>address != null<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>password=#{password},<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sex != null<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>bio=#{bio}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">&gt;</span></span>
    where id=#{id}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_3-2-foreach"><a href="#_3-2-foreach" class="header-anchor">#</a> 3.2 foreach</h3> <ul><li><p>向sql传递迭代对象(如 <strong>List</strong>、<strong>Set</strong>等)、<strong>Map</strong>对象或者<strong>数组</strong>对象或包装有他们的<strong>QueryVo包装对象</strong></p> <p>需求：<strong>根据多个id查询用户信息</strong></p> <p>查询sql：SELECT * FROM user WHERE id IN (1,10,24)</p></li> <li><p><strong>QueryVo包装对象</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//QueryVo.java</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">;</span>
<span class="token comment">//或 Integer[] ids;</span>
<span class="token comment">//getter,setter...</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectUserByIds</span><span class="token punctuation">(</span><span class="token class-name">QueryVo</span> vo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 根据ids查询用户 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>queryUserByIds<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>queryVo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	SELECT * FROM `user`
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- foreach标签，进行遍历 --&gt;</span>
		<span class="token comment">&lt;!-- collection：遍历的集合，指的是传入参数的属性，这里是QueryVo的ids属性 --&gt;</span>
		<span class="token comment">&lt;!-- 当使用可迭代对象或者数组时，index 是当前迭代的次数，item 的值是本次迭代获取的元素 --&gt;</span>
         <span class="token comment">&lt;!-- 当使用 Map 对象（或者 Map.Entry 对象的集合）时，index 是键，item 是值 --&gt;</span>
		<span class="token comment">&lt;!-- open：在前面添加的sql片段 --&gt;</span>
		<span class="token comment">&lt;!-- close：在结尾处添加的sql片段 --&gt;</span>
		<span class="token comment">&lt;!-- separator：指定遍历的元素之间使用的分隔符，不指定默认为逗号“，” --&gt;</span>
	   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ids<span class="token punctuation">&quot;</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">open</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id IN (<span class="token punctuation">&quot;</span></span> <span class="token attr-name">close</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>,<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			#{item}
	   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>where</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>当传递的参数是<strong>Array对象</strong>，collection应赋值<strong>array</strong></p> <p>当传递的参数是<strong>List对象</strong>，collection应赋值<strong>collection</strong>或<strong>list</strong></p> <p>当传递的参数是<strong>Set对象</strong>，collection应赋值<strong>collection</strong></p> <p>当传递的参数是<strong>Map对象</strong>，collection应赋值为<strong>map中的key值</strong>（具体的key，value可以是数组，集合等）</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectUserByIds</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ids<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectUserByIds</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>findUserByIds<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>User<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
    select * from user where
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>array<span class="token punctuation">&quot;</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">open</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id in (<span class="token punctuation">&quot;</span></span> <span class="token attr-name">close</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>,<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        #{item}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul> <h3 id="_3-3-sql片段（了解）"><a href="#_3-3-sql片段（了解）" class="header-anchor">#</a> 3.3 sql片段（了解）</h3> <ul><li><p>Sql中可将重复的sql提取出来，使用时用include引用即可，最终达到sql重用的目的。暂时没啥用</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sql</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>selector<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    select * from user
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sql</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>findUserById<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>int<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">refid</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>selector<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    where id = #{id}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul> <h2 id="_4-mybatis中多表查询"><a href="#_4-mybatis中多表查询" class="header-anchor">#</a> 4 MyBatis中多表查询</h2> <ul><li>4.1和4.2案例使用的是<strong>用户</strong>和<strong>账户</strong>：一个用户可以有多个账户；一个账户只能属于一个用户（多个账户也可以属于一个用户）</li> <li>步骤
<ol><li>建立两张表：<strong>用户表</strong>、<strong>账户表</strong>。让用户表和账户表<strong>具备一对多</strong>关系，需使用<strong>外键</strong>在账户表中添加</li> <li>建立两个实体类：<strong>用户类</strong>、<strong>账户类</strong>，让让用户类和账户类能<strong>体现出一对多</strong>关系
<ul><li><strong>从表类引用主表类</strong>；<strong>主表类包含从表类集合的引用</strong>；</li></ul></li> <li>建立两个配置文件：用户和账户的配置文件</li> <li>实现配置：查询用户时，同时得到用户下所包含的账户信息；查询账户时，可以得到账户所属用户的信息</li></ol></li></ul> <ul><li>需要使用**==resultMap==**，resultType也行但是得创建继承类麻烦</li></ul> <h3 id="_4-1-一对一（多对一）-association"><a href="#_4-1-一对一（多对一）-association" class="header-anchor">#</a> 4.1 一对一（多对一）(association)</h3> <blockquote><p>一对一中有时返回的pojo包含两张表信息，且不是包含另一个pojo对象，可以不用写resultMap</p></blockquote> <ul><li><p>查询所有<strong>账户</strong>信息，关联查询<strong>用户</strong>信息。 <strong>==从表类引用主表类==</strong><code>private User user;</code></p> <p>因为一个账户信息只能供某个用户使用，所以从查询账户信息出发关联查询用户信息为一对一查询。</p> <p>如果从用户信息出发查询用户下的账户信息则为一对多查询，因为一个用户可以有多个账户。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//AccountMapper.java</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--AccountMapper.xml--&gt;</span>
<span class="token comment">&lt;!--以下主从表column不能相同；使用了别名，有关type的不用写全限定类名，大小写不敏感；id为主键列，result为其他列--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>AccountUserMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Account<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>aid<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>uid<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>uid<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>money<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>money<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--一对一映射association，配置引用的User内容--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>address<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>address<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sex<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sex<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>birthday<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>birthday<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>findAll<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>AccountUserMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    SELECT u.*,a.id aid,a.uid,a.money FROM account a JOIN user u ON a.uid=u.id;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul> <h3 id="_4-2-一对多-collection"><a href="#_4-2-一对多-collection" class="header-anchor">#</a> 4.2 一对多(collection)</h3> <ul><li><p>查询所有<strong>用户</strong>信息及用户关联的<strong>账户</strong>信息。 <strong>==主表类包含从表类集合的引用==</strong><code>private List&lt;Account&gt; accounts</code></p> <p>用户信息和他的账户信息为一对多关系，并且查询过程中如果用户没有账户信息，此时也要将用户信息查询出来，我们想到了<strong>左外连接</strong>查询比较合适。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//UserMapper.java</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--UserMapper.xml--&gt;</span>
<span class="token comment">&lt;!--以下主从表column不能相同；使用了别名，有关type的不用写全限定类名，大小写不敏感；id为主键列，result为其他列--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UserAccountMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>address<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>address<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sex<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sex<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>birthday<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>birthday<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--一对多映射collection，配置引用的Account集合内容，由于泛型，使用其值类型--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>accounts<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Account<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>aid<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>uid<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>uid<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>money<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>money<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>findAll<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UserAccountMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    SELECT u.*,a.id aid,a.uid,a.money FROM `user` u LEFT JOIN account a ON u.id = a.uid;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul> <h3 id="_4-3-多对多"><a href="#_4-3-多对多" class="header-anchor">#</a> 4.3 多对多</h3> <ul><li><p>多对多关系其实我们看成是**==双向的一对多关系==**。原理同4.2</p></li> <li><p>案例使用<strong>用户</strong>和<strong>角色</strong>：一个用户可以有多个角色；一个角色可以赋予多个用户</p></li> <li><p>步骤</p> <ol><li>建立两张表：<strong>用户表</strong>、<strong>角色表</strong>。让用户表和角色表<strong>具备多对多</strong>关系，需要中间表，<strong>中间表外键引用</strong>两张表各自的<strong>主键</strong></li> <li>建立两个实体类：<strong>用户类</strong>、<strong>角色类</strong>，让让用户类和角色类能<strong>体现出多对多</strong>关系
<ul><li><strong>==各自包含对方一个集合的引用==</strong>；<code>private List&lt;User&gt; users;</code> 、<code>private List&lt;Role&gt; roles;</code></li></ul></li> <li>建立两个配置文件：用户和角色的配置文件</li> <li>实现配置：查询用户时，同时得到用户下所包含的角色信息；查询角色时，可以得到角色所赋予用户的信息</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//RoleMapper.java</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.dao.RoleMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>roleMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Role<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>roleId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>rid<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>roleName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>role_name<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>roleDesc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>role_desc<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>users<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>address<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>address<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sex<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sex<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>birthday<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>birthday<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>findAll<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>roleMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        SELECT u.*, r.id rid, r.role_name, r.role_desc
        FROM role r
        LEFT JOIN user_role ur ON r.id = ur.rid
        LEFT JOIN user u ON ur.uid = u.id
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//UserMapper.java</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.dao.UserMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userRoleMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>address<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>address<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sex<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sex<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>birthday<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>birthday<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>roles<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Role<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>roleId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>rid<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>roleName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>role_name<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>roleDesc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>role_desc<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>findAll<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userRoleMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        SELECT u.*, r.id rid, r.role_name, r.role_desc
        FROM user u
        LEFT JOIN user_role ur ON u.id = ur.uid
        LEFT JOIN role r ON ur.rid = r.id
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul> <h2 id="_5-mybatis延迟加载策略"><a href="#_5-mybatis延迟加载策略" class="header-anchor">#</a> 5 MyBatis延迟加载策略</h2> <p>在查询用户时，用户下的账户信息应该是什么时候使用什么时候查询</p> <p>在查询账户时，账户所属的用户信息应该随着账户查询一起查询出来</p> <ul><li><strong>延迟加载</strong>：就是在<strong>需要==用到数据==时才进行加载</strong>，不需要用到数据时就不加载数据。也称懒加载或按需加载
<ul><li>弊端：在大批量数据查询时，因为查询工作也要消耗时间，所以可能造成用户等待时间变长，造成用户体验下降</li></ul></li> <li><strong>立即加载</strong>：无论用不用数据都进行加载</li></ul> <p>在对应的四种表关系中，<strong>延迟加载</strong>用于<strong>一对多</strong>、<strong>多对多</strong>；<strong>立即加载</strong>用于<strong>一对一</strong>、<strong>多对一</strong></p> <ul><li><strong>mybatis-config.xml中开启延迟加载</strong>配置如下</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>lazyLoadingEnabled<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span> <span class="token comment">&lt;!--延迟加载的全局开关。当开启时，所有关联对象都会延迟加载--&gt;</span>
    <span class="token comment">&lt;!--&lt;setting name=&quot;aggressiveLazyLoading&quot; value=&quot;false&quot;/&gt;此属性在版本&gt;3.4.1时值默认为false，可以不设置--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_5-1-一对一、多对一"><a href="#_5-1-一对一、多对一" class="header-anchor">#</a> 5.1 一对一、多对一</h3> <p>虽然理论上一对一、多对一可以使用立即加载，但是为方便学习</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//AccountMapper.java</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--AccountMapper.xml--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.dao.AccountMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--有关type的不用写全限定类名，大小写不敏感；id为主键列，result为其他列--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>AccountUserMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Account<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>uid<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>uid<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>money<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>money<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!--一select：查询用户的唯一标示；column：查询用户时需要传递的字段--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>uid<span class="token punctuation">&quot;</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>User<span class="token punctuation">&quot;</span></span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.dao.UserMapper.findById<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>findAll<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>AccountUserMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        SELECT * from account
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//UserMapper.java</span>
<span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--UserMapper.xml--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.dao.UserMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>findById<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.domain.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        select * from user where id=#{id}; <span class="token comment">&lt;!--占位符可以随便写uid等--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>测试类中若<strong>仅调用<code>findAll</code>方法</strong>，不对其返回值操作，则<strong>只会查询Account数据</strong>，没有其所属User的数据</p> <h3 id="_5-2-一对多、多对多"><a href="#_5-2-一对多、多对多" class="header-anchor">#</a> 5.2 一对多、多对多</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//UserMapper.java</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--UserMapper.xml--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.dao.UserMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--使用了别名，有关type的不用写全限定类名，大小写不敏感；id为主键列，result为其他列--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UserAccountMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>address<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>address<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sex<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sex<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>birthday<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>birthday<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!--一select：查询账户的唯一标示；column：查询账户时需要传递的字段--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>accounts<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Account<span class="token punctuation">&quot;</span></span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.dao.AccountMapper.findById<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>findAll<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UserAccountMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        SELECT * from user
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//AccountMapper.java</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">&gt;</span></span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--AccountMapper.xml--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.itcast.dao.AccountMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>findById<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Account<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        select * from account where uid = #{uid}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="_6-mybatis的缓存"><a href="#_6-mybatis的缓存" class="header-anchor">#</a> 6 MyBatis的缓存</h2> <ul><li>缓存：存在于内存中的临时数据</li> <li>为什么使用缓存：通过缓存策略来<strong>减少数据库的查询次数</strong>，从而<strong>提高性能</strong></li> <li>什么数据能使用缓存，什么数据不能使用缓存？
<ul><li><strong>适用</strong>于缓存：<strong>经常被查询</strong>且<strong>不经常改变的</strong>；数据的正确性对<strong>结果影响不大</strong>的</li> <li><strong>不适用</strong>于缓存：<strong>经常改变的数据</strong>；数据的正确性对最终<strong>结果影响很大</strong>（商品库存、银行汇率、股市牌价）</li></ul></li></ul> <p>Mybatis中缓存分为一级缓存，二级缓存</p> <h3 id="_6-1-一级缓存"><a href="#_6-1-一级缓存" class="header-anchor">#</a> 6.1 一级缓存</h3> <ul><li><p>一级缓存是 <strong>==SqlSession==</strong> 对象的缓存，当调用SqlSession的<strong>添加，删除，修改，<code>commit()</code>，<code>close()</code>，<code>clearCache()</code>等</strong>方法时，就会<strong>清空一级缓存</strong>。 默认开启。</p> <blockquote><p>执行查询后，结果会同时存入SqlSession为我们提供的一块区域中（结构为map），再次查询时先从SqlSession中找...</p></blockquote></li> <li><p>验证：两次查询同一User对象并打印，结果Hash值相同，并且SQL语句只执行了一次。若中间修改数据库数据，则执行两次</p></li></ul> <h3 id="_6-2-二级缓存"><a href="#_6-2-二级缓存" class="header-anchor">#</a> 6.2 二级缓存</h3> <ul><li><p>二级缓存是值**==SqlSessionFactory==**对象的缓存，由同一个SqlSessionFactory对象创建的SqlSession共享</p></li> <li><p>二级缓存使用步骤</p> <ol><li><p>让MyBatis框架支持二级缓存，在mybatis-config.xml中配置。不配置也行，默认为true开启。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cacheEnabled<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>让映射文件支持二级缓存，如在UserMapper.xml中配置，在mapper标签内</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span><span class="token punctuation">/&gt;</span></span>
</code></pre></div></li> <li><p>让当前的操作支持二级缓存，如在select标签中配置</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>findById<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>User<span class="token punctuation">&quot;</span></span> <span class="token attr-name">useCache</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    select * from user where id=#{id};
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ol></li> <li><p>验证：同一个SqlSessionFactory对象创建的SqlSession并获取代理接口实现类，查询同一User对象（期间清空一级缓存），发现日志中<strong>SQL语句只执行了一次</strong>，但是<strong>Hash值却不同</strong>。原因是**==二级缓存存储的只是数据==<strong>，当被查询时</strong>创建对象并返回**。</p></li></ul> <h2 id="_7-mybatis的注解开发"><a href="#_7-mybatis的注解开发" class="header-anchor">#</a> 7 MyBatis的注解开发</h2> <blockquote><p>注解不能和xml在同一目录同时存在，否则运行直接报错。一般也没人这么干</p></blockquote> <h3 id="_7-1-mybatis的常用注解说明"><a href="#_7-1-mybatis的常用注解说明" class="header-anchor">#</a> 7.1 mybatis的常用注解说明</h3> <ul><li><p>@Select：实现查询</p></li> <li><p>@Insert：实现新增</p></li> <li><p>@Delete：实现删除</p></li> <li><p>@Update：实现更新</p></li> <li><p>@<strong>Result</strong>：实现结果集封装。id、property、column</p> <ul><li>@<strong>One</strong>：实现一对一结果集封装。select、fetchType（枚举类，延迟加载选项）</li> <li>@<strong>Many</strong>：实现一对多结果集封装</li></ul></li> <li><p>@<strong>Results</strong>：可以与@Result 一起使用（放在value中），<strong>封装多个结果集</strong>。id、value</p></li> <li><p>@<strong>ResultMap</strong>：实现<strong>引用@Results</strong> 定义的封装</p></li> <li><p>@<strong>CacheNamespace</strong>：实现注解<strong>二级缓存</strong>的使用，blocking，布尔值</p></li> <li><p>@<strong>Param</strong>：方法中有<strong>多参数</strong>时（多表插入时），需指定！！！也可以封装到JavaBean对象中</p></li> <li><p>@SelectProvider：实现动态 SQL 映射，还有@InsertProvider、@DeleteProvider、@UpdateProvider</p> <p>需自定义类和方法，之后添加注解<code>@SelectProvider(type = UserDaoProvider.class, method = &quot;findUserById&quot;)</code></p> <p>感觉比xml还麻烦啊</p></li></ul> <h3 id="_7-2-单表crud"><a href="#_7-2-单表crud" class="header-anchor">#</a> 7.2 单表CRUD</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select * from user&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select * from user where id = #{id}&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select * from user where username like #{username}&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select count(*) from user&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">Integer</span> <span class="token function">findCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">&quot;insert into user (username,address,sex,birthday) values (#{username},#{address},#{sex},#{birthday})&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">&quot;update user set username=#{username} where id = #{id}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Delete</span><span class="token punctuation">(</span><span class="token string">&quot;delete from user where id=#{id}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//多参数时需指定</span>
<span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">&quot;insert into USERS_ROLE values(#{userId},#{roleId})&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">addRoleToUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;roleId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> roleId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_7-3-单表结果集封装"><a href="#_7-3-单表结果集封装" class="header-anchor">#</a> 7.3 单表结果集封装</h3> <p>数据库字段名和JavaBean属性名称不一致</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select * from user&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Results</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token string">&quot;UserMap&quot;</span><span class="token punctuation">,</span>value <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>property <span class="token operator">=</span> <span class="token string">&quot;userId&quot;</span><span class="token punctuation">,</span>column <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//主键要设置id为true，id的默认值为false</span>
    <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;userName&quot;</span><span class="token punctuation">,</span>column <span class="token operator">=</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;userBirthday&quot;</span><span class="token punctuation">,</span>column <span class="token operator">=</span> <span class="token string">&quot;birthday&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;userSex&quot;</span><span class="token punctuation">,</span>column <span class="token operator">=</span> <span class="token string">&quot;sex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;userAddress&quot;</span><span class="token punctuation">,</span>column <span class="token operator">=</span> <span class="token string">&quot;address&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select * from user where id = #{id}&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResultMap</span><span class="token punctuation">(</span><span class="token string">&quot;UserMap&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select * from user where username like #{username}&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResultMap</span><span class="token punctuation">(</span><span class="token string">&quot;UserMap&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_7-4-一对一（多对一）"><a href="#_7-4-一对一（多对一）" class="header-anchor">#</a> 7.4 一对一（多对一）</h3> <ul><li>采用立即加载</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//AccountMapper.java</span>
<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select * from account&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Results</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token string">&quot;AccountMap&quot;</span><span class="token punctuation">,</span>value <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>property <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>column <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;uid&quot;</span><span class="token punctuation">,</span>column <span class="token operator">=</span> <span class="token string">&quot;uid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;money&quot;</span><span class="token punctuation">,</span>column <span class="token operator">=</span> <span class="token string">&quot;money&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">//column为外键列，可以不出现在实体类中，只要数据库中有，可以通过后面的sql语句使用该外键查询即可</span>
    <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span>column <span class="token operator">=</span> <span class="token string">&quot;uid&quot;</span><span class="token punctuation">,</span>
            one <span class="token operator">=</span> <span class="token annotation punctuation">@One</span><span class="token punctuation">(</span>select <span class="token operator">=</span> <span class="token string">&quot;cn.itcast.dao.UserMapper.findById&quot;</span><span class="token punctuation">,</span>fetchType <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>EAGER <span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//应给7.5提供的</span>
<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select * from account where uid = #{uid}&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">&gt;</span></span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_7-5-一对多"><a href="#_7-5-一对多" class="header-anchor">#</a> 7.5 一对多</h3> <ul><li>采用懒加载（延迟加载）</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//UserMapper.java</span>
<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select * from user&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Results</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token string">&quot;UserMap&quot;</span><span class="token punctuation">,</span>value <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>property <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>column <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span>column <span class="token operator">=</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;birthday&quot;</span><span class="token punctuation">,</span>column <span class="token operator">=</span> <span class="token string">&quot;birthday&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;sex&quot;</span><span class="token punctuation">,</span>column <span class="token operator">=</span> <span class="token string">&quot;sex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;address&quot;</span><span class="token punctuation">,</span>column <span class="token operator">=</span> <span class="token string">&quot;address&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">//column为外键列，可以不出现在实体类中，只要数据库中有，可以通过后面的sql语句使用该外键查询即可</span>
    <span class="token comment">//此处为通过id查询关联的表中数据</span>
    <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;accounts&quot;</span><span class="token punctuation">,</span>column <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>
            many <span class="token operator">=</span> <span class="token annotation punctuation">@Many</span><span class="token punctuation">(</span>select <span class="token operator">=</span> <span class="token string">&quot;cn.itcast.dao.AccountMapper.findById&quot;</span><span class="token punctuation">,</span>fetchType <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//应给7.4提供的</span>
<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select * from user where id = #{id}&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>注意：7.4和7.5的findById都使用ResultMap的话，互相无限调用导致栈溢出</p></blockquote> <h3 id="_7-6-缓存"><a href="#_7-6-缓存" class="header-anchor">#</a> 7.6 缓存</h3> <ul><li><p>一级缓存不需要开启，直接就可使用</p></li> <li><p>二级缓存的配置文件默认支持（同XML），只需给Mapper接口添加注释</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@CacheNamespace</span><span class="token punctuation">(</span>blocking <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="_8-逆向工程"><a href="#_8-逆向工程" class="header-anchor">#</a> 8 逆向工程</h2> <ul><li>配置文件修改：
<ul><li>修改要生成的数据库表</li> <li><strong>domain</strong>文件所在包路径，生成后实现Serializable接口，以便在网络中传输。带Example的就不用了</li> <li><strong>dao</strong>所在的包路径</li></ul></li> <li>注意：
<ul><li>逆向工程生成的代码只能做<strong>单表查询</strong></li> <li>不能在生成的代码上进行扩展，因为如果数据库变更，需要重新使用逆向工程生成代码，原来编写的代码就被覆盖了。</li> <li>一张表会生成<strong>4个文件</strong></li> <li>User.java(返回值对象); UserExample.java(条件查询时装数据的对象); UserDao.java; UserDao.xml</li></ul></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/apple54whn/notes/edit/master/docs/Java/Persistence/Mybatis/0 Primer.md" target="_blank" rel="noopener noreferrer">编辑文档！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">1/13/2020, 12:47:15 AM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/Java/Persistence/Mybatis Plus/0 Primer.html">0 Primer</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.4c2406b8.js" defer></script><script src="/assets/js/2.4ce794f3.js" defer></script><script src="/assets/js/162.bbdff718.js" defer></script><script src="/assets/js/33.9b523a1b.js" defer></script>
  </body>
</html>
