(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{434:function(t,s,a){"use strict";a.r(s);var e=a(2),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),a("h2",{attrs:{id:"目录结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目录结构"}},[t._v("#")]),t._v(" 目录结构")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("bin")]),t._v("："),a("strong",[t._v("脚本文件")]),t._v("目录，包括：启动、停止 ES，按照插件。运行统计数据等")]),t._v(" "),a("li",[a("strong",[t._v("config")]),t._v("："),a("strong",[t._v("配置文件")]),t._v("目录，如集群配置文件，user，role based 相关配置\n"),a("ul",[a("li",[t._v("elasticsearch.yml：用于配置Elasticsearch运行参数")]),t._v(" "),a("li",[t._v("jvm.options：JVM 配置")]),t._v(" "),a("li",[t._v("log4j2.properties：用于配置Elasticsearch日志")])])]),t._v(" "),a("li",[a("strong",[t._v("data")]),t._v("："),a("strong",[t._v("数据文件")]),t._v("目录，如存放索引文件等\n"),a("ul",[a("li",[t._v("path.data")])])]),t._v(" "),a("li",[t._v("jdk：Java 运行环境")]),t._v(" "),a("li",[t._v("lib：Java 类库")]),t._v(" "),a("li",[t._v("logs：日志文件目录")]),t._v(" "),a("li",[t._v("modules：模块目录，包含所有 ES 的功能模块")]),t._v(" "),a("li",[a("strong",[t._v("plugins")]),t._v("：插件目录，包含所有 ES 已按照插件")])]),t._v(" "),a("h2",{attrs:{id:"elasticsearch-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch-yml"}},[t._v("#")]),t._v(" elasticsearch.yml")]),t._v(" "),a("p",[t._v("配置格式是YAML，可以采用如下两种方式：")]),t._v(" "),a("ul",[a("li",[t._v("方式1：层次方式"),a("code",[t._v("path: data: /var/lib/elasticsearch logs: /var/log/elasticsearch")])]),t._v(" "),a("li",[t._v("方式2：属性方式"),a("code",[t._v("path.data: /var/lib/elasticsearch path.logs: /var/log/elasticsearch")])])]),t._v(" "),a("p",[t._v("本项目采用方式2，例子如下：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#配置elasticsearch的集群名称，默认是elasticsearch。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cluster.name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xuecheng\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#节点名，通常一台物理服务器就是一个节点，es会默认随机指定一个名字。一个或多个节点组成一个cluster集群，集群逻辑概念，节点物理概念")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node.name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xc_node_1\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置绑定主机的ip地址，设置为0.0.0.0表示绑定任何ip，允许外网访问，生产环境建议设置为具体的ip")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("network.host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 0.0.0.0\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置对外服务的http端口，默认为9200")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http.port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9200")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#集群结点之间通信端口")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("transport.tcp.port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9300")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定该节点是否有资格被选举成为master结点，默认是true，如果原来的master宕机会重新选举新的master")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node.master")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定该节点是否存储索引数据，默认为true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node.data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置集群中master节点的初始列表")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("discovery.zen.ping.unicast.hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0:9300"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0:9301"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#主结点数量的最少值 ,此值的公式为：(master_eligible_nodes / 2) + 1 ，比如：有3个符合要求的主结点，那么这里要设置为2。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("discovery.zen.minimum_master_nodes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node.ingest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置为true可以锁住ES使用的内存，避免内存与swap分区交换数据")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bootstrap.memory_lock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#单机允许的最大存储结点数，通常单机启动一个结点建议设置为1，开发环境如果单机启动多个节点可设置大于1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node.max_local_storage_nodes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置索引数据的存储路径，默认是es根目录下的data文件夹，可设置多个，用逗号隔开")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path.data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" C"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\\Develop\\Elasticsearch\\elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1\\data\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置日志文件的存储路径，默认是es根目录下的logs文件夹")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path.logs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" C"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\\Develop\\Elasticsearch\\elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1\\logs\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#开启cors跨域访问支持，默认为false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http.cors.enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#跨域访问允许的域名地址，(允许所有域名)以下使用正则")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http.cors.allow-origin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /.*/\n")])])]),a("ul",[a("li",[a("code",[t._v("path.conf")]),t._v("：设置配置文件的存储路径tar或zip包安装在config文件夹，rpm安装默认在/etc/elasticsearch")]),t._v(" "),a("li",[a("code",[t._v("path.plugins")]),t._v(": 设置插件的存放路径，默认是es根目录下的plugins文件夹")]),t._v(" "),a("li",[a("code",[t._v("discovery.zen.ping.timeout: 3s")]),t._v(" 设置ES自动发现节点连接超时的时间，默认为3秒，如果网络延迟高可设置大些")])]),t._v(" "),a("h2",{attrs:{id:"jvm-options"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jvm-options"}},[t._v("#")]),t._v(" jvm.options")]),t._v(" "),a("p",[t._v("7.1 下默认设置为 1GB。配置建议：")]),t._v(" "),a("ul",[a("li",[t._v("Xmx 和 Xms （即最小及最大的JVM堆内存）设置为一样")]),t._v(" "),a("li",[t._v("Xmx 不要超过机器内存的 50%")]),t._v(" "),a("li",[t._v("不要超过 300GB，"),a("a",{attrs:{href:"https://www.elasticsearch.co/blog/a-heap-of-trouble",target:"_blank",rel:"noopener noreferrer"}},[t._v("详见"),a("OutboundLink")],1)])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("-Xms2g\n-Xmx2g\n")])])]),a("h2",{attrs:{id:"log4j2-properties"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#log4j2-properties"}},[t._v("#")]),t._v(" log4j2.properties")]),t._v(" "),a("p",[t._v("日志文件设置，ES使用log4j2，注意日志级别的配置")]),t._v(" "),a("h2",{attrs:{id:"系统配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统配置"}},[t._v("#")]),t._v(" 系统配置")]),t._v(" "),a("p",[t._v("在linux上根据系统资源情况，可将每个进程最多允许打开的文件数设置大些。")]),t._v(" "),a("p",[a("code",[t._v("su limit -n")]),t._v(" 查询当前文件数")]),t._v(" "),a("p",[t._v("使用命令设置"),a("code",[t._v("limit")]),t._v("：先切换到root，设置完成再切回elasticsearch用户")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("sudo su\nulimit ‐n 65536\nsu elasticsearch\n")])])]),a("p",[t._v("也可通过下边的方式修改文件进行持久设置：")]),t._v(" "),a("p",[t._v("/etc/security/limits.conf，将下边的行加入此文件：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("elasticsearch ‐ nofile 65536\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);