<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>11 Network | Conanan&#39;s Notes</title>
    <meta name="description" content="Good Good Study, Day Day Up!">
    
    
    <link rel="preload" href="/assets/css/0.styles.5d7a53ce.css" as="style"><link rel="preload" href="/assets/js/app.11b86352.js" as="script"><link rel="preload" href="/assets/js/2.dc2cb52a.js" as="script"><link rel="preload" href="/assets/js/6.3ac5cf54.js" as="script"><link rel="prefetch" href="/assets/js/10.7ed53a9f.js"><link rel="prefetch" href="/assets/js/11.85d70dc7.js"><link rel="prefetch" href="/assets/js/12.6ca0a4c7.js"><link rel="prefetch" href="/assets/js/13.b66f44be.js"><link rel="prefetch" href="/assets/js/14.f7d36314.js"><link rel="prefetch" href="/assets/js/15.c9169b45.js"><link rel="prefetch" href="/assets/js/16.b3affa03.js"><link rel="prefetch" href="/assets/js/17.24a97ffb.js"><link rel="prefetch" href="/assets/js/18.f19a0f23.js"><link rel="prefetch" href="/assets/js/19.ccd87043.js"><link rel="prefetch" href="/assets/js/20.81aafd3b.js"><link rel="prefetch" href="/assets/js/21.0ca18de8.js"><link rel="prefetch" href="/assets/js/22.2ce051e4.js"><link rel="prefetch" href="/assets/js/23.e2addba7.js"><link rel="prefetch" href="/assets/js/24.10dbecb4.js"><link rel="prefetch" href="/assets/js/25.8641a27b.js"><link rel="prefetch" href="/assets/js/26.e5fad68f.js"><link rel="prefetch" href="/assets/js/27.07d175e0.js"><link rel="prefetch" href="/assets/js/3.4d99fa19.js"><link rel="prefetch" href="/assets/js/4.4809e9ae.js"><link rel="prefetch" href="/assets/js/5.9f00f578.js"><link rel="prefetch" href="/assets/js/7.d18e475f.js"><link rel="prefetch" href="/assets/js/8.73262d74.js"><link rel="prefetch" href="/assets/js/9.1d245c90.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5d7a53ce.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Conanan's Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java Study" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/Core/1 Basic Syntax.html" class="nav-link">Core</a></li><li class="dropdown-item"><!----> <a href="/Java/Framwork/1 Spring.html" class="nav-link">Framwork</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages2" class="dropdown-title"><span class="title">Languages2</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Group1</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese/" class="nav-link">Chinese</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">Japanese</a></li></ul></li><li class="dropdown-item"><h4>Group2</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese/" class="nav-link">Chinese</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">Japanese</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/guide/" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java Study" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/Core/1 Basic Syntax.html" class="nav-link">Core</a></li><li class="dropdown-item"><!----> <a href="/Java/Framwork/1 Spring.html" class="nav-link">Framwork</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages2" class="dropdown-title"><span class="title">Languages2</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Group1</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese/" class="nav-link">Chinese</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">Japanese</a></li></ul></li><li class="dropdown-item"><h4>Group2</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese/" class="nav-link">Chinese</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">Japanese</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/guide/" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Core</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Java/Core/0 Basic.html" class="sidebar-link">0 Basic</a></li><li><a href="/Java/Core/1 Basic Syntax.html" class="sidebar-link">1 Basic Syntax</a></li><li><a href="/Java/Core/2 Object Orientation.html" class="sidebar-link">2 Object Orientation</a></li><li><a href="/Java/Core/3 Error &amp; Exception.html" class="sidebar-link">3 Error &amp; Exception</a></li><li><a href="/Java/Core/4 API.html" class="sidebar-link">4 API</a></li><li><a href="/Java/Core/5 Generic.html" class="sidebar-link">5 Generic</a></li><li><a href="/Java/Core/6 Container.html" class="sidebar-link">6 Container</a></li><li><a href="/Java/Core/7 Thread.html" class="sidebar-link">7 Thread</a></li><li><a href="/Java/Core/7 Thread2.html" class="sidebar-link">7 Thread2</a></li><li><a href="/Java/Core/8 IO.html" class="sidebar-link">8 IO</a></li><li><a href="/Java/Core/9 NIO.html" class="sidebar-link">9 NIO（暂时未完成）</a></li><li><a href="/Java/Core/10 AIO.html" class="sidebar-link">10 AIO（暂时未完成）</a></li><li><a href="/Java/Core/11 Network.html" class="active sidebar-link">11 Network</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Core/11 Network.html#_11-1-网络编程概述" class="sidebar-link">11.1 网络编程概述</a></li><li class="sidebar-sub-header"><a href="/Java/Core/11 Network.html#_11-2-网络编程三要素" class="sidebar-link">11.2 网络编程三要素</a></li><li class="sidebar-sub-header"><a href="/Java/Core/11 Network.html#_11-3-socket-编程" class="sidebar-link">11.3 Socket 编程</a></li><li class="sidebar-sub-header"><a href="/Java/Core/11 Network.html#_11-4-url-编程" class="sidebar-link">11.4 URL 编程</a></li></ul></li><li><a href="/Java/Core/12 Reflect.html" class="sidebar-link">12 Reflect—java.lang.reflect</a></li><li><a href="/Java/Core/13 Lambda.html" class="sidebar-link">13 Lambda</a></li><li><a href="/Java/Core/14 Stream API.html" class="sidebar-link">14 Stream API</a></li><li><a href="/Java/Core/15 Optional.html" class="sidebar-link">15 Optional</a></li><li><a href="/Java/Core/16 Test.html" class="sidebar-link">16 Test</a></li><li><a href="/Java/Core/17 设计原则&amp;设计模式.html" class="sidebar-link">17 设计原则及设计模式</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Code</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_11-network"><a href="#_11-network" class="header-anchor">#</a> 11 Network</h1> <p></p><div class="table-of-contents"><ul><li><a href="#_11-network">11 Network</a><ul><li><a href="#_11-1-网络编程概述">11.1 网络编程概述</a></li><li><a href="#_11-2-网络编程三要素">11.2 网络编程三要素</a><ul><li><a href="#传输协议（通信的规则）">传输协议（通信的规则）</a></li><li><a href="#ip地址（inetaddress）">IP地址（InetAddress）</a></li><li><a href="#端口号（逻辑端口）">端口号（逻辑端口）</a></li></ul></li><li><a href="#_11-3-socket-编程">11.3 Socket 编程</a><ul><li><a href="#tcp（serversocket、socket）">TCP（ServerSocket、Socket）</a></li><li><a href="#udp（datagramsocket、datagrampacket）">UDP（DatagramSocket、Datagrampacket）</a></li></ul></li><li><a href="#_11-4-url-编程">11.4 URL 编程</a><ul><li><a href="#url类">URL类</a></li><li><a href="#针对http协议的urlconnection类">针对HTTP协议的URLConnection类</a></li><li><a href="#uri、url和urn的区别">URI、URL和URN的区别</a></li></ul></li></ul></li></ul></div><p></p> <ul><li><p>Java是 Internet 上的语言，它从语言级上提供了对网络应用程序的支持，程序员能够很容易开发常见的网络应用程序。Java提供的网络类库，可以实现无痛的网络连接，联网的底层细节被隐藏在 Java 的本机安装系统里，由 JVM 进行控制。并且 Java 实现了一个跨平台的网络库，程序员面对的是一个<strong>统一的网络编程环境</strong>。</p></li> <li><p><strong>软件结构</strong></p> <ul><li><strong>C/S结构</strong> ：全称为Client/Server结构，是指客户端和服务器结构。常见程序有ＱＱ、迅雷等软件。</li> <li><strong>B/S结构</strong> ：全称为Browser/Server结构，是指浏览器和服务器结构。常见浏览器有谷歌、火狐等。</li></ul></li></ul> <h2 id="_11-1-网络编程概述"><a href="#_11-1-网络编程概述" class="header-anchor">#</a> 11.1 网络编程概述</h2> <ul><li><p><strong>计算机网络</strong></p> <p>是指将分布在不同地理区域的计算机与专门的外部设备通过通信线路互连成一个规模大、功能强的网络系统，从而使众多的计算机可以方便地互相传递信息、共享硬件、软件、数据信息等资源。</p></li> <li><p><strong>网络编程</strong></p> <p>直接或间接地通过网络协议与其它计算机实现数据交换，进行通讯。那么牵扯到的问题有：</p> <ul><li>如何准确地定位网络上一台或多台主机，如何定位主机上的特定的应用</li> <li>找到主机后如何可靠高效地进行数据传输</li></ul></li> <li><p><strong>网络模型</strong></p> <ul><li><p>OSI（Open System Interconnection开放系统互连）参考模型</p></li> <li><p>TCP/IP参考模型</p> <p><img src="/assets/img/image-20191102184522751.4362bd5d.png" alt="image-20191102184522751"></p></li> <li><p>链路层：链路层是用于定义物理传输通道，通常是对某些<strong>网络连接设备的驱动协议</strong>，例如针对光纤、网线提供的驱动。</p></li> <li><p>网络层（互联网层）：网络层是整个TCP/IP协议的<strong>核心</strong>，它主要用于将传输的<strong>数据进行分组</strong>，将分组数据<strong>发送到目标</strong>计算机或者网络。</p></li> <li><p>传输层：主要使网络程序进行通信，在进行<strong>网络通信</strong>时，可以采用<strong>TCP</strong>协议，也可以采用<strong>UDP</strong>协议。</p></li> <li><p>应用层：主要负责<strong>应用程序的协议</strong>，例如HTTP协议、FTP协议等。</p></li></ul></li></ul> <h2 id="_11-2-网络编程三要素"><a href="#_11-2-网络编程三要素" class="header-anchor">#</a> 11.2 网络编程三要素</h2> <h3 id="传输协议（通信的规则）"><a href="#传输协议（通信的规则）" class="header-anchor">#</a> 传输协议（通信的规则）</h3> <ul><li><strong>数据报</strong>（Datagram）：网络传输的基本单位</li></ul> <ul><li><p><strong>UDP</strong>：<strong>用户数据报协议</strong>(User Datagram Protocol)。UDP是<strong>无连接通信协议</strong>，即在数据传输时，数据的发送端和接收端不建立逻辑连接。由于使用UDP协议<strong>消耗资源小，通信效率高</strong>，所以通常都会用于音频、视频和普通数据的传输。但在使用UDP协议传送数据时，由于UDP的<strong>面向无连接性，不能保证数据的完整性，不可靠</strong>，因此在传输重要数据时不建议使用UDP协议。特点:<strong>数据打包被限制在64kb以内</strong>，超出这个范围就不能发送了。</p> <p>使用场景：聊天留言，在线视频（丢帧），视频会议（丢帧），发短信，邮局包裹</p></li> <li><p><strong>TCP</strong>：<strong>传输控制协议</strong> (Transmission Control Protocol)。TCP协议是<strong>面向连接的通信协议</strong>，即传输数据之前，在发送端和接收端建立逻辑连接，然后再传输数据，它提供了两台计算机之间<strong>可靠无差错</strong>的数据传输。</p> <p>使用场景：下载，浏览网页。打电话，QQ聊天（你在线吗，在线，就回应下，就开始聊天了）</p></li> <li><p>在TCP连接中必须要明确客户端与服务器端，由客户端向服务端发出连接请求，在发送数据的准备阶段，客户端与服务器之间的三次交互，以保证连接的可靠，也称为“<strong>三次握手</strong>”。</p> <p><img src="/assets/img/image-20191102184922893.3e2db8fd.png" alt="image-20191102184922893.png"></p> <p><img src="/assets/img/image-20191102185003406.43d3c5fe.png" alt="image-20191102185003406"></p></li></ul> <h3 id="ip地址（inetaddress）"><a href="#ip地址（inetaddress）" class="header-anchor">#</a> IP地址（InetAddress）</h3> <ul><li><p>指<strong>互联网协议地址</strong>（Internet Protocol Address）：网络中<strong>计算机唯一标识</strong>（通信实体）</p></li> <li><p>IPv4：是一个<strong>32位</strong>的二进制数，通常被分为4个字节，表示成<code>a.b.c.d</code> 的形式，例如<code>192.168.65.100</code> 。其中a、b、c、d都是0~255之间的十进制整数，那么最多可以表示42亿个。点分十进制。</p></li> <li><p>IPv6：由于互联网的蓬勃发展，IP地址的需求量愈来愈大，但是网络地址资源有限，使得IP的分配越发紧张。为了扩大地址空间，拟通过IPv6重新定义地址空间，采用<strong>128位</strong>地址长度，<strong>每16个字节一组，分成8组十六进制数</strong>，表示成<code>ABCD:EF01:2345:6789:ABCD:EF01:2345:6789</code>，号称可以为全世界的每一粒沙子编上一个网址，这样就解决了网络地址资源数量不够的问题。</p></li> <li><p><strong>组成：网络号段 + 主机号段</strong></p> <p>A类：第一号段为网络号段+后三段的主机号段
一个网络号：256 * 256 * 256 = 16777216台主机
B类：前二号段为网络号段+后二段的主机号段
一个网络号：256 * 256 = 65536台主机
C类：前三号段为网络号段+后一段的主机号段
一个网络号：256台主机</p></li> <li><p><strong>分类：</strong></p> <ul><li><p>A类<code>1.0.0.1---127.255.255.254</code></p> <ul><li>10.X.X.X是私有地址（在互联网上不使用，在局域网络中的地址）</li> <li>127.X.X.X是保留地址，用做循环测试用的。</li></ul></li> <li><p>B类<code>128.0.0.1---191.255.255.254</code></p> <ul><li><p>172.16.0.0~172.31.255.255私有地址。</p></li> <li><p>169.254.X.X保留地址。</p></li></ul></li> <li><p>C类<code>192.0.0.1---223.255.255.254</code></p> <ul><li>192.168.X.X是私有地址</li></ul></li> <li><p>D类<code>224.0.0.1---239.255.255.254</code></p></li> <li><p>E类<code>240.0.0.1---247.255.255.254</code></p></li></ul></li> <li><p><strong>两个DOS命令：</strong> <code>ipconfig</code> 查看本机IP地址等信息
<code>ping</code> 后面跟IP地址。测试本机与指定的IP地址间的通信是否有问题</p></li> <li><p><strong>特殊的IP地址：</strong> <code>127.0.0.1</code>、<code>localhost</code> 回环地址(表示本机)
<code>x.x.x.255</code> 广播地址
<code>x.x.x.0</code> 网络地址</p></li> <li><p><strong>域名解析</strong>：域名容易记忆，当在连接网络时输入一个主机的域名后，域名服务器（DNS）负责将域名转化成IP地址，这样才能和主机建立连接。</p> <ul><li><p><code>InetAddress类</code><strong>的概述和使用</strong>（方便对IP地址的获取和操作）</p></li> <li><p><strong>如果一个类没有构造方法：</strong></p> <p>A:成员全部是静态的(Math,Arrays,Collections)</p> <p>B:单例设计模式(Runtime)</p> <p>C:类中有静态方法返回该类的对象(InetAddress)</p></li></ul></li> <li><p>常用方法</p> <ul><li><p><code>static InetAddress getByName(String host)</code>:根据<strong>主机名</strong>或<strong>IP地址</strong>字符串得到IP地址<strong>对象</strong></p></li> <li><p><code>String getHostName()</code>：返回主机名</p></li> <li><p><code>String getHostAddress()</code>：返回IP地址字符串</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">InetAddress</span> inetAddress <span class="token operator">=</span> <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span><span class="token string">&quot;183.192.170.170&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// /183.192.170.170</span>
<span class="token class-name">InetAddress</span> qq <span class="token operator">=</span> <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span><span class="token string">&quot;www.qq.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// www.qq.com/183.192.170.170</span>
<span class="token class-name">InetAddress</span> localHost <span class="token operator">=</span> <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getLocalHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ConanandeMacBook-Pro.local/192.168.1.5 </span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>qq<span class="token punctuation">.</span><span class="token function">getHostName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// www.qq.com</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>qq<span class="token punctuation">.</span><span class="token function">getHostAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 183.192.170.170</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>qq<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 183.192.170.170</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>qq<span class="token punctuation">.</span><span class="token function">getCanonicalHostName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// [B@6d6f6e28</span>
</code></pre></div></li></ul></li></ul> <h3 id="端口号（逻辑端口）"><a href="#端口号（逻辑端口）" class="header-anchor">#</a> 端口号（逻辑端口）</h3> <blockquote><p><strong>物理端口</strong>：网卡口</p></blockquote> <ul><li>端口：<strong>正在运行的程序的标识</strong></li></ul> <ul><li><strong>端口</strong> <ol><li>每个网络程序都会至少有一个逻辑端口</li> <li>用于标识进程的逻辑地址，不同进程的标识</li> <li>有效端口：0~ 65535，其中0~ 1024系统使用或保留端口。</li></ol></li></ul> <ul><li>常用端口号：
<ul><li>HTTP协议端口号：<code>80</code></li> <li>FTP：<code>21</code></li> <li>Telnet：<code>23</code></li> <li>数据库：MySQL<code>3306</code>、Oracle<code>1521</code></li> <li>Tomcat：<code>8080</code></li></ul></li></ul> <h2 id="_11-3-socket-编程"><a href="#_11-3-socket-编程" class="header-anchor">#</a> 11.3 Socket 编程</h2> <ul><li>网络上具有唯一标识的<strong>IP地址</strong>和<strong>端口号</strong>组合在一起才能构成唯一能识别的标识符<strong>套接字</strong></li></ul> <ul><li><p><strong>Socket原理机制</strong></p> <ul><li>通信的两端都有Socket</li> <li>网络通信其实就是Socket间的通信</li> <li>数据在两个Socket间通过IO传输</li></ul></li> <li><p>构造方法</p> <ul><li><p><code>public Socket(InetAddress address,int port)</code></p> <p>创建一个流套接字并将其连接到指定 IP 地址的指定端口号</p></li> <li><p><code>public Socket(String host,int port)</code></p> <p>创建一个流套接字并将其连接到指定主机上的指定端口号</p></li></ul></li> <li><p>常用方法</p> <ul><li><p><code>InputStream getInputStream()</code></p> <p>返回此套接字的输入流。可以用于接收网络消息</p></li> <li><p><code>OutputStream getOutputStream()</code></p> <p>返回此套接字的输出流。可以用于发送网络消息</p></li> <li><p><code>InetAddress getInetAddress()</code></p> <p>返回此套接字连接到的远程 IP 地址；如果套接字是未连接的，则返回 null</p></li> <li><p><code>netAddress getLocalAddress()</code></p> <p>获取套接字绑定的本地地址，即本端的IP地址</p></li> <li><p><code>int getPort()</code></p> <p>此套接字连接到的远程端口号；如果尚未连接套接字，则返回 0</p></li> <li><p><code>int getLocalPort()</code></p> <p>返回此套接字绑定到的本地端口。 如果尚未绑定套接字，则返回 -1</p></li> <li><p><code>void close()</code></p> <p>关闭此套接字。套接字被关闭后，便不可在以后的网络连接中使用(即无法重新连接或重新绑定)。需要创建新的套接字对象。 关闭此套接字也将会关闭该套接字的 InputStream 和 OutputStream。</p></li> <li><p><code>void shutdownInput()</code></p> <p>如果在套接字上调用 <code>shutdownInput()</code> 后从套接字输入流读取内容，则流将返回 <code>EOF</code>(<strong>文件结束符</strong>)。 即不能在从此套接字的输入流中接收任何数据。</p></li> <li><p><code>void shutdownOutput()</code></p> <p>如果在套接字上调用 <code>shutdownOutput()</code> 后从套接字输入流读取内容，则流将返回 <code>EOF</code>(<strong>文件结束符</strong>)。 即不能在从此套接字的输入流中接收任何数据。对于 TCP 套接字，任何以前写入的数据都将被发送，并且后跟 TCP 的正常连接终止序列。 如果在套接字上调用 <code>shutdownOutput()</code> 后写入套接字输出流， 则该流将抛出 IOException，即不能通过此套接字的输出流发送任何数据</p></li></ul></li></ul> <h3 id="tcp（serversocket、socket）"><a href="#tcp（serversocket、socket）" class="header-anchor">#</a> TCP（ServerSocket、Socket）</h3> <ul><li><p><code>java.net.ServerSocket</code>：这个类<strong>实现了服务器套接字</strong>，该对象等待通过网络的请求。</p> <ul><li><code>ServerSocket(int port)</code> 使用该构造方法在<strong>创建ServerSocket对象</strong>时，就可以将其绑定到一个指定的端口号上，参数<code>port</code>就是端口号。</li> <li><code>Socket accept()</code> ：<strong>侦听并接受连接</strong>，返回一个新的Socket对象，用于和客户端实现通信。<strong>该方法会一直阻塞直到建立连接</strong>。</li> <li><code>void close()</code> ：<strong>关闭此套接字</strong>。详细介绍如Socket中<code>close</code>方法</li></ul></li> <li><p><code>java.net.Socket</code>：该类<strong>实现客户端套接字</strong>，套接字指的是两台设备之间通讯的端点。</p> <ul><li><p><code>Socket(InetAddress inet/String host, int port)</code></p> <ul><li><strong>创建套接字对象</strong>并将其连接到<strong>指定主机</strong>上的<strong>指定端口号</strong>，<strong>创建的同时会自动向服务器方发起连接</strong>。</li></ul></li> <li><p><code>InputStream getInputStream()</code></p> <ul><li>返回此<strong>套接字的输入流</strong>。</li> <li>如果此Scoket具有相关联的通道，则生成的InputStream 的所有操作也关联该通道。</li> <li>关闭生成的InputStream也将关闭相关的Socket。</li></ul></li> <li><p><code>OutputStream getOutputStream()</code></p> <ul><li>返回此<strong>套接字的输出流</strong>。</li> <li>同上两条</li></ul></li> <li><p><code>void close()</code></p> <ul><li><strong>关闭此套接字</strong>。</li> <li>一旦一个socket被关闭，它不可再使用。</li> <li>关闭此socket也将关闭相关的InputStream和OutputStream 。</li></ul></li> <li><p><code>void shutdownOutput()</code></p> <ul><li><strong>禁用此套接字的输出流</strong>。</li> <li><strong>任何先前写出的数据将被发送</strong>，并且后跟 TCP 的正常连接<strong>终止序列</strong>。</li></ul> <blockquote><p><strong>服务器使用客户端的流和客户端交互</strong></p> <p>IO流中各<strong>read</strong>方法在<strong>没有输入可用时将阻塞</strong>，并且<strong>在通道中输入流是读不到结束标记</strong>的，所以需要<strong>shutdownOutput</strong>方法来发送数据并<strong>带上终止序列</strong>。</p></blockquote></li></ul></li> <li><p><strong>服务器端接收数据（ServerSocket）</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 1.创建TCP服务器端的Socket对象</span>
<span class="token class-name">ServerSocket</span> ss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">60001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2.监听客户端连接</span>
<span class="token class-name">Socket</span> s <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3.获取套接字的输入流，读取数据</span>
<span class="token class-name">InputStream</span> is <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 此处使用 ByteArrayOutputStream 替代 StringBuilder</span>
<span class="token class-name">ByteArrayOutputStream</span> baos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> len<span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> is<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  baos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;收到了来自于：&quot;</span> <span class="token operator">+</span> socket<span class="token punctuation">.</span><span class="token function">getInetAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHostAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;的数据：&quot;</span><span class="token operator">+</span> baos<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 如下写法可能产生乱码</span>
<span class="token comment">/*byte[] bys = new byte[1024];
int len = is.read(bys);
System.out.println(new String(bys,0,len));*/</span>

<span class="token comment">// 4.释放资源</span>
baos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
s<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 服务端一般不关闭</span>
</code></pre></div></li> <li><p><strong>客户端发送数据（Socket）</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 1.创建TCP客户端的Socket对象</span>
<span class="token class-name">Socket</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.81.1&quot;</span><span class="token punctuation">,</span> <span class="token number">60001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
<span class="token comment">// 2.获取套接字的输出流，写数据</span>
<span class="token class-name">OutputStream</span> os <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
os<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;hello java world&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
<span class="token comment">// 3.释放资源</span>
s<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h4 id="上传文件"><a href="#上传文件" class="header-anchor">#</a> 上传文件</h4> <ul><li><p><strong>文件名称写死的问题</strong>：建议使用系统时间优化，保证文件名称唯一</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">FileOutputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;.jpg&quot;</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>循环接收的问题</strong>：服务端不应保存一个文件就关闭，需要不断的接收不同用户的文件，使用<strong>循环</strong>改进</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 让服务器一致处于监听状态。每次接收新的连接,创建一个Socket</span>
<span class="token keyword">while</span>（<span class="token boolean">true</span>）<span class="token punctuation">{</span>
  <span class="token class-name">Socket</span> accept <span class="token operator">=</span> serverSocket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ......</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><strong>效率问题</strong>：服务端，在接收大文件时耗费时间长，此时不能接收其他用户上传，使用<strong>多线程</strong>技术优化</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">while</span>（<span class="token boolean">true</span>）<span class="token punctuation">{</span>
  <span class="token class-name">Socket</span> accept <span class="token operator">=</span> serverSocket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// accept 交给子线程处理.</span>
  <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ......</span>
    <span class="token class-name">InputStream</span> bis <span class="token operator">=</span> accept<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ......</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//并且由于接口中没有抛异常，所以实现类中也不能抛异常，只能try...catch</span>
</code></pre></div></li></ul> <h4 id="上传文件带反馈（多线程）"><a href="#上传文件带反馈（多线程）" class="header-anchor">#</a> 上传文件带反馈（多线程）</h4> <ul><li><p>Server</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Server</span> <span class="token punctuation">{</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">ServerSocket</span> serverSocket <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      serverSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 服务端循环接收不同客户端请求</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 监听到客户端请求并建立连接</span>
      <span class="token class-name">Socket</span> socket <span class="token operator">=</span> serverSocket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 利用lambda实现多线程，让每个用户的线程不受其他线程影响（ServerSocket属于服务端，不能在多线程里）。并由于接口没有抛异常，所以以下用try捕获</span>
      <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">BufferedInputStream</span> bis <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">BufferedOutputStream</span> bos <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">BufferedWriter</span> bw <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token comment">// 检查上传文件的目录是否存在文件</span>
          <span class="token class-name">File</span> path <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;./upload/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            path<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token class-name">File</span> uploadFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// 将从网络通道中的文件读取并写入磁盘</span>
          bis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          bos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>uploadFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">int</span> len<span class="token punctuation">;</span>
          <span class="token comment">// 只有接收到 Client  Outputd 的结束序列，如下读取操作才会结束，否则一直阻塞</span>
          <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            bos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token comment">// 回应客户端上传完毕</span>
          bw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedWriter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OutputStreamWriter</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          bw<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;上传完毕&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          bw<span class="token punctuation">.</span><span class="token function">newLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          bw<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 这个不能丢！</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 这里的关闭资源应该分别 try-catch</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bw <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              bw<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bos <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              bos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>socket <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// close本身也抛异常。由于是多线程，每个线程使用的不同socket，所以socket可以关闭</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>Client</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">BufferedInputStream</span> bis <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">BufferedOutputStream</span> bos <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">ByteArrayOutputStream</span> baos <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      bis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;1.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      bos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 关闭 Socket 会自动关闭。手动关闭会导致 Broken pipe 或 因为调用 write 方法 flush 而抛异常</span>

      <span class="token comment">//将本地磁盘文件读取并写入网络通道中</span>
      <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> len<span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        bos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">//发送数据并带上终止序列，以便服务器读取时可以读到终止序列</span>
      socket<span class="token punctuation">.</span><span class="token function">shutdownOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">//读取网络通道中服务器回应的数据并打印</span>
      <span class="token comment">//br = new BufferedReader(new InputStreamReader(socket.getInputStream(), StandardCharsets.UTF_8));</span>
      <span class="token class-name">InputStream</span> is <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      baos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> len1<span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len1 <span class="token operator">=</span> is<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        baos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len1<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>baos<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>baos<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          baos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bis <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          bis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>socket <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="udp（datagramsocket、datagrampacket）"><a href="#udp（datagramsocket、datagrampacket）" class="header-anchor">#</a> UDP（DatagramSocket、Datagrampacket）</h3> <ul><li><p>DatagramSocket构造方法</p> <ul><li><p><code>DatagramSocket(int port)</code></p> <p>创建数据报套接字并将其绑定到本地主机上的指定端口。套接字将被绑定到通配符地址，IP 地址由内核来选择</p></li> <li><p><code>DatagramSocket(int port,InetAddress laddr)</code></p> <p>创建数据报套接字，将其绑定到指定的本地地址。 本地端口必须在 0 到 65535 之间(包括两者)。如果 IP 地址为 0.0.0.0，套接字将被绑定到通配符地址，IP 地址由内核选择。</p></li></ul></li> <li><p>DatagramSocket常用方法</p> <ul><li><p><code>void send(DatagramPacket p)</code></p> <p>从此套接字发送数据报包。DatagramPacket 包含的信息指示：将要发送的数据、其长度、远程主机的 IP 地址和远程主机的端口号</p></li> <li><p><code>void receive(DatagramPacket p)</code></p> <p>从此套接字接收数据报包。当此方法返回时，DatagramPacket的缓冲区填充了接收的数据。数据报包也包含发送方的 IP 地址和发送方机器上的端口号。 此方法在接收到数据报前一直<strong>阻塞</strong>。数据报包对象的 length 字段包含所接收信息的长度。如果信息比包的长度长，该信息将被截短。</p></li> <li><p><code>InetAddress getLocalAddress()</code></p> <p>获取套接字绑定的本地地址</p></li> <li><p><code>int getLocalPort()</code></p> <p>返回此套接字绑定的本地主机上的端口号</p></li> <li><p><code>InetAddress getInetAddress()</code></p> <p>返回此套接字连接的地址。如果套接字未连接，则返回 null</p></li> <li><p><code>int getPort()</code></p> <p>返回此套接字的端口。如果套接字未连接，则返回 -1</p></li> <li><p><code>void close()</code></p> <p>关闭此数据报套接字</p></li></ul></li> <li><p>DatagramPacket构造方法</p> <ul><li><p><code>DatagramPacket(byte[] buf,int length)</code></p> <p>构造 DatagramPacket，用来接收长度为 length 的数据包。 length 参数必须小于等于 buf.length</p></li> <li><p><code>DatagramPacket(byte[] buf,int length,InetAddress address,int port)</code></p> <p>构造数据报包，用来将长度为 length 的包发送到指定主机上的指定端口号。length 参数必须小于等于 buf.length</p></li></ul></li> <li><p>DatagramPacket常用方法</p> <ul><li><p><code>InetAddress getAddress()</code></p> <p>返回某台机器的 IP 地址，此数据报将要发往该机器或者是从该机器接收到的</p></li> <li><p><code>int getPort()</code></p> <p>返回某台远程主机的端口号，此数据报将要发往该主机或者是从该主机接收到的</p></li> <li><p><code>byte[] getData()</code></p> <p>返回数据缓冲区。接收到的或将要发送的数据从缓冲区中的偏移量 offset 处开始，持续 length 长度</p></li> <li><p><code>int getLength()</code></p> <p>返回将要发送或接收到的数据的长度</p></li></ul></li> <li><p><strong>UDP协议接收数据</strong></p></li> <li><div class="language-java extra-class"><pre class="language-java"><code>  <span class="token comment">// 创建接收端DatagramSocket对象，指定 PORT</span>
  <span class="token class-name">DatagramSocket</span>   <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramSocket</span><span class="token punctuation">(</span><span class="token number">10086</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 创建一个数据包(接收容器)，调用DatagramSocket对象的接收方法接收数据</span>
  <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bys <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token class-name">DatagramPacket</span> dp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramPacket</span><span class="token punctuation">(</span>bys<span class="token punctuation">,</span> bys<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 简写，实际应该循环接收</span>
  ds<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span>dp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 解析数据包，并显示在控制台</span>
  <span class="token class-name">String</span> ip <span class="token operator">=</span> dp<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHostAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>dp<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dp<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ip<span class="token operator">+</span><span class="token string">&quot;:&quot;</span><span class="token operator">+</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">//ds.close();//接收端应该一直开着</span>
</code></pre></div></li> <li><p><strong>UDP协议发送数据</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 创建发送端DatagramSocket对象</span>
<span class="token class-name">DatagramSocket</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramSocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div></li></ul> <p>// 创建数据，并把数据打包DatagramPacket，指定发送的 IP 和 PORT
byte[] bys = &quot;helloworld&quot;.getBytes();
InetAddress address = InetAddress.getByName(&quot;Conanan&quot;);
int port = 10086;
DatagramPacket dp = new DatagramPacket(bys, bys.length, address, port);</p> <pre><code>// 调用DatagramSocket对象的发送方法发送数据包
ds.send(dp);
// 释放资源
ds.close();
```
</code></pre> <h4 id="多线程实现聊天室"><a href="#多线程实现聊天室" class="header-anchor">#</a> 多线程实现聊天室</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//主线程</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainDemo</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token class-name">DatagramSocket</span> receiveSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramSocket</span><span class="token punctuation">(</span><span class="token number">10086</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">DatagramSocket</span> sendSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramSocket</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token class-name">ReceiveThread</span> rt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReceiveThread</span><span class="token punctuation">(</span>receiveSocket<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">SendThread</span> st <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SendThread</span><span class="token punctuation">(</span>sendSocket<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>rt<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>st<span class="token punctuation">)</span><span class="token punctuation">;</span>
		t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span class="token comment">//接收端</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReceiveThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">DatagramSocket</span> ds<span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token class-name">ReceiveThread</span><span class="token punctuation">(</span><span class="token class-name">DatagramSocket</span> ds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>ds <span class="token operator">=</span> ds<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bys <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token class-name">DatagramPacket</span> dp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramPacket</span><span class="token punctuation">(</span>bys<span class="token punctuation">,</span> bys<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">try</span> <span class="token punctuation">{</span>
				ds<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span>dp<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>dp<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dp<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ip:&quot;</span><span class="token operator">+</span>dp<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;,port:&quot;</span><span class="token operator">+</span>dp<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;,msg:&quot;</span><span class="token operator">+</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//发送端</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">DatagramSocket</span> ds<span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token class-name">SendThread</span><span class="token punctuation">(</span><span class="token class-name">DatagramSocket</span> ds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>ds <span class="token operator">=</span> ds<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Scanner</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> str <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>str<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;886&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				ds<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bys <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">InetAddress</span> address <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
				<span class="token keyword">try</span> <span class="token punctuation">{</span>
					address <span class="token operator">=</span> <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span><span class="token string">&quot;Conanan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token class-name">DatagramPacket</span> dp<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DatagramPacket</span><span class="token punctuation">(</span>bys<span class="token punctuation">,</span> bys<span class="token punctuation">.</span>length<span class="token punctuation">,</span> address<span class="token punctuation">,</span> <span class="token number">10086</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					ds<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>dp<span class="token punctuation">)</span><span class="token punctuation">;</span>
					str <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="_11-4-url-编程"><a href="#_11-4-url-编程" class="header-anchor">#</a> 11.4 URL 编程</h2> <ul><li><p>URL(Uniform Resource Locator)：统一资源定位符，它表示 Internet 上某一资源的地址，它是一种具体的URI，即URL可以用来标识一个资源，而且还指明了如何 locate 这个资源。通过 URL 我们可以访问 Internet 上的各种网络资源，比如最常见的 www，ftp 站点。浏览器通过解析给定的 URL 可以在网络上查找相应的文件或其他资源</p></li> <li><p>URL的基本结构由5部分组成</p> <p><code>&lt;传输协议&gt;://&lt;主机名&gt;:&lt;端口号&gt;/&lt;文件名&gt;#片段名?参数列表</code></p> <ul><li><p>http://conanan.top:8080/helloworld/index.jsp#a?username=shkstart&amp;password=123</p></li> <li><p><strong>#片段名</strong>：即锚点，例如看小说，直接定位到章节</p></li> <li><p><strong>参数列表格式</strong>：<code>参数名=参数值&amp;参数名=参数值....</code></p></li></ul></li></ul> <h3 id="url类"><a href="#url类" class="header-anchor">#</a> URL类</h3> <ul><li><p>构造方法<code>java.net.URL</code></p> <ul><li><p><code>URL (String spec)</code></p> <p>通过一个表示URL地址的字符串可以构造一个URL对象。如<code>new URL (&quot;http://www.qq.com/&quot;);</code></p></li> <li><p><code>URL(URL context, String spec)</code></p> <p>通过基 URL 和相对 URL 构造一个 URL 对象。如<code>new URL(url, “download.html&quot;);</code></p></li> <li><p><code>URL(String protocol, String host[, int port], String file)</code></p> <p>如<code>new URL(&quot;http&quot;,&quot;www.atguigu.com&quot;, “download.html&quot;);</code></p> <p>如<code>new URL(&quot;http&quot;, &quot;www.atguigu.com&quot;, 80, “download.html&quot;);</code></p></li></ul> <p>URL类的构造器都声明抛出非运行时异常，必须要对这一异常进行处理，通 常是用 try-catch 语句进行捕获。</p></li> <li><p>常用方法</p> <ul><li><code>String getProtocol()</code> 协议名，如：<code>http</code></li> <li><code>String getHost()</code> 主机名，如：<code>www.qq.com</code></li> <li><code>String getPort()</code> 端口号，如：<code>80</code></li> <li><code>String getPath()</code> 文件路径，如：<code>/examples/beauty.jpg</code></li> <li><code>String getFile()</code> 文件名，如：<code>/examples/beauty.jpg?username=Tom</code></li> <li><code>String getQuery()</code> 查询名，如：<code>username=Tom</code></li></ul></li></ul> <h3 id="针对http协议的urlconnection类"><a href="#针对http协议的urlconnection类" class="header-anchor">#</a> 针对HTTP协议的URLConnection类</h3> <ul><li><p>URL的方法 <code>openStream()</code>：能从网络上读取数据</p></li> <li><p>若希望输出数据，例如向服务器端的 CGI (公共网关接口-Common Gateway Interface-的简称，是用户浏览器和服务器端的应用程序进行连接的接口)程序发送一 些数据，则必须先与URL建立连接，然后才能对其进行读写，此时需要使用 URLConnection 。</p></li> <li><p>URLConnection：表示到URL所引用的远程对象的<strong>连接</strong>。当与一个URL建立连接时， 首先要在一个 URL 对象上通过方法 <code>openConnection()</code> 生成对应的 URLConnection 对象。如果连接过程失败，将产生IOException.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">URL</span> url <span class="token operator">=</span> <span class="token keyword">new</span> URL <span class="token punctuation">(</span><span class="token string">&quot;http://www.atguigu.com/index.shtml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">URLConnectonn</span> u <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">openConnection</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>通过URLConnection对象获取的输入流和输出流，即可以与现有的CGI 程序进行交互</p> <ul><li><code>public Object getContent() throws IOException</code></li> <li><code>public int getContentLength()</code></li> <li><code>public String getContentType()</code></li> <li><code>public long getDate()</code></li> <li><code>public long getLastModified()</code></li> <li><code>public InputStream getInputStream() throws IOException</code></li> <li><code>public OutputSteram getOutputStream() throws IOException</code></li></ul></li></ul> <h3 id="uri、url和urn的区别"><a href="#uri、url和urn的区别" class="header-anchor">#</a> URI、URL和URN的区别</h3> <ul><li>URI，是uniform resource identifier，统一资源标识符，用来唯一的标识一个资源。</li> <li>URL是uniform resource locator，统一资源定位符，它是一种具体 的URI，即URL可以用来标识一个资源，而且还指明了如何locate这个资源</li> <li>URN，uniform resource name，统一资源命名，是通过名字来标识资源， 比如mailto:java-net@java.sun.com</li></ul> <p>也就是说，URI是以一种抽象的，高层 次概念定义统一资源标识，而URL和URN则是具体的资源标识的方式。URL 和 URN都是一种URI。</p> <p>在Java的URI中，一个URI实例可以代表绝对的，也可以是相对的，只要它符 合URI的语法规则。而URL类则 不仅符合语义，还包含了定位该资源的信息，因此它不能是相对的。</p> <img src="images/image-20191103144240461.png" alt="image-20191103144240461" style="zoom:50%;"></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">11/10/2019, 1:13:27 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Java/Core/10 AIO.html" class="prev">10 AIO（暂时未完成）</a></span> <span class="next"><a href="/Java/Core/12 Reflect.html">12 Reflect—java.lang.reflect</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.11b86352.js" defer></script><script src="/assets/js/2.dc2cb52a.js" defer></script><script src="/assets/js/6.3ac5cf54.js" defer></script>
  </body>
</html>
